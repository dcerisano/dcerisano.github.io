function rgb_led_matrix_init(){var N=false,w=null,M=null,f=null,ao={},l={},J="localhost:8080",ac=null,ae=1,q=false,D=false,Z=1,T=null,an=true,j=document.getElementById("canvas"),Q=document.getElementById("ui"),ai=document.getElementById("menu"),H=document.getElementById("fs"),t=document.getElementById("vs"),v=true,F=null,E=null,r=null,p=null,y=null,h=null,a=8,c=1,Y=0,n=0,C=0,al=0,X=0,e=0,d=0,ah=null,k=null,b=null,A=false,am=false,O=[],V=8080,ac=null;function R(ap,ar,aq){N&&console.log("WEBSOCKET: CONNECT");if(am&&ac!=null){N&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");m(ac)}else{g()}}function ab(){N&&console.log("WEBSOCKET: OPEN");socket=this;s()}function L(aq){N&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+aq.data.toString());var ap=JSON.parse(aq.data.toString());var at=ap.method;var ar=ap.params;switch(at){case"set_colors_ack":u(ar);ak(ar);break;case"get_shaders_ack":w=ar;break;case"get_devices_ack":M=ar;break;case"get_images_ack":f=ar;break;default:}}function B(ap){N&&console.log("WEBSOCKET: ONCLOSE");P()}function i(ap){N&&console.log("WEBSOCKET: ONERROR")}function I(aq,ap){N&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+W(aq,ap));if(socket.readyState===socket.OPEN){socket.send(W(aq,ap))}}function W(ar,aq){var ap={method:ar,params:aq};return JSON.stringify(ap)}function g(){try{A=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var ap=new RTCPeerConnection({iceServers:[]});ap.createDataChannel("");ap.createOffer(ap.setLocalDescription.bind(ap),af);ap.onicecandidate=U}catch(aq){console.log(aq.message)}}function U(ap){if(!ap||!ap.candidate||!ap.candidate.candidate){return}var aq=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ap.candidate.candidate)[1];this.onicecandidate=af;ip=aq.split(".")[0]+"."+aq.split(".")[1]+"."+aq.split(".")[2];setTimeout(S,5000);scan_counter=0;setTimeout(aj,20)}function aj(){scan_counter++;if(scan_counter<255){var ap=ip+"."+scan_counter;o(ap);setTimeout(aj,20)}}function af(){}function S(){N&&console.log("DISCOVER TIMEOUT");A=false;if(!am){}}function z(){for(var ap=0;ap<O.length;++ap){O.shift().abort()}}function o(ap){ad(ap).then(function(aq){m(aq);z()},function(aq){})}function ad(ap){return new Promise(function(ar,aq){try{var au=new XMLHttpRequest();O.push(au);au.ip=ap;au.timeout=1000;au.open("GET","http://"+ap+":"+V,true);au.ontimeout=function(av){aq(Error("NA"))};au.onerror=function(){aq(Error("NA"))};au.onload=function(av){if(au.readyState===4){if(au.status===200){console.log("FOUND SERVER: "+this.ip);am=true;ac="ws://"+this.ip+":"+V;ar(ac)}}};au.send()}catch(at){console.log(at.message)}})}function m(ap){try{socket=new WebSocket(ap);socket.onopen=ab;socket.onclose=B;socket.onerror=i;socket.onmessage=function(ar){L(ar)}}catch(aq){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(aq.message)}}function ak(ap){}G();function G(){N&&console.log("UI INIT");x()}function x(){if(!D){R("ws://"+J,s,P)}}function s(){N&&console.log("UI CONNECTED");D=true}function P(){N&&console.log("UI DISCONNECTED");D=false;u(null);x()}function K(at){var ap=this.getRowValues(at);ap.name=ap.name;var ar=0;for(var aq=0;aq<this.getRowCount();aq++){ar=Math.max(ar,parseInt(this.getRowId(aq))+1)}this.insertAfter(at,ar,ap)}function ag(){if(window.location.hostname==="standard3d.com"){return}v=!v;if(v){Q.style.display="none";j.style.opacity=1;ai.innerHTML="<b>SHOW</b>";ai.style.color="gray"}else{Q.style.display="inline-block";j.style.opacity=0.5;ai.innerHTML="<b>HIDE&nbsp;&nbsp;&nbsp;&nbsp;SAVE&nbsp;&nbsp;&nbsp;&nbsp;LOAD&nbsp;&nbsp;&nbsp;&nbsp;UNDO</b>";ai.style.color="white"}}function aa(){y={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};r=document.querySelector("#canvas").getContext("webgl");p=twgl.createProgramInfo(r,["vs","fs"]);h=twgl.createBufferInfoFromArrays(r,y);r.useProgram(p.program);twgl.setBuffersAndAttributes(r,p,h);F=new EditableGrid("Layers");F.tableLoaded=function(){F.duplicate=K;this.setCellRenderer("action",new CellRenderer({render:function(ap,aq){var ar=F.getRowId(ap.rowIndex);ap.innerHTML='<a onclick="if (layerGrid.data.length>1) layerGrid.remove('+ap.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ap.innerHTML+='&nbsp;<a onclick="layerGrid.duplicate('+ap.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("layers","grid")};F.loadJSON("data/layers.json");E=new EditableGrid("Properties");E.tableLoaded=function(){E.duplicate=K;this.setCellRenderer("action",new CellRenderer({render:function(ap,aq){var ar=E.getRowId(ap.rowIndex);ap.innerHTML='<a onclick="if (propertyGrid.data.length>1) propertyGrid.remove('+ap.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ap.innerHTML+='&nbsp;<a onclick="propertyGrid.duplicate('+ap.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("properties","grid")};E.loadJSON("data/properties.json");ai.onclick=ag}aa();function u(aq){if(aq&&aq.shader_params&&aq.shader_params.width&&aq.shader_params.height&&aq.colors&&aq.colors.data){a=aq.shader_params.width;c=aq.shader_params.height;if(aq.colors){T=aq.colors.data}}else{a=8;c=1;T=new Uint8Array(24).fill(0)}const ar=twgl.createTexture(r,{width:a,height:c,internalFormat:r.RGB,min:r.NEAREST,mag:r.NEAREST,src:T});twgl.resizeCanvasToDisplaySize(r.canvas);r.viewport(0,0,r.canvas.width,r.canvas.height);const ap={canvas_resolution:[r.canvas.width,r.canvas.height],texture_resolution:[a,c],tex:ar};if(c*a*3!=T.length){return}twgl.setUniforms(p,ap);twgl.drawBufferInfo(r,h)}};