function rgb_led_matrix_init(){var M=false,v=null,G=null,h=null,am={},l={},J="localhost:8080",ab=null,ad=1,r=false,C=false,Y=1,S=null,n=document.getElementById("emulator"),P=document.getElementById("ui"),u=true,F=null,D=null,ak=n.getContext("2d"),a=8,d=1,X=0,p=0,B=0,aj=0,W=0,g=0,e=0,ag=null,o=null,c=null,y=false,al=false,N=[],U=8080,L=null;function Q(an,ap,ao){M&&console.log("WEBSOCKET: CONNECT");k()}function aa(){M&&console.log("WEBSOCKET: OPEN");socket=this;s()}function K(ao){M&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+ao.data.toString());var an=JSON.parse(ao.data.toString());var aq=an.method;var ap=an.params;switch(aq){case"set_colors_ack":t(ap);ai(ap);break;case"get_shaders_ack":v=ap;break;case"get_controllers_ack":G=ap;break;case"get_images_ack":h=ap;break;default:}}function z(an){M&&console.log("WEBSOCKET: ONCLOSE");ab=null;O()}function m(an){M&&console.log("WEBSOCKET: ONERROR")}function I(ao,an){M&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+V(ao,an));if(socket.readyState===socket.OPEN){socket.send(V(ao,an))}}function V(ap,ao){var an={method:ap,params:ao};return JSON.stringify(an)}function k(){try{y=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var an=new RTCPeerConnection({iceServers:[]});an.createDataChannel("");an.createOffer(an.setLocalDescription.bind(an),ae);an.onicecandidate=T}catch(ao){console.log(ao.message)}}function T(an){if(!an||!an.candidate||!an.candidate.candidate){return}var ao=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(an.candidate.candidate)[1];this.onicecandidate=ae;L=ao.split(".")[0]+"."+ao.split(".")[1]+"."+ao.split(".")[2];setTimeout(R,5000);scan_counter=0;setTimeout(ah,20)}function ah(){scan_counter++;if(scan_counter<255){var an=L+"."+scan_counter;q(an);setTimeout(ah,20)}}function ae(){}function R(){M&&console.log("DISCOVER TIMEOUT");y=false;if(!al){}}function x(){for(var an=0;an<N.length;++an){N.shift().abort()}}function q(an){ac(an).then(function(ao){A(ao);x()},function(ao){})}function ac(an){return new Promise(function(ap,ao){try{var ar=new XMLHttpRequest();N.push(ar);ar.ip=an;ar.timeout=1000;ar.open("GET","http://"+an+":"+U,true);ar.ontimeout=function(at){ao(Error("NA"))};ar.onerror=function(){ao(Error("NA"))};ar.onload=function(at){if(ar.readyState===4){if(ar.status===200){console.log("FOUND SERVER: "+this.ip);al=true;ap("ws://"+this.ip+":"+U)}}};ar.send()}catch(aq){console.log(aq.message)}})}function A(an){try{socket=new WebSocket(an);socket.onopen=aa;socket.onclose=z;socket.onerror=m;socket.onmessage=function(ap){K(ap)}}catch(ao){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(ao.message)}}function ai(an){}H();function H(){M&&console.log("UI INIT");w()}function w(){if(!C){Q("ws://"+J,s,O)}}function s(){M&&console.log("UI CONNECTED");C=true}function O(){M&&console.log("UI DISCONNECTED");C=false;t(null);w()}function Z(){document.getElementsByTagName("BODY")[0].onresize=t;P=document.getElementById("ui");P.style.display="none";document.onclick=af;F=new EditableGrid("Layers");F.tableLoaded=function(){this.renderGrid("layers","layer_grid")};F.loadJSON("data/layers.json");D=new EditableGrid("Properties");D.tableLoaded=function(){this.renderGrid("properties","property_grid")};D.loadJSON("data/properties.json")}function af(){if(location.hostname=="standard3d.com"){return}u=!u;if(u){P.style.display="none"}else{P.style.display="inline-block"}}Z();function t(ao){if(ao&&ao.shader_params&&ao.shader_params.width&&ao.shader_params.height&&ao.colors&&ao.colors.data){a=ao.shader_params.width;d=ao.shader_params.height;if(ao.colors){S=ao.colors.data}}else{a=8;d=1;S=new Uint8Array(24).fill(0)}b(ao);M&&console.log("drawMatrix");if(d*a*3!=S.length){return}for(i=0;i<a;i++){for(j=0;j<d;j++){var an=B*(i+1),ap=aj*(j+1);f(an,ap,W,E(i,j))}}}function b(){M&&console.log("resizeMatrix");X=window.innerWidth;p=window.innerHeight;g=0;e=0;n.width=X;n.height=p;n.style.width=X;n.style.height=p;B=X/(a+1);aj=p/(d+1);if(B>aj){B=aj}else{aj=B}e=(p-aj*(d+1))/2;g=(X-B*(a+1))/2;W=B*0.4}function E(ao,ar){var aq=S[(ar*a+ao)*3+0],ap=S[(ar*a+ao)*3+1],an=S[(ar*a+ao)*3+2];if(typeof aq!=="undefined"&&ap!=="undefined"&&an!=="undefined"){return"rgba("+aq+","+ap+","+an+",1)"}else{return null}}function f(ao,aq,an,ap){if(ap){ak.beginPath();ak.arc(ao+g,aq+e,an,0,2*Math.PI,false);ak.fillStyle=ap;ak.fill();ak.lineWidth=1;ak.strokeStyle="#101010";ak.stroke()}}};