function rgb_led_matrix_init(){var ai=false,ao=null,A=null,e=null,a={},b={},T="localhost:8080",aa=null,p=1,M=false,aj=false,W=1,ah=null,d=true,aC=document.getElementById("canvas"),H=document.getElementById("ui"),o=document.getElementById("menu"),af=document.getElementById("layer_button"),q=document.getElementById("shader_button"),r=document.getElementById("device_button"),L=document.getElementById("layer_grid"),at=document.getElementById("shader_grid"),au=document.getElementById("device_grid"),aq=document.getElementById("fs"),u=document.getElementById("vs"),ay=true,s=null,aA=null,U=null,ab=null,g=null,K=null,Z=null,an=8,n=1,F=0,G=0,j=0,v=0,w=0,Y=0,N=0,k=null,aB=null,am=null,aD=false,z=false,B=[],D=8080,t=8443,aa=null,ap=null;function l(aE){ai&&console.log("WEBSOCKET: CONNECT");if(z&&aa!=null){ai&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");S(aa)}else{C()}}function y(){ai&&console.log("WEBSOCKET: OPEN");socket=this;x()}function h(aF){ai&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+aF.data.toString());var aE=JSON.parse(aF.data.toString());var aH=aE.method;var aG=aE.params;switch(aH){case"set_colors_ack":ap=aG;break;case"get_shaders_ack":ao=aG;break;case"get_devices_ack":A=aG;break;case"get_images_ack":e=aG;break;case"get_webgl_ack":i(aG.vertex_shader,aG.fragment_shader);break;default:}}function I(aE){ai&&console.log("WEBSOCKET: ONCLOSE");ae()}function ad(aE){ai&&console.log("WEBSOCKET: ONERROR")}function c(aF,aE){ai&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+O(aF,aE));if(socket.readyState===socket.OPEN){socket.send(O(aF,aE))}}function O(aG,aF){var aE={method:aG,params:aF};return JSON.stringify(aE)}function C(){try{aD=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var aE=new RTCPeerConnection({iceServers:[]});aE.createDataChannel("");aE.createOffer(aE.setLocalDescription.bind(aE),al);aE.onicecandidate=ar}catch(aF){console.log(aF.message)}}function ar(aE){if(!aE||!aE.candidate||!aE.candidate.candidate){return}var aF=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(aE.candidate.candidate)[1];this.onicecandidate=al;ip=aF.split(".")[0]+"."+aF.split(".")[1]+"."+aF.split(".")[2];setTimeout(Q,5000);scan_counter=0;setTimeout(P,20)}function P(){scan_counter++;if(scan_counter<255){var aE=ip+"."+scan_counter;aw(aE);setTimeout(P,20)}}function al(){}function Q(){ai&&console.log("DISCOVER TIMEOUT");aD=false;if(!z){}}function X(){for(var aE=0;aE<B.length;++aE){B.shift().abort()}}function aw(aE){ak(aE).then(function(aF){S(aF);X()},function(aF){})}function ak(aE){return new Promise(function(aG,aF){try{var aI=new XMLHttpRequest();B.push(aI);aI.ip=aE;aI.timeout=1000;aI.open("GET","http://"+aE+":"+D,true);aI.ontimeout=function(aJ){aF(Error("NA"))};aI.onerror=function(){aF(Error("NA"))};aI.onload=function(aJ){if(aI.readyState===4){if(aI.status===200){console.log("FOUND SERVER: "+this.ip);z=true;aa="ws://"+this.ip+":"+D;aG(aa)}}};aI.send()}catch(aH){console.log(aH.message)}})}function S(aE){try{socket=new WebSocket(aE);socket.onopen=y;socket.onclose=I;socket.onerror=ad;socket.onmessage=function(aG){h(aG)}}catch(aF){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(aF.message)}}function av(){if(ap&&ap.shader_params&&ap.shader_params.width&&ap.shader_params.height&&ap.colors&&ap.colors.data){an=ap.shader_params.width;n=ap.shader_params.height;if(ap.colors){ah=ap.colors.data}}else{an=8;n=8;ah=new Uint8Array(an*n*3).fill(32)}const aF=twgl.createTexture(ab,{width:an,height:n,internalFormat:ab.RGB,min:ab.NEAREST,mag:ab.NEAREST,src:ah});twgl.resizeCanvasToDisplaySize(ab.canvas,window.devicePixelRatio);ab.viewport(0,0,ab.canvas.width,ab.canvas.height);const aE={time:Math.random()/5,canvas_resolution:[ab.canvas.width,ab.canvas.height],texture_resolution:[an,n],tex:aF};if(n*an*3!=ah.length){return}twgl.setUniforms(g,aE);twgl.drawBufferInfo(ab,Z);ab.deleteTexture(aF);requestAnimationFrame(av)}function az(){ap=null}"use strict";function ac(aE){}m();function m(){ai&&console.log("UI INIT");ax()}function ax(){if(!aj){l("ws://"+T)}}function x(){ai&&console.log("UI CONNECTED");aj=true}function ae(){ai&&console.log("UI DISCONNECTED");aj=false;az();ax()}function i(aF,aE){u.text=aF;aq.text=aE;K={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};ab=document.querySelector("#canvas").getContext("webgl");g=twgl.createProgramInfo(ab,["vs","fs"]);Z=twgl.createBufferInfoFromArrays(ab,K);ab.useProgram(g.program);twgl.setBuffersAndAttributes(ab,g,Z);requestAnimationFrame(av)}function ag(aH){var aE=this.getRowValues(aH);aE.name=aE.name;var aG=0;for(var aF=0;aF<this.getRowCount();aF++){aG=Math.max(aG,parseInt(this.getRowId(aF))+1)}this.insertAfter(aH,aG,aE)}function J(){ay=!ay;if(ay){H.style.display="none";aC.style.opacity=1;show_button.innerHTML="<B>SHOW</B>";af.style.display="none";q.style.display="none";r.style.display="none"}else{H.style.display="inline-block";aC.style.opacity=0.5;show_button.innerHTML="<B>HIDE</B>";af.style.display="block";q.style.display="block";r.style.display="block"}}function R(){s=new EditableGrid("Layers");s.tableLoaded=function(){s.duplicate=ag;this.setCellRenderer("action",new CellRenderer({render:function(aE,aF){var aG=s.getRowId(aE.rowIndex);aE.innerHTML='<a onclick="if (layerGrid.data.length>1) layerGrid.remove('+aE.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';aE.innerHTML+='&nbsp;<a onclick="layerGrid.duplicate('+aE.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("layer_grid","grid")};s.loadJSON("data/layers.json");aA=new EditableGrid("Shaders");aA.tableLoaded=function(){aA.duplicate=ag;this.setCellRenderer("action",new CellRenderer({render:function(aE,aF){var aG=aA.getRowId(aE.rowIndex);aE.innerHTML='<a onclick="if (shaderGrid.data.length>1) shaderGrid.remove('+aE.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';aE.innerHTML+='&nbsp;<a onclick="shaderGrid.duplicate('+aE.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("shader_grid","grid")};aA.loadJSON("data/shaders.json");U=new EditableGrid("Devices");U.tableLoaded=function(){U.duplicate=ag;this.setCellRenderer("action",new CellRenderer({render:function(aE,aF){var aG=U.getRowId(aE.rowIndex);aE.innerHTML='<a onclick="if (deviceGrid.data.length>1) deviceGrid.remove('+aE.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';aE.innerHTML+='&nbsp;<a onclick="deviceGrid.duplicate('+aE.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("device_grid","grid")};U.loadJSON("data/devices.json");if(window.location.hostname==="standard3d.com"){o.style.display="none"}show_button.style.display="block";show_button.onclick=J;af.onclick=E;q.onclick=f;r.onclick=V;E()}function E(){af.style.color="white";L.style.display="block";q.style.color="gray";at.style.display="none";r.style.color="gray";au.style.display="none"}function f(){af.style.color="gray";L.style.display="none";q.style.color="white";at.style.display="block";r.style.color="gray";au.style.display="none"}function V(){af.style.color="gray";L.style.display="none";q.style.color="gray";at.style.display="none";r.style.color="white";au.style.display="block"}R()};