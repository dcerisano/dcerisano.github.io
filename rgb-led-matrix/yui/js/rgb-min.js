function rgb_led_matrix_init(){var ac=false,l=1,K=false,ad=false,R=1,ab=null,a=true,ag=document.getElementById("server_name"),au=document.getElementById("canvas"),F=document.getElementById("ui"),k=document.getElementById("menu"),aw=document.getElementById("show_button"),aa=document.getElementById("server_button"),Z=document.getElementById("layer_button"),m=document.getElementById("shader_button"),n=document.getElementById("device_button"),b=document.getElementById("connect_button"),ak=document.getElementById("fs"),p=document.getElementById("vs"),ap=true,V=null,d=null,I=null,U=null,ai=8,j=1,D=0,E=0,g=0,r=0,s=0,T=0,L=0,h=null,at=null,ah=null,av=false,v=false,x=[],A=8080,o=8443,y=[],aj=null,q=[],w=0;function B(){ac&&console.log("WEBSOCKET: CONNECT");if(v&&websocket!=null){ac&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");P(websocket)}else{z()}}function t(){ac&&console.log("WEBSOCKET: OPEN");u();this.send(json("get_webgl_req"));this.send(json("get_info_req"))}function e(az){ac&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+az.data.toString());var ay=(servers.data[selected_server].values.address==new URL(az.origin).hostname);var ax=JSON.parse(az.data.toString());var aB=ax.method;var aA=ax.params;switch(aB){case"get_info_ack":J(aA);break;case"set_colors_ack":if(ay){aj=aA}break;case"get_data_ack":if(ay){get_data_ack(aA)}break;case"get_webgl_ack":if(ay){f(aA.vertex_shader,aA.fragment_shader)}break;default:}}function G(ax){ac&&console.log("WEBSOCKET: ONCLOSE");Y()}function X(ax){ac&&console.log("WEBSOCKET: ONERROR")}function z(){try{av=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var ax=new RTCPeerConnection({iceServers:[]});ax.createDataChannel("");ax.createOffer(ax.setLocalDescription.bind(ax),af);ax.onicecandidate=al}catch(ay){console.log(ay.message)}}function al(ax){if(!ax||!ax.candidate||!ax.candidate.candidate){return}var ay=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ax.candidate.candidate)[1];this.onicecandidate=af;ip=ay.split(".")[0]+"."+ay.split(".")[1]+"."+ay.split(".")[2];setTimeout(N,5000);scan_counter=0;setTimeout(M,20)}function M(){scan_counter++;if(scan_counter<255){var ax=ip+"."+scan_counter;an(ax);setTimeout(M,20)}}function af(){}function N(){ac&&console.log("DISCOVER TIMEOUT");av=false;if(!v){}}function S(){for(var ax=0;ax<x.length;++ax){x.shift().abort()}}function an(ax){ae(ax).then(function(ay){P(ay);S()},function(ay){})}function ae(ax){return new Promise(function(az,ay){try{var aB=new XMLHttpRequest();x.push(aB);aB.ip=ax;aB.timeout=1000;aB.open("GET","http://"+ax+":"+A,true);aB.ontimeout=function(aC){ay(Error("NA"))};aB.onerror=function(){ay(Error("NA"))};aB.onload=function(aD){if(aB.readyState===4){if(aB.status===200){console.log("FOUND SERVER: "+this.ip);v=true;var aC={};aC.ws="ws://"+this.ip+":"+A;aC.ip=this.ip;az(aC)}}};aB.send()}catch(aA){"XHR:"+console.log(aA.message)}})}function P(ay){try{var ax=new WebSocket(ay.ws);ax.onopen=t;ax.onclose=G;ax.onerror=X;ax.onmessage=function(aA){e(aA)};servers.data[w]={};servers.data[w].socket=ax;servers.data[w].id=w+1;servers.data[w].values={};servers.data[w].values.address=ay.ip;if(w==0){servers.data[w].values.selected=true}w++}catch(az){console.log("DISCOVERY ERROR");console.log(az.message)}}function J(ay){for(var ax=0;ax<w;ax++){if(ay.ip===servers.data[ax].values.address){servers.data[ax].values.hostname=ay.hostname;servers.data[ax].values.platform=ay.platform;servers.data[ax].values.status=ay.status}}serverGrid.processJSON(servers);serverGrid.tableLoaded();ag.innerHTML="Configuring: "+servers.data[selected_server].values.hostname}function am(){if(aj&&aj.shader_params&&aj.shader_params.width&&aj.shader_params.height&&aj.colors&&aj.colors.data&&aj.shader_params.width*aj.shader_params.height*3==aj.colors.data.length){ai=aj.shader_params.width;j=aj.shader_params.height;ab=aj.colors.data;const ay=twgl.createTexture(V,{width:ai,height:j,internalFormat:V.RGB,min:V.NEAREST,mag:V.NEAREST,src:ab});twgl.resizeCanvasToDisplaySize(V.canvas,window.devicePixelRatio);V.viewport(0,0,V.canvas.width,V.canvas.height);const ax={time:Math.random()/5,canvas_resolution:[V.canvas.width,V.canvas.height],texture_resolution:[ai,j],tex:ay};if(j*ai*3!=ab.length){return}twgl.setUniforms(d,ax);twgl.drawBufferInfo(V,U);V.deleteTexture(ay)}requestAnimationFrame(am)}function ar(){aj=null}function W(ax){}function i(){ac&&console.log("UI INIT");ao()}function ao(){aw.style.color="red";if(!ad){B()}}function u(){ac&&console.log("UI CONNECTED");ad=true;aw.style.color="green";socket_send(selected_server,"get_data_req",null)}function Y(){ac&&console.log("UI DISCONNECTED");ap=false;H();ad=false;ar();ao()}function f(ay,ax){p.text=ay;ak.text=ax;I={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};V=document.querySelector("#canvas").getContext("webgl");d=twgl.createProgramInfo(V,["vs","fs"]);U=twgl.createBufferInfoFromArrays(V,I);V.useProgram(d.program);twgl.setBuffersAndAttributes(V,d,U);requestAnimationFrame(am)}function H(){if(!ad){return}ap=!ap;if(ap){F.style.display="none";au.style.opacity=1;aw.innerHTML="<B>Show</B>";aa.style.display="none";Z.style.display="none";m.style.display="none";n.style.display="none"}else{F.style.display="inline-block";au.style.opacity=0.5;aw.innerHTML="<B>Hide</B>";aa.style.display="block";Z.style.display="block";m.style.display="block";n.style.display="block"}}function O(){init_grids();aw.style.display="block";aw.onclick=H;aa.onclick=aq;Z.onclick=C;m.onclick=c;n.onclick=Q;aq()}function aq(){aa.style.color="white";server_grid.style.display="block";Z.style.color="gray";layer_grid.style.display="none";m.style.color="gray";shader_grid.style.display="none";n.style.color="gray";device_grid.style.display="none"}function C(){aa.style.color="gray";server_grid.style.display="none";Z.style.color="white";layer_grid.style.display="block";m.style.color="gray";shader_grid.style.display="none";n.style.color="gray";device_grid.style.display="none"}function c(){aa.style.color="gray";server_grid.style.display="none";m.style.color="white";shader_grid.style.display="block";Z.style.color="gray";layer_grid.style.display="none";n.style.color="gray";device_grid.style.display="none"}function Q(){aa.style.color="gray";server_grid.style.display="none";Z.style.color="gray";layer_grid.style.display="none";m.style.color="gray";shader_grid.style.display="none";n.style.color="white";device_grid.style.display="block"}O();i()};