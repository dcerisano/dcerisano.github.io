function init(){rgb_led_matrix_init()}function rgb_led_matrix_init(){var J=false,v=null,D=null,k=null,ah={},m={},G="localhost:8080",W=null,Z=1,s=false,B=false,V=1,P=null,o=document.getElementById("emulator"),M=document.getElementById("ui"),af=o.getContext("2d"),b=8,e=1,U=0,q=0,A=0,ae=0,T=0,h=0,f=0,ab=null,p=null,d=null,x=false,K=[],R=8080,I=null;function N(ai,ak,aj){J&&console.log("WEBSOCKET: CONNECT");l()}function X(){J&&console.log("WEBSOCKET: OPEN");socket=this;t()}function H(aj){J&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+aj.data.toString());var ai=JSON.parse(aj.data.toString());var al=ai.method;var ak=ai.params;switch(al){case"set_colors_ack":u(ak);ad(ak);break;case"get_shaders_ack":v=ak;break;case"get_controllers_ack":D=ak;break;case"get_images_ack":k=ak;break;default:}}function y(ai){J&&console.log("WEBSOCKET: ONCLOSE");W=null;L()}function n(ai){J&&console.log("WEBSOCKET: ONERROR")}function F(aj,ai){J&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+S(aj,ai));if(socket.readyState===socket.OPEN){socket.send(S(aj,ai))}}function S(ak,aj){var ai={method:ak,params:aj};return JSON.stringify(ai)}function l(){try{x=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var ai=new RTCPeerConnection({iceServers:[]});ai.createDataChannel("");ai.createOffer(ai.setLocalDescription.bind(ai),aa);ai.onicecandidate=Q}catch(aj){console.log(aj.message)}}function Q(ai){if(!ai||!ai.candidate||!ai.candidate.candidate){return}var aj=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ai.candidate.candidate)[1];this.onicecandidate=aa;I=aj.split(".")[0]+"."+aj.split(".")[1]+"."+aj.split(".")[2];setTimeout(O,5000);scan_counter=0;setTimeout(ac,20)}function ac(){scan_counter++;if(scan_counter<255){var ai=I+"."+scan_counter;r(ai);setTimeout(ac,20)}}function aa(){}function O(){J&&console.log("DISCOVER TIMEOUT");x=false;if(!discovered){vrip360studio.style.opacity="1";vrip360logo.style.display="none";spinner.style.display="none";showPlayerNotFound();$("#internal_power_button").toggleClass("on",false)}}function r(ai){Y(ai).then(function(aj){z(aj);abort()},function(aj){})}function Y(ai){return new Promise(function(ak,aj){try{var am=new XMLHttpRequest();K.push(am);am.ip=ai;am.timeout=1000;am.open("GET","http://"+ai+":"+R,true);am.ontimeout=function(an){aj(Error("NA"))};am.onerror=function(){aj(Error("NA"))};am.onload=function(an){if(am.readyState===4){if(am.status===200){console.log("FOUND SERVER: "+this.ip);ak("ws://"+this.ip+":"+R)}}};am.send()}catch(al){console.log(al.message)}})}function z(ai){try{socket=new WebSocket(ai);socket.onopen=X;socket.onclose=y;socket.onerror=n;socket.onmessage=function(ak){H(ak)}}catch(aj){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(aj.message)}}function ad(ai){}function ag(){if(!v||!D){while(V--){clearTimeout(V)}V=setTimeout(ag,100);return}ah={};m={};ah.shader=v[Math.floor(Math.random()*v.length)];ah.width=Math.floor(Math.random()*15+1);ah.height=Math.floor(Math.random()*15+1);ah.shader="ambilight";if(ah.shader=="notifier"){ah.image=k[Math.floor(Math.random()*k.length)];ah.width=8;ah.height=1}if(ah.shader=="cpu_meter"){ah.pwm_path="/sys/class/hwmon/hwmon0/pwm3";ah.width=8;ah.height=1}if(ah.shader=="ambilight"){ah.width=16;ah.height=9;ah.cropx=0.56;ah.cropy=0.3;ah.cropw=0.44;ah.croph=0.7}if(ah.shader=="plasma"){ah.width=64;ah.height=36;ah.scale=(ah.width+ah.height)/10}F("set_shader_req",ah);ad()}E();function E(){J&&console.log("UI INIT");w()}function w(){if(!B){N("ws://"+G,t,L)}}function t(){J&&console.log("UI CONNECTED");B=true;ag()}function L(){J&&console.log("UI DISCONNECTED");B=false;u(null);w()}function u(aj){if(aj&&aj.shader_params&&aj.shader_params.width&&aj.shader_params.height&&aj.colors&&aj.colors.data){b=aj.shader_params.width;e=aj.shader_params.height;if(aj.colors){P=aj.colors.data}}else{b=8;e=1;P=new Uint8Array(24).fill(0)}c(aj);J&&console.log("drawMatrix");if(e*b*3!=P.length){return}for(i=0;i<b;i++){for(j=0;j<e;j++){var ai=A*(i+1),ak=ae*(j+1);g(ai,ak,T,C(i,j))}}}function c(){J&&console.log("resizeMatrix");U=window.innerWidth;q=window.innerHeight;h=0;f=0;o.width=U;o.height=q;o.style.width=U;o.style.height=q;A=U/(b+1);ae=q/(e+1);if(A>ae){A=ae}else{ae=A}f=(q-ae*(e+1))/2;h=(U-A*(b+1))/2;T=A*0.4}function C(aj,am){var al=P[(am*b+aj)*3+0],ak=P[(am*b+aj)*3+1],ai=P[(am*b+aj)*3+2];if(typeof al!=="undefined"&&ak!=="undefined"&&ai!=="undefined"){return"rgba("+al+","+ak+","+ai+",1)"}else{return null}}function g(aj,al,ai,ak){if(ak){af.beginPath();af.arc(aj+h,al+f,ai,0,2*Math.PI,false);af.fillStyle=ak;af.fill();af.lineWidth=1;af.strokeStyle="#101010";af.stroke()}}document.getElementsByTagName("BODY")[0].onresize=u;document.getElementsByTagName("BODY")[0].onclick=a;function a(){document.getElementsByTagName("BODY")[0].webkitRequestFullscreen()}};