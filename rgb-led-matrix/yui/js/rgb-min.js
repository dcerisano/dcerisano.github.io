function rgb_led_matrix_init(){var ad=false,ak=null,y=null,e=null,a={},b={},Q="localhost:8080",W=null,p=1,J=false,ae=false,S=1,ac=null,d=true,av=document.getElementById("canvas"),F=document.getElementById("ui"),o=document.getElementById("menu"),am=document.getElementById("fs"),s=document.getElementById("vs"),ar=true,q=null,ah=null,X=null,g=null,I=null,V=null,aj=8,n=1,D=0,E=0,j=0,t=0,u=0,U=0,K=0,k=null,au=null,ai=null,aw=false,x=false,z=[],B=8080,r=8443,W=null,al=null;function l(ax){ad&&console.log("WEBSOCKET: CONNECT");if(x&&W!=null){ad&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");P(W)}else{A()}}function v(){ad&&console.log("WEBSOCKET: OPEN");socket=this;w()}function h(ay){ad&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+ay.data.toString());var ax=JSON.parse(ay.data.toString());var aA=ax.method;var az=ax.params;switch(aA){case"set_colors_ack":al=az;break;case"get_shaders_ack":ak=az;break;case"get_devices_ack":y=az;break;case"get_images_ack":e=az;break;case"get_webgl_ack":i(az.vertex_shader,az.fragment_shader);break;default:}}function G(ax){ad&&console.log("WEBSOCKET: ONCLOSE");aa()}function Z(ax){ad&&console.log("WEBSOCKET: ONERROR")}function c(ay,ax){ad&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+L(ay,ax));if(socket.readyState===socket.OPEN){socket.send(L(ay,ax))}}function L(az,ay){var ax={method:az,params:ay};return JSON.stringify(ax)}function A(){try{aw=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var ax=new RTCPeerConnection({iceServers:[]});ax.createDataChannel("");ax.createOffer(ax.setLocalDescription.bind(ax),ag);ax.onicecandidate=an}catch(ay){console.log(ay.message)}}function an(ax){if(!ax||!ax.candidate||!ax.candidate.candidate){return}var ay=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ax.candidate.candidate)[1];this.onicecandidate=ag;ip=ay.split(".")[0]+"."+ay.split(".")[1]+"."+ay.split(".")[2];setTimeout(N,5000);scan_counter=0;setTimeout(M,20)}function M(){scan_counter++;if(scan_counter<255){var ax=ip+"."+scan_counter;ap(ax);setTimeout(M,20)}}function ag(){}function N(){ad&&console.log("DISCOVER TIMEOUT");aw=false;if(!x){}}function T(){for(var ax=0;ax<z.length;++ax){z.shift().abort()}}function ap(ax){af(ax).then(function(ay){P(ay);T()},function(ay){})}function af(ax){return new Promise(function(az,ay){try{var aB=new XMLHttpRequest();z.push(aB);aB.ip=ax;aB.timeout=1000;aB.open("GET","http://"+ax+":"+B,true);aB.ontimeout=function(aC){ay(Error("NA"))};aB.onerror=function(){ay(Error("NA"))};aB.onload=function(aC){if(aB.readyState===4){if(aB.status===200){console.log("FOUND SERVER: "+this.ip);x=true;W="ws://"+this.ip+":"+B;az(W)}}};aB.send()}catch(aA){console.log(aA.message)}})}function P(ax){try{socket=new WebSocket(ax);socket.onopen=v;socket.onclose=G;socket.onerror=Z;socket.onmessage=function(az){h(az)}}catch(ay){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(ay.message)}}function Y(ax){}m();function m(){ad&&console.log("UI INIT");aq()}function aq(){if(!ae){l("ws://"+Q)}}function w(){ad&&console.log("UI CONNECTED");ae=true}function aa(){ad&&console.log("UI DISCONNECTED");ae=false;at();aq()}function i(ay,ax){s.text=ay;am.text=ax;I={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};X=document.querySelector("#canvas").getContext("webgl");g=twgl.createProgramInfo(X,["vs","fs"]);V=twgl.createBufferInfoFromArrays(X,I);X.useProgram(g.program);twgl.setBuffersAndAttributes(X,g,V);requestAnimationFrame(ao)}function ab(aA){var ax=this.getRowValues(aA);ax.name=ax.name;var az=0;for(var ay=0;ay<this.getRowCount();ay++){az=Math.max(az,parseInt(this.getRowId(ay))+1)}this.insertAfter(aA,az,ax)}function H(){ar=!ar;if(ar){F.style.display="none";av.style.opacity=1;show_button.innerHTML="<B>SHOW</B>";layer_button.style.display="none";shader_button.style.display="none";device_button.style.display="none"}else{F.style.display="inline-block";av.style.opacity=0.5;show_button.innerHTML="<B>HIDE</B>";layer_button.style.display="block";shader_button.style.display="block";device_button.style.display="block"}}function O(){q=new EditableGrid("Layers");q.tableLoaded=function(){q.duplicate=ab;this.setCellRenderer("action",new CellRenderer({render:function(ax,ay){var az=q.getRowId(ax.rowIndex);ax.innerHTML='<a onclick="if (layerGrid.data.length>1) layerGrid.remove('+ax.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ax.innerHTML+='&nbsp;<a onclick="layerGrid.duplicate('+ax.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("layer_grid","grid")};q.loadJSON("data/layers.json");shaderGrid=new EditableGrid("Shaders");shaderGrid.tableLoaded=function(){shaderGrid.duplicate=ab;this.setCellRenderer("action",new CellRenderer({render:function(ax,ay){var az=shaderGrid.getRowId(ax.rowIndex);ax.innerHTML='<a onclick="if (shaderGrid.data.length>1) shaderGrid.remove('+ax.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ax.innerHTML+='&nbsp;<a onclick="shaderGrid.duplicate('+ax.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("shader_grid","grid")};shaderGrid.loadJSON("data/shaders.json");deviceGrid=new EditableGrid("Devices");deviceGrid.tableLoaded=function(){deviceGrid.duplicate=ab;this.setCellRenderer("action",new CellRenderer({render:function(ax,ay){var az=deviceGrid.getRowId(ax.rowIndex);ax.innerHTML='<a onclick="if (deviceGrid.data.length>1) deviceGrid.remove('+ax.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ax.innerHTML+='&nbsp;<a onclick="deviceGrid.duplicate('+ax.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("device_grid","grid")};deviceGrid.loadJSON("data/devices.json");if(window.location.hostname==="standard3d.com"){o.style.display="none"}show_button.style.display="block";show_button.onclick=H;layer_button.onclick=C;shader_button.onclick=f;device_button.onclick=R;C()}function C(){layer_button.style.color="white";layer_grid.style.display="block";shader_button.style.color="gray";shader_grid.style.display="none";device_button.style.color="gray";device_grid.style.display="none"}function f(){layer_button.style.color="gray";layer_grid.style.display="none";shader_button.style.color="white";shader_grid.style.display="block";device_button.style.color="gray";device_grid.style.display="none"}function R(){layer_button.style.color="gray";layer_grid.style.display="none";shader_button.style.color="gray";shader_grid.style.display="none";device_button.style.color="white";device_grid.style.display="block"}O();function ao(){if(al&&al.shader_params&&al.shader_params.width&&al.shader_params.height&&al.colors&&al.colors.data){aj=al.shader_params.width;n=al.shader_params.height;if(al.colors){ac=al.colors.data}}else{aj=8;n=8;ac=new Uint8Array(aj*n*3).fill(32)}const ay=twgl.createTexture(X,{width:aj,height:n,internalFormat:X.RGB,min:X.NEAREST,mag:X.NEAREST,src:ac});twgl.resizeCanvasToDisplaySize(X.canvas,window.devicePixelRatio);X.viewport(0,0,X.canvas.width,X.canvas.height);const ax={time:Math.random()/5,canvas_resolution:[X.canvas.width,X.canvas.height],texture_resolution:[aj,n],tex:ay};if(n*aj*3!=ac.length){return}twgl.setUniforms(g,ax);twgl.drawBufferInfo(X,V);X.deleteTexture(ay);requestAnimationFrame(ao)}function at(){al=null}};