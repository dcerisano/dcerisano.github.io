function rgb_led_matrix_init(){var ai=false,ao=null,A=null,e=null,a={},b={},T="localhost:8080",aa=null,p=1,M=false,aj=false,W=1,ah=null,d=true,aC=document.getElementById("canvas"),H=document.getElementById("ui"),o=document.getElementById("menu"),aE=document.getElementById("show_button"),af=document.getElementById("layer_button"),q=document.getElementById("shader_button"),r=document.getElementById("device_button"),L=document.getElementById("layer_grid"),at=document.getElementById("shader_grid"),au=document.getElementById("device_grid"),aq=document.getElementById("fs"),u=document.getElementById("vs"),ay=true,s=null,aA=null,U=null,ab=null,g=null,K=null,Z=null,an=8,n=1,F=0,G=0,j=0,v=0,w=0,Y=0,N=0,k=null,aB=null,am=null,aD=false,z=false,B=[],D=8080,t=8443,aa=null,ap=null;function l(aF){ai&&console.log("WEBSOCKET: CONNECT");if(z&&aa!=null){ai&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");S(aa)}else{C()}}function y(){ai&&console.log("WEBSOCKET: OPEN");socket=this;x()}function h(aG){ai&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+aG.data.toString());var aF=JSON.parse(aG.data.toString());var aI=aF.method;var aH=aF.params;switch(aI){case"set_colors_ack":ap=aH;break;case"get_shaders_ack":ao=aH;break;case"get_devices_ack":A=aH;break;case"get_images_ack":e=aH;break;case"get_webgl_ack":i(aH.vertex_shader,aH.fragment_shader);break;default:}}function I(aF){ai&&console.log("WEBSOCKET: ONCLOSE");ae()}function ad(aF){ai&&console.log("WEBSOCKET: ONERROR")}function c(aG,aF){ai&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+O(aG,aF));if(socket.readyState===socket.OPEN){socket.send(O(aG,aF))}}function O(aH,aG){var aF={method:aH,params:aG};return JSON.stringify(aF)}function C(){try{aD=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var aF=new RTCPeerConnection({iceServers:[]});aF.createDataChannel("");aF.createOffer(aF.setLocalDescription.bind(aF),al);aF.onicecandidate=ar}catch(aG){console.log(aG.message)}}function ar(aF){if(!aF||!aF.candidate||!aF.candidate.candidate){return}var aG=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(aF.candidate.candidate)[1];this.onicecandidate=al;ip=aG.split(".")[0]+"."+aG.split(".")[1]+"."+aG.split(".")[2];setTimeout(Q,5000);scan_counter=0;setTimeout(P,20)}function P(){scan_counter++;if(scan_counter<255){var aF=ip+"."+scan_counter;aw(aF);setTimeout(P,20)}}function al(){}function Q(){ai&&console.log("DISCOVER TIMEOUT");aD=false;if(!z){}}function X(){for(var aF=0;aF<B.length;++aF){B.shift().abort()}}function aw(aF){ak(aF).then(function(aG){S(aG);X()},function(aG){})}function ak(aF){return new Promise(function(aH,aG){try{var aJ=new XMLHttpRequest();B.push(aJ);aJ.ip=aF;aJ.timeout=1000;aJ.open("GET","http://"+aF+":"+D,true);aJ.ontimeout=function(aK){aG(Error("NA"))};aJ.onerror=function(){aG(Error("NA"))};aJ.onload=function(aK){if(aJ.readyState===4){if(aJ.status===200){console.log("FOUND SERVER: "+this.ip);z=true;aa="ws://"+this.ip+":"+D;aH(aa)}}};aJ.send()}catch(aI){console.log(aI.message)}})}function S(aF){try{socket=new WebSocket(aF);socket.onopen=y;socket.onclose=I;socket.onerror=ad;socket.onmessage=function(aH){h(aH)}}catch(aG){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(aG.message)}}function av(){if(ap&&ap.shader_params&&ap.shader_params.width&&ap.shader_params.height&&ap.colors&&ap.colors.data){an=ap.shader_params.width;n=ap.shader_params.height;if(ap.colors){ah=ap.colors.data}}else{an=8;n=8;ah=new Uint8Array(an*n*3).fill(32)}const aG=twgl.createTexture(ab,{width:an,height:n,internalFormat:ab.RGB,min:ab.NEAREST,mag:ab.NEAREST,src:ah});twgl.resizeCanvasToDisplaySize(ab.canvas,window.devicePixelRatio);ab.viewport(0,0,ab.canvas.width,ab.canvas.height);const aF={time:Math.random()/5,canvas_resolution:[ab.canvas.width,ab.canvas.height],texture_resolution:[an,n],tex:aG};if(n*an*3!=ah.length){return}twgl.setUniforms(g,aF);twgl.drawBufferInfo(ab,Z);ab.deleteTexture(aG);requestAnimationFrame(av)}function az(){ap=null}"use strict";function ac(aF){}m();function m(){ai&&console.log("UI INIT");ax()}function ax(){if(!aj){l("ws://"+T)}}function x(){ai&&console.log("UI CONNECTED");aj=true}function ae(){ai&&console.log("UI DISCONNECTED");aj=false;az();ax()}function i(aG,aF){u.text=aG;aq.text=aF;K={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};ab=document.querySelector("#canvas").getContext("webgl");g=twgl.createProgramInfo(ab,["vs","fs"]);Z=twgl.createBufferInfoFromArrays(ab,K);ab.useProgram(g.program);twgl.setBuffersAndAttributes(ab,g,Z);requestAnimationFrame(av)}function ag(aI){var aF=this.getRowValues(aI);aF.name=aF.name;var aH=0;for(var aG=0;aG<this.getRowCount();aG++){aH=Math.max(aH,parseInt(this.getRowId(aG))+1)}this.insertAfter(aI,aH,aF)}function J(){ay=!ay;if(ay){H.style.display="none";aC.style.opacity=1;aE.innerHTML="<B>SHOW</B>";af.style.display="none";q.style.display="none";r.style.display="none"}else{H.style.display="inline-block";aC.style.opacity=0.5;aE.innerHTML="<B>HIDE</B>";af.style.display="block";q.style.display="block";r.style.display="block"}}function R(){s=new EditableGrid("Layers");s.tableLoaded=function(){s.duplicate=ag;this.setCellRenderer("action",new CellRenderer({render:function(aF,aG){var aH=s.getRowId(aF.rowIndex);aF.innerHTML='<a onclick="if (layerGrid.data.length>1) layerGrid.remove('+aF.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';aF.innerHTML+='&nbsp;<a onclick="layerGrid.duplicate('+aF.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("layer_grid","grid")};s.loadJSON("data/layers.json");aA=new EditableGrid("Shaders");aA.tableLoaded=function(){aA.duplicate=ag;this.setCellRenderer("action",new CellRenderer({render:function(aF,aG){var aH=aA.getRowId(aF.rowIndex);aF.innerHTML='<a onclick="if (shaderGrid.data.length>1) shaderGrid.remove('+aF.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';aF.innerHTML+='&nbsp;<a onclick="shaderGrid.duplicate('+aF.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("shader_grid","grid")};aA.loadJSON("data/shaders.json");U=new EditableGrid("Devices");U.tableLoaded=function(){U.duplicate=ag;this.setCellRenderer("action",new CellRenderer({render:function(aF,aG){var aH=U.getRowId(aF.rowIndex);aF.innerHTML='<a onclick="if (deviceGrid.data.length>1) deviceGrid.remove('+aF.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';aF.innerHTML+='&nbsp;<a onclick="deviceGrid.duplicate('+aF.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("device_grid","grid")};U.loadJSON("data/devices.json");aE.style.display="block";aE.onclick=J;af.onclick=E;q.onclick=f;r.onclick=V;E()}function E(){af.style.color="white";L.style.display="block";q.style.color="gray";at.style.display="none";r.style.color="gray";au.style.display="none"}function f(){af.style.color="gray";L.style.display="none";q.style.color="white";at.style.display="block";r.style.color="gray";au.style.display="none"}function V(){af.style.color="gray";L.style.display="none";q.style.color="gray";at.style.display="none";r.style.color="white";au.style.display="block"}R()};