function rgb_led_matrix_init(){var L=false,w=null,K=null,h=null,al={},o={},I="localhost:8080",aa=null,ac=1,s=false,C=false,X=1,R=null,m=document.getElementById("emulator"),O=document.getElementById("ui"),v=true,F=null,D=null,aj=m.getContext("2d"),a=8,d=1,W=0,q=0,B=0,ai=0,V=0,g=0,e=0,af=null,n=null,c=null,z=false,ak=false,M=[],T=8080,aa=null;function P(am,ao,an){L&&console.log("WEBSOCKET: CONNECT");if(ak&&aa!=null){L&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");p(aa)}else{k()}}function Z(){L&&console.log("WEBSOCKET: OPEN");socket=this;t()}function J(an){L&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+an.data.toString());var am=JSON.parse(an.data.toString());var ap=am.method;var ao=am.params;switch(ap){case"set_colors_ack":u(ao);ah(ao);break;case"get_shaders_ack":w=ao;break;case"get_devices_ack":K=ao;break;case"get_images_ack":h=ao;break;default:}}function A(am){L&&console.log("WEBSOCKET: ONCLOSE");N()}function l(am){L&&console.log("WEBSOCKET: ONERROR")}function H(an,am){L&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+U(an,am));if(socket.readyState===socket.OPEN){socket.send(U(an,am))}}function U(ao,an){var am={method:ao,params:an};return JSON.stringify(am)}function k(){try{z=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var am=new RTCPeerConnection({iceServers:[]});am.createDataChannel("");am.createOffer(am.setLocalDescription.bind(am),ad);am.onicecandidate=S}catch(an){console.log(an.message)}}function S(am){if(!am||!am.candidate||!am.candidate.candidate){return}var an=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(am.candidate.candidate)[1];this.onicecandidate=ad;ip=an.split(".")[0]+"."+an.split(".")[1]+"."+an.split(".")[2];setTimeout(Q,5000);scan_counter=0;setTimeout(ag,20)}function ag(){scan_counter++;if(scan_counter<255){var am=ip+"."+scan_counter;r(am);setTimeout(ag,20)}}function ad(){}function Q(){L&&console.log("DISCOVER TIMEOUT");z=false;if(!ak){}}function y(){for(var am=0;am<M.length;++am){M.shift().abort()}}function r(am){ab(am).then(function(an){p(an);y()},function(an){})}function ab(am){return new Promise(function(ao,an){try{var aq=new XMLHttpRequest();M.push(aq);aq.ip=am;aq.timeout=1000;aq.open("GET","http://"+am+":"+T,true);aq.ontimeout=function(ar){an(Error("NA"))};aq.onerror=function(){an(Error("NA"))};aq.onload=function(ar){if(aq.readyState===4){if(aq.status===200){console.log("FOUND SERVER: "+this.ip);ak=true;aa="ws://"+this.ip+":"+T;ao(aa)}}};aq.send()}catch(ap){console.log(ap.message)}})}function p(am){try{socket=new WebSocket(am);socket.onopen=Z;socket.onclose=A;socket.onerror=l;socket.onmessage=function(ao){J(ao)}}catch(an){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(an.message)}}function ah(am){}G();function G(){L&&console.log("UI INIT");x()}function x(){if(!C){P("ws://"+I,t,N)}}function t(){L&&console.log("UI CONNECTED");C=true}function N(){L&&console.log("UI DISCONNECTED");C=false;u(null);x()}function Y(){document.getElementsByTagName("BODY")[0].onresize=u;O=document.getElementById("ui");O.style.display="none";document.onclick=ae;F=new EditableGrid("Layers");F.tableLoaded=function(){this.renderGrid("layers","layer_grid")};F.loadJSON("data/layers.json");D=new EditableGrid("Properties");D.tableLoaded=function(){this.renderGrid("properties","property_grid")};D.loadJSON("data/properties.json")}function ae(){if(location.hostname=="standard3d.com"){return}v=!v;if(v){O.style.display="none"}else{O.style.display="inline-block"}}Y();function u(an){if(an&&an.shader_params&&an.shader_params.width&&an.shader_params.height&&an.colors&&an.colors.data){a=an.shader_params.width;d=an.shader_params.height;if(an.colors){R=an.colors.data}}else{a=8;d=1;R=new Uint8Array(24).fill(0)}b(an);L&&console.log("drawMatrix");if(d*a*3!=R.length){return}for(i=0;i<a;i++){for(j=0;j<d;j++){var am=B*(i+1),ao=ai*(j+1);f(am,ao,V,E(i,j))}}}function b(){L&&console.log("resizeMatrix");W=window.innerWidth;q=window.innerHeight;g=0;e=0;m.width=W;m.height=q;m.style.width=W;m.style.height=q;B=W/(a+1);ai=q/(d+1);if(B>ai){B=ai}else{ai=B}e=(q-ai*(d+1))/2;g=(W-B*(a+1))/2;V=B*0.4}function E(an,aq){var ap=R[(aq*a+an)*3+0],ao=R[(aq*a+an)*3+1],am=R[(aq*a+an)*3+2];if(typeof ap!=="undefined"&&ao!=="undefined"&&am!=="undefined"){return"rgba("+ap+","+ao+","+am+",1)"}else{return null}}function f(an,ap,am,ao){if(ao){aj.beginPath();aj.arc(an+g,ap+e,am,0,2*Math.PI,false);aj.fillStyle=ao;aj.fill();aj.lineWidth=1;aj.strokeStyle="#101010";aj.stroke()}}};