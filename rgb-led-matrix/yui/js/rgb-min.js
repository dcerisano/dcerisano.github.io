function rgb_led_matrix_init(){var O=false,x=null,N=null,g=null,aq={},m={},K="localhost:8080",ae=null,ag=1,r=false,E=false,ab=1,U=null,ap=true,k=document.getElementById("canvas"),R=document.getElementById("ui"),ak=document.getElementById("menu"),I=document.getElementById("fs"),u=document.getElementById("vs"),w=true,G=null,F=null,s=null,q=null,z=null,i=null,a=8,d=1,aa=0,o=0,D=0,an=0,Y=0,f=0,e=0,aj=null,l=null,c=null,B=false,ao=false,P=[],W=8080,ae=null,b=null;function S(ar){O&&console.log("WEBSOCKET: CONNECT");if(ao&&ae!=null){O&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");n(ae)}else{h()}}function ad(){O&&console.log("WEBSOCKET: OPEN");socket=this;t()}function M(at){O&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+at.data.toString());var ar=JSON.parse(at.data.toString());var av=ar.method;var au=ar.params;switch(av){case"set_colors_ack":b=au;break;case"get_shaders_ack":x=au;break;case"get_devices_ack":N=au;break;case"get_images_ack":g=au;break;case"get_webgl_ack":Z(au.vertex_shader,au.fragment_shader);break;default:}}function C(ar){O&&console.log("WEBSOCKET: ONCLOSE");Q()}function j(ar){O&&console.log("WEBSOCKET: ONERROR")}function J(at,ar){O&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+X(at,ar));if(socket.readyState===socket.OPEN){socket.send(X(at,ar))}}function X(au,at){var ar={method:au,params:at};return JSON.stringify(ar)}function h(){try{B=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var ar=new RTCPeerConnection({iceServers:[]});ar.createDataChannel("");ar.createOffer(ar.setLocalDescription.bind(ar),ah);ar.onicecandidate=V}catch(at){console.log(at.message)}}function V(ar){if(!ar||!ar.candidate||!ar.candidate.candidate){return}var at=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ar.candidate.candidate)[1];this.onicecandidate=ah;ip=at.split(".")[0]+"."+at.split(".")[1]+"."+at.split(".")[2];setTimeout(T,5000);scan_counter=0;setTimeout(al,20)}function al(){scan_counter++;if(scan_counter<255){var ar=ip+"."+scan_counter;p(ar);setTimeout(al,20)}}function ah(){}function T(){O&&console.log("DISCOVER TIMEOUT");B=false;if(!ao){}}function A(){for(var ar=0;ar<P.length;++ar){P.shift().abort()}}function p(ar){af(ar).then(function(at){n(at);A()},function(at){})}function af(ar){return new Promise(function(au,at){try{var aw=new XMLHttpRequest();P.push(aw);aw.ip=ar;aw.timeout=1000;aw.open("GET","http://"+ar+":"+W,true);aw.ontimeout=function(ax){at(Error("NA"))};aw.onerror=function(){at(Error("NA"))};aw.onload=function(ax){if(aw.readyState===4){if(aw.status===200){console.log("FOUND SERVER: "+this.ip);ao=true;ae="ws://"+this.ip+":"+W;au(ae)}}};aw.send()}catch(av){console.log(av.message)}})}function n(ar){try{socket=new WebSocket(ar);socket.onopen=ad;socket.onclose=C;socket.onerror=j;socket.onmessage=function(au){M(au)}}catch(at){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(at.message)}}function am(ar){}H();function H(){O&&console.log("UI INIT");y()}function y(){if(!E){S("ws://"+K)}}function t(){O&&console.log("UI CONNECTED");E=true}function Q(){O&&console.log("UI DISCONNECTED");E=false;v(null);y()}function Z(at,ar){u.text=at;I.text=ar;z={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};s=document.querySelector("#canvas").getContext("webgl");q=twgl.createProgramInfo(s,["vs","fs"]);i=twgl.createBufferInfoFromArrays(s,z);s.useProgram(q.program);twgl.setBuffersAndAttributes(s,q,i);requestAnimationFrame(v)}function L(av){var ar=this.getRowValues(av);ar.name=ar.name;var au=0;for(var at=0;at<this.getRowCount();at++){au=Math.max(au,parseInt(this.getRowId(at))+1)}this.insertAfter(av,au,ar)}function ai(){if(window.location.hostname==="standard3d.com"){return}w=!w;if(w){R.style.display="none";k.style.opacity=1;ak.innerHTML="<b>SHOW</b>";ak.style.color="gray"}else{R.style.display="inline-block";k.style.opacity=0.5;ak.innerHTML="<b>HIDE&nbsp;&nbsp;&nbsp;&nbsp;SAVE&nbsp;&nbsp;&nbsp;&nbsp;LOAD&nbsp;&nbsp;&nbsp;&nbsp;UNDO</b>";ak.style.color="white"}}function ac(){G=new EditableGrid("Layers");G.tableLoaded=function(){G.duplicate=L;this.setCellRenderer("action",new CellRenderer({render:function(ar,at){var au=G.getRowId(ar.rowIndex);ar.innerHTML='<a onclick="if (layerGrid.data.length>1) layerGrid.remove('+ar.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ar.innerHTML+='&nbsp;<a onclick="layerGrid.duplicate('+ar.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("layers","grid")};G.loadJSON("data/layers.json");F=new EditableGrid("Properties");F.tableLoaded=function(){F.duplicate=L;this.setCellRenderer("action",new CellRenderer({render:function(ar,at){var au=F.getRowId(ar.rowIndex);ar.innerHTML='<a onclick="if (propertyGrid.data.length>1) propertyGrid.remove('+ar.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ar.innerHTML+='&nbsp;<a onclick="propertyGrid.duplicate('+ar.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("properties","grid")};F.loadJSON("data/properties.json");ak.onclick=ai}ac();function v(){if(b&&b.shader_params&&b.shader_params.width&&b.shader_params.height&&b.colors&&b.colors.data){a=b.shader_params.width;d=b.shader_params.height;if(b.colors){U=b.colors.data}}else{a=8;d=1;U=new Uint8Array(24).fill(0)}const at=twgl.createTexture(s,{width:a,height:d,internalFormat:s.RGB,min:s.NEAREST,mag:s.NEAREST,src:U});twgl.resizeCanvasToDisplaySize(s.canvas);s.viewport(0,0,s.canvas.width,s.canvas.height);const ar={time:Math.random(),canvas_resolution:[s.canvas.width,s.canvas.height],texture_resolution:[a,d],tex:at};if(d*a*3!=U.length){return}twgl.setUniforms(q,ar);twgl.drawBufferInfo(s,i);s.deleteTexture(at);requestAnimationFrame(v)}};