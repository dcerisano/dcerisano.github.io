function rgb_led_matrix_init(){var ac=false,O="localhost:8080",U=null,n=1,H=false,ad=false,Q=1,ab=null,b=true,ar=document.getElementById("canvas"),D=document.getElementById("ui"),m=document.getElementById("menu"),au=document.getElementById("show_button"),Z=document.getElementById("layer_button"),o=document.getElementById("shader_button"),p=document.getElementById("device_button"),c=document.getElementById("connect_button"),aj=document.getElementById("fs"),r=document.getElementById("vs"),ao=true,V=null,e=null,G=null,T=null,ah=8,l=1,B=0,C=0,h=0,s=0,t=0,S=0,I=0,i=null,aq=null,ag=null,at=false,w=false,x=[],z=8080,q=8443,U=null,ai=null;function j(av){ac&&console.log("WEBSOCKET: CONNECT");if(w&&U!=null){ac&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");N(U)}else{y()}}function u(){ac&&console.log("WEBSOCKET: OPEN");socket=this;v()}function f(aw){ac&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+aw.data.toString());var av=JSON.parse(aw.data.toString());var ay=av.method;var ax=av.params;switch(ay){case"set_colors_ack":ai=ax;break;case"get_data_ack":get_data_ack(ax);break;case"get_webgl_ack":g(ax.vertex_shader,ax.fragment_shader);break;default:}}function E(av){ac&&console.log("WEBSOCKET: ONCLOSE");Y()}function X(av){ac&&console.log("WEBSOCKET: ONERROR")}function a(aw,av){ac&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+J(aw,av));if(socket.readyState===socket.OPEN){socket.send(J(aw,av))}}function J(ax,aw){var av={method:ax,params:aw};console.log(JSON.stringify(av));return JSON.stringify(av)}function y(){try{at=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var av=new RTCPeerConnection({iceServers:[]});av.createDataChannel("");av.createOffer(av.setLocalDescription.bind(av),af);av.onicecandidate=ak}catch(aw){console.log(aw.message)}}function ak(av){if(!av||!av.candidate||!av.candidate.candidate){return}var aw=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(av.candidate.candidate)[1];this.onicecandidate=af;ip=aw.split(".")[0]+"."+aw.split(".")[1]+"."+aw.split(".")[2];setTimeout(L,5000);scan_counter=0;setTimeout(K,20)}function K(){scan_counter++;if(scan_counter<255){var av=ip+"."+scan_counter;am(av);setTimeout(K,20)}}function af(){}function L(){ac&&console.log("DISCOVER TIMEOUT");at=false;if(!w){}}function R(){for(var av=0;av<x.length;++av){x.shift().abort()}}function am(av){ae(av).then(function(aw){N(aw);R()},function(aw){})}function ae(av){return new Promise(function(ax,aw){try{var az=new XMLHttpRequest();x.push(az);az.ip=av;az.timeout=1000;az.open("GET","http://"+av+":"+z,true);az.ontimeout=function(aA){aw(Error("NA"))};az.onerror=function(){aw(Error("NA"))};az.onload=function(aA){if(az.readyState===4){if(az.status===200){console.log("FOUND SERVER: "+this.ip);w=true;U="ws://"+this.ip+":"+z;ax(U)}}};az.send()}catch(ay){"XHR:"+console.log(ay.message)}})}function N(av){try{socket=new WebSocket(av);socket.onopen=u;socket.onclose=E;socket.onerror=X;socket.onmessage=function(ax){f(ax)}}catch(aw){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(aw.message)}}function al(){if(ai&&ai.shader_params&&ai.shader_params.width&&ai.shader_params.height&&ai.colors&&ai.colors.data){ah=ai.shader_params.width;l=ai.shader_params.height;if(ai.colors){ab=ai.colors.data}}else{ah=8;l=8;ab=new Uint8Array(ah*l*3).fill(32)}const aw=twgl.createTexture(V,{width:ah,height:l,internalFormat:V.RGB,min:V.NEAREST,mag:V.NEAREST,src:ab});twgl.resizeCanvasToDisplaySize(V.canvas,window.devicePixelRatio);V.viewport(0,0,V.canvas.width,V.canvas.height);const av={time:Math.random()/5,canvas_resolution:[V.canvas.width,V.canvas.height],texture_resolution:[ah,l],tex:aw};if(l*ah*3!=ab.length){return}twgl.setUniforms(e,av);twgl.drawBufferInfo(V,T);V.deleteTexture(aw);requestAnimationFrame(al)}function ap(){ai=null}function W(av){}k();function k(){ac&&console.log("UI INIT");an()}function an(){au.style.color="red";if(!ad){j("ws://"+O)}}function v(){ac&&console.log("UI CONNECTED");ad=true;au.style.color="green";a("get_data_req",null)}function Y(){ac&&console.log("UI DISCONNECTED");ad=false;ap();an()}function g(aw,av){r.text=aw;aj.text=av;G={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};V=document.querySelector("#canvas").getContext("webgl");e=twgl.createProgramInfo(V,["vs","fs"]);T=twgl.createBufferInfoFromArrays(V,G);V.useProgram(e.program);twgl.setBuffersAndAttributes(V,e,T);requestAnimationFrame(al)}function aa(ay){var av=this.getRowValues(ay);av.name=av.name;var ax=0;for(var aw=0;aw<this.getRowCount();aw++){ax=Math.max(ax,parseInt(this.getRowId(aw))+1)}this.insertAfter(ay,ax,av);set_data_req()}function F(){ao=!ao;if(ao){D.style.display="none";ar.style.opacity=1;au.innerHTML="<B>SHOW</B>";Z.style.display="none";o.style.display="none";p.style.display="none"}else{D.style.display="inline-block";ar.style.opacity=0.5;au.innerHTML="<B>HIDE</B>";Z.style.display="block";o.style.display="block";p.style.display="block"}}function M(){au.style.display="block";au.onclick=F;Z.onclick=A;o.onclick=d;p.onclick=P;A()}function A(){Z.style.color="white";layer_grid.style.display="block";o.style.color="gray";shader_grid.style.display="none";p.style.color="gray";device_grid.style.display="none"}function d(){Z.style.color="gray";layer_grid.style.display="none";o.style.color="white";shader_grid.style.display="block";p.style.color="gray";device_grid.style.display="none"}function P(){Z.style.color="gray";layer_grid.style.display="none";o.style.color="gray";shader_grid.style.display="none";p.style.color="white";device_grid.style.display="block"}M()};