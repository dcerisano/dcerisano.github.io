function init(){rgb_led_matrix_init()}function rgb_led_matrix_init(){var DEBUG=false,shaders=null,controllers=null,images=null,shader_params={},controller_params={},webserver="localhost:8080",websocket=null,framerate=1,connecting=false,connected=false,timeout=1,colors=null,canvas=document.getElementById("emulator"),ui=document.getElementById("ui"),layerGrid=null,propertyGrid=null,context=canvas.getContext("2d"),width=8,height=1,canvasWidth=0,canvasHeight=0,gridWidth=0,gridHeight=0,dotRadius=0,xoffset=0,yoffset=0,method=null,onConnect=null,onDisconnect=null,discovering=false,discovered=false,xhrqueue=[],HTTP_PORT=8080,ip=null;function websocket_connect(ws,connect,disconnect){DEBUG&&console.log("WEBSOCKET: CONNECT");discover()}function socket_onopen(){DEBUG&&console.log("WEBSOCKET: OPEN");socket=this;onconnect()}function socket_onmessage(event){DEBUG&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+event.data.toString());var json=JSON.parse(event.data.toString());var method=json.method;var params=json.params;switch(method){case"set_colors_ack":drawMatrix(params);drawUI(params);break;case"get_shaders_ack":shaders=params;break;case"get_controllers_ack":controllers=params;break;case"get_images_ack":images=params;break;default:}}function socket_onclose(e){DEBUG&&console.log("WEBSOCKET: ONCLOSE");websocket=null;ondisconnect()}function socket_onerror(e){DEBUG&&console.log("WEBSOCKET: ONERROR")}function socket_send(method,params){DEBUG&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+json(method,params));if(socket.readyState===socket.OPEN){socket.send(json(method,params))}}function json(method,params){var message={method:method,params:params};return JSON.stringify(message)}function discover(){try{discovering=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var pc=new RTCPeerConnection({iceServers:[]});pc.createDataChannel("");pc.createOffer(pc.setLocalDescription.bind(pc),noop);pc.onicecandidate=onIceCandidate}catch(e){console.log(e.message)}}function onIceCandidate(ice){if(!ice||!ice.candidate||!ice.candidate.candidate){return}var my_ip=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate)[1];this.onicecandidate=noop;ip=my_ip.split(".")[0]+"."+my_ip.split(".")[1]+"."+my_ip.split(".")[2];setTimeout(discover_timeout,5000);scan_counter=0;setTimeout(scan,20)}function scan(){scan_counter++;if(scan_counter<255){var ws=ip+"."+scan_counter;testConnection(ws);setTimeout(scan,20)}}function noop(){}function discover_timeout(){DEBUG&&console.log("DISCOVER TIMEOUT");discovering=false;if(!discovered){}}function abort(){for(var i=0;i<xhrqueue.length;++i){xhrqueue.shift().abort()}}function testConnection(ip){get(ip).then(function(response){discovered_player(response);abort()},function(error){})}function get(ip){return new Promise(function(resolve,reject){try{var xhr=new XMLHttpRequest();xhrqueue.push(xhr);xhr.ip=ip;xhr.timeout=1000;xhr.open("GET","http://"+ip+":"+HTTP_PORT,true);xhr.ontimeout=function(e){reject(Error("NA"))};xhr.onerror=function(){reject(Error("NA"))};xhr.onload=function(e){if(xhr.readyState===4){if(xhr.status===200){console.log("FOUND SERVER: "+this.ip);discovered=true;resolve("ws://"+this.ip+":"+HTTP_PORT)}}};xhr.send()}catch(e){console.log(e.message)}})}function discovered_player(ws){try{socket=new WebSocket(ws);socket.onopen=socket_onopen;socket.onclose=socket_onclose;socket.onerror=socket_onerror;socket.onmessage=function(event){socket_onmessage(event)}}catch(e){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(e.message)}}function drawUI(params){}start();function start(){DEBUG&&console.log("UI INIT");connect()}function connect(){if(!connected){websocket_connect("ws://"+webserver,onconnect,ondisconnect)}}function onconnect(){DEBUG&&console.log("UI CONNECTED");connected=true}function ondisconnect(){DEBUG&&console.log("UI DISCONNECTED");connected=false;drawMatrix(null);connect()}function init(){document.getElementsByTagName("BODY")[0].onresize=drawMatrix;layerGrid=new EditableGrid("Layers");layerGrid.tableLoaded=function(){this.renderGrid("layers","layer_grid")};layerGrid.loadJSON("data/layers.json");propertyGrid=new EditableGrid("Properties");propertyGrid.tableLoaded=function(){this.renderGrid("properties","property_grid")};propertyGrid.loadJSON("data/properties.json")}init();function drawMatrix(params){if(params&&params.shader_params&&params.shader_params.width&&params.shader_params.height&&params.colors&&params.colors.data){width=params.shader_params.width;height=params.shader_params.height;if(params.colors){colors=params.colors.data}}else{width=8;height=1;colors=new Uint8Array(24).fill(0)}resizeMatrix(params);DEBUG&&console.log("drawMatrix");if(height*width*3!=colors.length){return}for(i=0;i<width;i++){for(j=0;j<height;j++){var x=gridWidth*(i+1),y=gridHeight*(j+1);drawDot(x,y,dotRadius,getColor(i,j))}}}function resizeMatrix(){DEBUG&&console.log("resizeMatrix");canvasWidth=window.innerWidth;canvasHeight=window.innerHeight;xoffset=0;yoffset=0;canvas.width=canvasWidth;canvas.height=canvasHeight;canvas.style.width=canvasWidth;canvas.style.height=canvasHeight;gridWidth=canvasWidth/(width+1);gridHeight=canvasHeight/(height+1);if(gridWidth>gridHeight){gridWidth=gridHeight}else{gridHeight=gridWidth}yoffset=(canvasHeight-gridHeight*(height+1))/2;xoffset=(canvasWidth-gridWidth*(width+1))/2;dotRadius=gridWidth*0.4}function getColor(col,row){var r=colors[(row*width+col)*3+0],g=colors[(row*width+col)*3+1],b=colors[(row*width+col)*3+2];if(typeof r!=="undefined"&&g!=="undefined"&&b!=="undefined"){return"rgba("+r+","+g+","+b+",1)"}else{return null}}function drawDot(x,y,radius,color){if(color){context.beginPath();context.arc(x+xoffset,y+yoffset,radius,0,2*Math.PI,false);context.fillStyle=color;context.fill();context.lineWidth=1;context.strokeStyle="#101010";context.stroke()}}if(typeof _$=="undefined"){function _$(elementId){return document.getElementById(elementId)}}function Column(config){var props={name:"",label:"",editable:true,renderable:true,datatype:"string",unit:null,precision:-1,nansymbol:"",decimal_point:",",thousands_separator:".",unit_before_number:false,bar:true,hidden:false,headerRenderer:null,headerEditor:null,cellRenderer:null,cellEditor:null,cellValidators:[],enumProvider:null,optionValues:null,optionValuesForRender:null,columnIndex:-1};for(var p in props){this[p]=(typeof config=="undefined"||typeof config[p]=="undefined")?props[p]:config[p]}}Column.prototype.getOptionValuesForRender=function(rowIndex){if(!this.enumProvider){console.log("getOptionValuesForRender called on column "+this.name+" but there is no EnumProvider");return null}var values=this.enumProvider.getOptionValuesForRender(this.editablegrid,this,rowIndex);return values?values:this.optionValuesForRender};Column.prototype.getOptionValuesForEdit=function(rowIndex){if(!this.enumProvider){console.log("getOptionValuesForEdit called on column "+this.name+" but there is no EnumProvider");return null}var values=this.enumProvider.getOptionValuesForEdit(this.editablegrid,this,rowIndex);return values?this.editablegrid._convertOptions(values):this.optionValues};Column.prototype.isValid=function(value){for(var i=0;i<this.cellValidators.length;i++){if(!this.cellValidators[i].isValid(value)){return false}}return true};Column.prototype.isNumerical=function(){return this.datatype=="double"||this.datatype=="integer"};function EnumProvider(config){this.getOptionValuesForRender=function(grid,column,rowIndex){return null};this.getOptionValuesForEdit=function(grid,column,rowIndex){return null};for(var p in config){this[p]=config[p]}}function EditableGrid(name,config){if(typeof name!="undefined"&&name.replace(/\s+/g,"")==""){console.error("EditableGrid() : parameter [name] cannot be empty.")}if(name){this.init(name,config)}}EditableGrid.prototype.enableSort=true;EditableGrid.prototype.enableStore=true;EditableGrid.prototype.doubleclick=false;EditableGrid.prototype.editmode="absolute";EditableGrid.prototype.editorzoneid="";EditableGrid.prototype.allowSimultaneousEdition=false;EditableGrid.prototype.saveOnBlur=true;EditableGrid.prototype.invalidClassName="invalid";EditableGrid.prototype.ignoreLastRow=false;EditableGrid.prototype.caption=null;EditableGrid.prototype.dateFormat="EU";EditableGrid.prototype.shortMonthNames=null;EditableGrid.prototype.smartColorsBar=["#dc243c","#4040f6","#00f629","#efe100","#f93fb1","#6f8183","#111111"];EditableGrid.prototype.smartColorsPie=["#FF0000","#00FF00","#0000FF","#FFD700","#FF00FF","#00FFFF","#800080"];EditableGrid.prototype.pageSize=0;EditableGrid.prototype.serverSide=false;EditableGrid.prototype.pageCount=0;EditableGrid.prototype.totalRowCount=0;EditableGrid.prototype.unfilteredRowCount=0;EditableGrid.prototype.paginatorAttributes=null;EditableGrid.prototype.lastURL=null;EditableGrid.prototype.init=function(name,config){if(typeof name!="string"||(typeof config!="object"&&typeof config!="undefined")){alert("The EditableGrid constructor takes two arguments:\n- name (string)\n- config (object)\n\nGot instead "+(typeof name)+" and "+(typeof config)+".")}if(typeof config!="undefined"){for(var p in config){this[p]=config[p]}}this.Browser={IE:!!(window.attachEvent&&navigator.userAgent.indexOf("Opera")===-1),Opera:navigator.userAgent.indexOf("Opera")>-1,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")===-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)};if(typeof this.detectDir!="function"){var error=new Error();alert("Who is calling me now ? "+error.stack)}this.name=name;this.columns=[];this.data=[];this.dataUnfiltered=null;this.xmlDoc=null;this.sortedColumnName=-1;this.sortDescending=false;this.baseUrl=this.detectDir();this.nbHeaderRows=1;this.lastSelectedRowIndex=-1;this.currentPageIndex=0;this.currentFilter=null;this.currentContainerid=null;this.currentClassName=null;this.currentTableid=null;if(this.enableSort){if(typeof config!="undefined"&&typeof config.sortIconUp!="undefined"){this.sortUpElement=new Image();this.sortUpElement.src=config.sortIconUp}else{this.sortUpElement=document.createElement("span");this.sortUpElement.innerHTML="&#8593;"}if(typeof config!="undefined"&&typeof config.sortIconDown!="undefined"){this.sortDownElement=new Image();this.sortDownElement.src=config.sortIconDown}else{this.sortDownElement=document.createElement("span");this.sortDownElement.innerHTML="&#8595;"}}this.currentPageIndex=this.localisset("pageIndex")?parseInt(this.localget("pageIndex")):0;this.sortedColumnName=this.localisset("sortColumnIndexOrName")?this.localget("sortColumnIndexOrName"):-1;this.sortDescending=this.localisset("sortColumnIndexOrName")&&this.localisset("sortDescending")?this.localget("sortDescending")=="true":false;this.currentFilter=this.localisset("filter")?this.localget("filter"):null};EditableGrid.prototype.tableLoaded=function(){};EditableGrid.prototype.chartRendered=function(){};EditableGrid.prototype.tableRendered=function(containerid,className,tableid){};EditableGrid.prototype.tableSorted=function(columnIndex,descending){};EditableGrid.prototype.tableFiltered=function(){};EditableGrid.prototype.openedCellEditor=function(rowIndex,columnIndex){};EditableGrid.prototype.modelChanged=function(rowIndex,columnIndex,oldValue,newValue,row){};EditableGrid.prototype.rowSelected=function(oldRowIndex,newRowIndex){};EditableGrid.prototype.isHeaderEditable=function(rowIndex,columnIndex){return false};EditableGrid.prototype.isEditable=function(rowIndex,columnIndex){return true};EditableGrid.prototype.readonlyWarning=function(){};EditableGrid.prototype.rowRemoved=function(oldRowIndex,rowId){};EditableGrid.prototype.loadXML=function(url,callback,dataOnly){this.lastURL=url;var self=this;if(window.ActiveXObject){this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM");this.xmlDoc.onreadystatechange=function(){if(self.xmlDoc.readyState==4){self.processXML();self._callback("xml",callback)}};this.xmlDoc.load(this._addUrlParameters(url,dataOnly))}else{if(window.XMLHttpRequest){this.xmlDoc=new XMLHttpRequest();this.xmlDoc.onreadystatechange=function(){if(this.readyState==4){self.xmlDoc=this.responseXML;if(!self.xmlDoc){console.error("Could not load XML from url '"+url+"'");return false}self.processXML();self._callback("xml",callback)}};this.xmlDoc.open("GET",this._addUrlParameters(url,dataOnly),true);this.xmlDoc.send("")}else{if(document.implementation&&document.implementation.createDocument){this.xmlDoc=document.implementation.createDocument("","",null);this.xmlDoc.onload=function(){self.processXML();self._callback("xml",callback)};this.xmlDoc.load(this._addUrlParameters(url,dataOnly))}else{alert("Cannot load a XML url with this browser!");return false}}}return true};EditableGrid.prototype.loadXMLFromString=function(xml){if(window.DOMParser){var parser=new DOMParser();this.xmlDoc=parser.parseFromString(xml,"application/xml")}else{this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM");this.xmlDoc.async="false";this.xmlDoc.loadXML(xml)}this.processXML()};EditableGrid.prototype.processXML=function(){with(this){this.data=[];this.dataUnfiltered=null;this.table=null;var metadata=xmlDoc.getElementsByTagName("metadata");if(metadata&&metadata.length>=1){this.columns=[];var columnDeclarations=metadata[0].getElementsByTagName("column");for(var i=0;i<columnDeclarations.length;i++){var col=columnDeclarations[i];var datatype=col.getAttribute("datatype");var optionValuesForRender=null;var optionValues=null;var enumValues=col.getElementsByTagName("values");if(enumValues.length>0){optionValues=[];optionValuesForRender={};var enumGroups=enumValues[0].getElementsByTagName("group");if(enumGroups.length>0){for(var g=0;g<enumGroups.length;g++){var groupOptionValues=[];enumValues=enumGroups[g].getElementsByTagName("value");for(var v=0;v<enumValues.length;v++){var _value=enumValues[v].getAttribute("value");var _label=enumValues[v].firstChild?enumValues[v].firstChild.nodeValue:"";optionValuesForRender[_value]=_label;groupOptionValues.push({value:_value,label:_label})}optionValues.push({label:enumGroups[g].getAttribute("label"),values:groupOptionValues})}}else{enumValues=enumValues[0].getElementsByTagName("value");for(var v=0;v<enumValues.length;v++){var _value=enumValues[v].getAttribute("value");var _label=enumValues[v].firstChild?enumValues[v].firstChild.nodeValue:"";optionValuesForRender[_value]=_label;optionValues.push({value:_value,label:_label})}}}columns.push(new Column({name:col.getAttribute("name"),label:(typeof col.getAttribute("label")=="string"?col.getAttribute("label"):col.getAttribute("name")),datatype:(col.getAttribute("datatype")?col.getAttribute("datatype"):"string"),editable:col.getAttribute("editable")=="true",bar:(col.getAttribute("bar")?col.getAttribute("bar")=="true":true),hidden:(col.getAttribute("hidden")?col.getAttribute("hidden")=="true":false),optionValuesForRender:optionValuesForRender,optionValues:optionValues}))}processColumns()}var paginator=xmlDoc.getElementsByTagName("paginator");if(paginator&&paginator.length>=1){this.paginatorAttributes=null;this.pageCount=paginator[0].getAttribute("pagecount");this.totalRowCount=paginator[0].getAttribute("totalrowcount");this.unfilteredRowCount=paginator[0].getAttribute("unfilteredrowcount")}var defaultRowId=1;var rows=xmlDoc.getElementsByTagName("row");for(var i=0;i<rows.length;i++){var cellValues={};var cols=rows[i].getElementsByTagName("column");for(var j=0;j<cols.length;j++){var colname=cols[j].getAttribute("name");if(!colname){if(j>=columns.length){console.error("You defined too many columns for row "+(i+1))}else{colname=columns[j].name}}cellValues[colname]=cols[j].firstChild?cols[j].firstChild.nodeValue:""}var rowData={visible:true,originalIndex:i,id:rows[i].getAttribute("id")!==null?rows[i].getAttribute("id"):defaultRowId++};for(var attrIndex=0;attrIndex<rows[i].attributes.length;attrIndex++){var node=rows[i].attributes.item(attrIndex);if(node.nodeName!="id"){rowData[node.nodeName]=node.nodeValue}}rowData.columns=[];for(var c=0;c<columns.length;c++){var cellValue=columns[c].name in cellValues?cellValues[columns[c].name]:"";rowData.columns.push(getTypedValue(c,cellValue))}data.push(rowData)}}return true};EditableGrid.prototype.loadJSON=function(url,callback,dataOnly){this.lastURL=url;var self=this;if(!window.XMLHttpRequest){alert("Cannot load a JSON url with this browser!");return false}var ajaxRequest=new XMLHttpRequest();ajaxRequest.onreadystatechange=function(){if(this.readyState==4){if(!this.responseText){console.error("Could not load JSON from url '"+url+"'");return false}if(!self.processJSON(this.responseText)){console.error("Invalid JSON data obtained from url '"+url+"'");return false}self._callback("json",callback)}};ajaxRequest.open("GET",this._addUrlParameters(url,dataOnly),true);ajaxRequest.send("");return true};EditableGrid.prototype._addUrlParameters=function(baseUrl,dataOnly){var sep=baseUrl.indexOf("?")>=0?"&":"?";baseUrl+=sep+(new Date().getTime());if(!this.serverSide){return baseUrl}return baseUrl+"&page="+(this.currentPageIndex+1)+"&filter="+(this.currentFilter?encodeURIComponent(this.currentFilter):"")+"&sort="+(this.sortedColumnName&&this.sortedColumnName!=-1?encodeURIComponent(this.sortedColumnName):"")+"&asc="+(this.sortDescending?0:1)+(dataOnly?"&data_only=1":"")};EditableGrid.prototype._callback=function(type,callback){if(callback){callback.call(this)}else{if(this.serverSide){this.refreshGrid=function(baseUrl){var callback=function(){EditableGrid.prototype.refreshGrid.call(this)};var load=type=="xml"?this.loadXML:this.loadJSON;load.call(this,baseUrl||this.lastURL,callback,true)}}this.tableLoaded()}};EditableGrid.prototype.loadJSONFromString=function(json){return this.processJSON(json)};EditableGrid.prototype.load=function(object){return this.processJSON(object)};EditableGrid.prototype.update=function(object){if(object.data){for(var i=0;i<object.data.length;i++){var row=object.data[i];if(!row.id||!row.values){continue}var rowIndex=this.getRowIndex(row.id);var rowData=this.data[rowIndex];if(Object.prototype.toString.call(row.values)!=="[object Array]"){cellValues=row.values}else{cellValues={};for(var j=0;j<row.values.length&&j<this.columns.length;j++){cellValues[this.columns[j].name]=row.values[j]}}for(var attributeName in row){if(attributeName!="id"&&attributeName!="values"){rowData[attributeName]=row[attributeName]}}rowData.columns=[];for(var c=0;c<this.columns.length;c++){var cellValue=this.columns[c].name in cellValues?cellValues[this.columns[c].name]:"";rowData.columns.push(this.getTypedValue(c,cellValue))}var tr=this.getRow(rowIndex);for(var j=0;j<tr.cells.length&&j<this.columns.length;j++){if(this.columns[j].renderable){this.columns[j].cellRenderer._render(rowIndex,j,tr.cells[j],this.getValueAt(rowIndex,j))}}this.tableRendered(this.currentContainerid,this.currentClassName,this.currentTableid)}}};EditableGrid.prototype.processJSON=function(jsonData){if(typeof jsonData=="string"){jsonData=eval("("+jsonData+")")}if(!jsonData){return false}this.data=[];this.dataUnfiltered=null;this.table=null;if(jsonData.metadata){this.columns=[];for(var c=0;c<jsonData.metadata.length;c++){var columndata=jsonData.metadata[c];var optionValues=columndata.values?this._convertOptions(columndata.values):null;var optionValuesForRender=null;if(optionValues){var optionValuesForRender={};for(var optionIndex=0;optionIndex<optionValues.length;optionIndex++){var optionValue=optionValues[optionIndex];if(typeof optionValue.values=="object"){for(var groupOptionIndex=0;groupOptionIndex<optionValue.values.length;groupOptionIndex++){var groupOptionValue=optionValue.values[groupOptionIndex];optionValuesForRender[groupOptionValue.value]=groupOptionValue.label}}else{optionValuesForRender[optionValue.value]=optionValue.label}}}this.columns.push(new Column({name:columndata.name,label:(columndata.label?columndata.label:columndata.name),datatype:(columndata.datatype?columndata.datatype:"string"),editable:(columndata.editable?true:false),bar:(typeof columndata.bar=="undefined"?true:(columndata.bar||false)),hidden:(typeof columndata.hidden=="undefined"?false:(columndata.hidden?true:false)),optionValuesForRender:optionValuesForRender,optionValues:optionValues}))}this.processColumns()}if(jsonData.paginator){this.paginatorAttributes=jsonData.paginator;this.pageCount=jsonData.paginator.pagecount;this.totalRowCount=jsonData.paginator.totalrowcount;this.unfilteredRowCount=jsonData.paginator.unfilteredrowcount}var defaultRowId=1;if(jsonData.data){for(var i=0;i<jsonData.data.length;i++){var row=jsonData.data[i];if(!row.values){continue}if(Object.prototype.toString.call(row.values)!=="[object Array]"){cellValues=row.values}else{cellValues={};for(var j=0;j<row.values.length&&j<this.columns.length;j++){cellValues[this.columns[j].name]=row.values[j]}}var rowData={visible:true,originalIndex:i,id:row.id!==undefined&&row.id!==null?row.id:defaultRowId++};for(var attributeName in row){if(attributeName!="id"&&attributeName!="values"){rowData[attributeName]=row[attributeName]}}rowData.columns=[];for(var c=0;c<this.columns.length;c++){var cellValue=this.columns[c].name in cellValues?cellValues[this.columns[c].name]:"";rowData.columns.push(this.getTypedValue(c,cellValue))}this.data.push(rowData)}}return true};EditableGrid.prototype.processColumns=function(){for(var columnIndex=0;columnIndex<this.columns.length;columnIndex++){var column=this.columns[columnIndex];column.columnIndex=columnIndex;column.editablegrid=this;this.parseColumnType(column);if(!column.enumProvider){column.enumProvider=column.optionValues?new EnumProvider():null}if(!column.cellRenderer){this._createCellRenderer(column)}if(!column.headerRenderer){this._createHeaderRenderer(column)}if(!column.cellEditor){this._createCellEditor(column)}if(!column.headerEditor){this._createHeaderEditor(column)}this._addDefaultCellValidators(column)}};EditableGrid.prototype.parseColumnType=function(column){column.unit=null;column.precision=-1;column.decimal_point=",";column.thousands_separator=".";column.unit_before_number=false;column.nansymbol="";if(column.datatype.match(/(.*)\((.*),(.*),(.*),(.*),(.*),(.*)\)$/)){column.datatype=RegExp.$1;column.unit=RegExp.$2;column.precision=parseInt(RegExp.$3);column.decimal_point=RegExp.$4;column.thousands_separator=RegExp.$5;column.unit_before_number=RegExp.$6;column.nansymbol=RegExp.$7;column.unit=column.unit.trim();column.decimal_point=column.decimal_point.trim();column.thousands_separator=column.thousands_separator.trim();column.unit_before_number=column.unit_before_number.trim()=="1";column.nansymbol=column.nansymbol.trim()}else{if(column.datatype.match(/(.*)\((.*),(.*),(.*),(.*),(.*)\)$/)){column.datatype=RegExp.$1;column.unit=RegExp.$2;column.precision=parseInt(RegExp.$3);column.decimal_point=RegExp.$4;column.thousands_separator=RegExp.$5;column.unit_before_number=RegExp.$6;column.unit=column.unit.trim();column.decimal_point=column.decimal_point.trim();column.thousands_separator=column.thousands_separator.trim();column.unit_before_number=column.unit_before_number.trim()=="1"}else{if(column.datatype.match(/(.*)\((.*),(.*),(.*)\)$/)){column.datatype=RegExp.$1;column.unit=RegExp.$2.trim();column.precision=parseInt(RegExp.$3);column.nansymbol=RegExp.$4.trim()}else{if(column.datatype.match(/(.*)\((.*),(.*)\)$/)){column.datatype=RegExp.$1.trim();column.unit=RegExp.$2.trim();column.precision=parseInt(RegExp.$3)}else{if(column.datatype.match(/(.*)\((.*)\)$/)){column.datatype=RegExp.$1.trim();var unit_or_precision=RegExp.$2.trim();if(unit_or_precision.match(/^[0-9]*$/)){column.precision=parseInt(unit_or_precision)}else{column.unit=unit_or_precision}}}}}}if(column.decimal_point=="comma"){column.decimal_point=","}if(column.decimal_point=="dot"){column.decimal_point="."}if(column.thousands_separator=="comma"){column.thousands_separator=","}if(column.thousands_separator=="dot"){column.thousands_separator="."}if(isNaN(column.precision)){column.precision=-1}if(column.unit==""){column.unit=null}if(column.nansymbol==""){column.nansymbol=null}};EditableGrid.prototype.getTypedValue=function(columnIndex,cellValue){if(cellValue===null){return cellValue}var colType=this.getColumnType(columnIndex);if(colType=="boolean"){cellValue=(cellValue&&cellValue!=0&&cellValue!="false"&&cellValue!="f")?true:false}if(colType=="integer"){cellValue=parseInt(cellValue,10)}if(colType=="double"){cellValue=parseFloat(cellValue)}if(colType=="string"){cellValue=""+cellValue}return cellValue};EditableGrid.prototype.attachToHTMLTable=function(_table,_columns){this.data=[];this.dataUnfiltered=null;this.table=null;if(_columns){this.columns=_columns;for(var columnIndex=0;columnIndex<this.columns.length;columnIndex++){this.columns[columnIndex].optionValues=this._convertOptions(this.columns[columnIndex].optionValues)}this.processColumns()}this.table=typeof _table=="string"?_$(_table):_table;if(!this.table){console.error("Invalid table given: "+_table)}this.tHead=this.table.tHead;this.tBody=this.table.tBodies[0];if(!this.tBody){this.tBody=document.createElement("TBODY");this.table.insertBefore(this.tBody,this.table.firstChild)}if(!this.tHead){this.tHead=document.createElement("THEAD");this.table.insertBefore(this.tHead,this.tBody)}if(this.tHead.rows.length==0&&this.tBody.rows.length>0){this.tHead.appendChild(this.tBody.rows[0])}this.nbHeaderRows=this.tHead.rows.length;var rows=this.tHead.rows;for(var i=0;i<rows.length;i++){var cols=rows[i].cells;var columnIndexInModel=0;for(var j=0;j<cols.length&&columnIndexInModel<this.columns.length;j++){if(!this.columns[columnIndexInModel].label||this.columns[columnIndexInModel].label==this.columns[columnIndexInModel].name){this.columns[columnIndexInModel].label=cols[j].innerHTML}var colspan=parseInt(cols[j].getAttribute("colspan"));columnIndexInModel+=colspan>1?colspan:1}}var rows=this.tBody.rows;for(var i=0;i<rows.length;i++){var rowData=[];var cols=rows[i].cells;for(var j=0;j<cols.length&&j<this.columns.length;j++){rowData.push(this.getTypedValue(j,cols[j].innerHTML))}this.data.push({visible:true,originalIndex:i,id:rows[i].id,columns:rowData});rows[i].rowId=rows[i].id;rows[i].id=this._getRowDOMId(rows[i].id)}};EditableGrid.prototype._createCellRenderer=function(column){column.cellRenderer=column.enumProvider&&column.datatype=="list"&&typeof MultiselectCellRenderer!="undefined"?new MultiselectCellRenderer():column.enumProvider?new EnumCellRenderer():column.datatype=="integer"||column.datatype=="double"?new NumberCellRenderer():column.datatype=="boolean"?new CheckboxCellRenderer():column.datatype=="email"?new EmailCellRenderer():column.datatype=="website"||column.datatype=="url"?new WebsiteCellRenderer():column.datatype=="date"?new DateCellRenderer():new CellRenderer();if(column.cellRenderer){column.cellRenderer.editablegrid=this;column.cellRenderer.column=column}};EditableGrid.prototype._createHeaderRenderer=function(column){column.headerRenderer=(this.enableSort&&column.datatype!="html")?new SortHeaderRenderer(column.name):new CellRenderer();if(column.headerRenderer){column.headerRenderer.editablegrid=this;column.headerRenderer.column=column}};EditableGrid.prototype._createCellEditor=function(column){column.cellEditor=column.enumProvider&&column.datatype=="list"&&typeof MultiselectCellEditor!="undefined"?new MultiselectCellEditor():column.enumProvider?new SelectCellEditor():column.datatype=="integer"||column.datatype=="double"?new NumberCellEditor(column.datatype):column.datatype=="boolean"?null:column.datatype=="email"?new TextCellEditor(column.precision):column.datatype=="website"||column.datatype=="url"?new TextCellEditor(column.precision):column.datatype=="date"?(typeof jQuery=="undefined"||typeof jQuery.datepicker=="undefined"?new TextCellEditor(column.precision,10):new DateCellEditor({fieldSize:column.precision,maxLength:10})):new TextCellEditor(column.precision);if(column.cellEditor){column.cellEditor.editablegrid=this;column.cellEditor.column=column}};EditableGrid.prototype._createHeaderEditor=function(column){column.headerEditor=new TextCellEditor();if(column.headerEditor){column.headerEditor.editablegrid=this;column.headerEditor.column=column}};EditableGrid.prototype.getRowCount=function(){return this.data.length};EditableGrid.prototype.getUnfilteredRowCount=function(){if(this.unfilteredRowCount>0){return this.unfilteredRowCount}var _data=this.dataUnfiltered==null?this.data:this.dataUnfiltered;return _data.length};EditableGrid.prototype.getTotalRowCount=function(){if(this.totalRowCount>0){return this.totalRowCount}return this.getRowCount()};EditableGrid.prototype.getColumnCount=function(){return this.columns.length};EditableGrid.prototype.hasColumn=function(columnIndexOrName){return this.getColumnIndex(columnIndexOrName)>=0};EditableGrid.prototype.getColumn=function(columnIndexOrName){var colIndex=this.getColumnIndex(columnIndexOrName);if(colIndex<0){console.error("[getColumn] Column not found with index or name "+columnIndexOrName);return null}return this.columns[colIndex]};EditableGrid.prototype.getColumnName=function(columnIndexOrName){return this.getColumn(columnIndexOrName).name};EditableGrid.prototype.getColumnLabel=function(columnIndexOrName){return this.getColumn(columnIndexOrName).label};EditableGrid.prototype.getColumnType=function(columnIndexOrName){return this.getColumn(columnIndexOrName).datatype};EditableGrid.prototype.getColumnUnit=function(columnIndexOrName){return this.getColumn(columnIndexOrName).unit};EditableGrid.prototype.getColumnPrecision=function(columnIndexOrName){return this.getColumn(columnIndexOrName).precision};EditableGrid.prototype.isColumnBar=function(columnIndexOrName){var column=this.getColumn(columnIndexOrName);return(column.bar&&column.isNumerical())};EditableGrid.prototype.getColumnStack=function(columnIndexOrName){var column=this.getColumn(columnIndexOrName);return column.isNumerical()?column.bar:""};EditableGrid.prototype.isColumnNumerical=function(columnIndexOrName){var column=this.getColumn(columnIndexOrName);return column.isNumerical()};EditableGrid.prototype.getValueAt=function(rowIndex,columnIndex){if(columnIndex<0||columnIndex>=this.columns.length){console.error("[getValueAt] Invalid column index "+columnIndex);return null}var column=this.columns[columnIndex];if(rowIndex<0){return column.label}if(typeof this.data[rowIndex]=="undefined"){console.error("[getValueAt] Invalid row index "+rowIndex);return null}var rowData=this.data[rowIndex]["columns"];return rowData?rowData[columnIndex]:null};EditableGrid.prototype.getDisplayValueAt=function(rowIndex,columnIndex){var value=this.getValueAt(rowIndex,columnIndex);var renderer=rowIndex<0?this.columns[columnIndex].headerRenderer:this.columns[columnIndex].cellRenderer;return renderer.getDisplayValue(rowIndex,value)};EditableGrid.prototype.setValueAt=function(rowIndex,columnIndex,value,render){if(typeof render=="undefined"){render=true}var previousValue=null;if(columnIndex<0||columnIndex>=this.columns.length){console.error("[setValueAt] Invalid column index "+columnIndex);return null}var column=this.columns[columnIndex];if(rowIndex<0){previousValue=column.label;column.label=value}else{if(typeof this.data[rowIndex]=="undefined"){console.error("Invalid rowindex "+rowIndex);return null}var rowData=this.data[rowIndex]["columns"];previousValue=rowData[columnIndex];if(rowData){rowData[columnIndex]=this.getTypedValue(columnIndex,value)}}if(render){var renderer=rowIndex<0?column.headerRenderer:column.cellRenderer;var cell=this.getCell(rowIndex,columnIndex);if(cell){renderer._render(rowIndex,columnIndex,cell,value)}}return previousValue};EditableGrid.prototype.getColumnIndex=function(columnIndexOrName){if(typeof columnIndexOrName=="undefined"||columnIndexOrName===""){return -1}if(!isNaN(columnIndexOrName)&&columnIndexOrName>=0&&columnIndexOrName<this.columns.length){return columnIndexOrName}for(var c=0;c<this.columns.length;c++){if(this.columns[c].name==columnIndexOrName){return c}}return -1};EditableGrid.prototype.getRow=function(rowIndex){if(rowIndex<0){return this.tHead.rows[rowIndex+this.nbHeaderRows]}if(typeof this.data[rowIndex]=="undefined"){console.error("[getRow] Invalid row index "+rowIndex);return null}return _$(this._getRowDOMId(this.data[rowIndex].id))};EditableGrid.prototype.getRowId=function(rowIndex){return(rowIndex<0||rowIndex>=this.data.length)?null:this.data[rowIndex]["id"]};EditableGrid.prototype.getRowIndex=function(rowId){rowId=typeof rowId=="object"?rowId.rowId:rowId;for(var rowIndex=0;rowIndex<this.data.length;rowIndex++){if(this.data[rowIndex].id==rowId){return rowIndex}}return -1};EditableGrid.prototype.getRowAttribute=function(rowIndex,attributeName){if(typeof this.data[rowIndex]=="undefined"){console.error("Invalid rowindex "+rowIndex);return null}return this.data[rowIndex][attributeName]};EditableGrid.prototype.setRowAttribute=function(rowIndex,attributeName,attributeValue){this.data[rowIndex][attributeName]=attributeValue};EditableGrid.prototype._getRowDOMId=function(rowId){return this.currentContainerid!=null?this.name+"_"+rowId:rowId};EditableGrid.prototype.removeRow=function(rowId){return this.remove(this.getRowIndex(rowId))};EditableGrid.prototype.remove=function(rowIndex){var rowId=this.data[rowIndex].id;var originalIndex=this.data[rowIndex].originalIndex;var _data=this.dataUnfiltered==null?this.data:this.dataUnfiltered;var tr=_$(this._getRowDOMId(rowId));if(tr!=null){this.tBody.removeChild(tr)}for(var r=0;r<_data.length;r++){if(_data[r].originalIndex>=originalIndex){_data[r].originalIndex--}}this.data.splice(rowIndex,1);if(this.dataUnfiltered!=null){for(var r=0;r<this.dataUnfiltered.length;r++){if(this.dataUnfiltered[r].id==rowId){this.dataUnfiltered.splice(r,1);break}}}this.rowRemoved(rowIndex,rowId);this.refreshGrid()};EditableGrid.prototype.getRowValues=function(rowIndex){var rowValues={};for(var columnIndex=0;columnIndex<this.getColumnCount();columnIndex++){rowValues[this.getColumnName(columnIndex)]=this.getValueAt(rowIndex,columnIndex)}return rowValues};EditableGrid.prototype.append=function(rowId,cellValues,rowAttributes,dontSort){return this.insert(this.data.length,rowId,cellValues,rowAttributes,dontSort)};EditableGrid.prototype.addRow=function(rowId,cellValues,rowAttributes,dontSort){return this.append(rowId,cellValues,rowAttributes,dontSort)};EditableGrid.prototype._insert=function(rowIndex,offset,rowId,cellValues,rowAttributes,dontSort){var originalRowId=null;var originalIndex=0;var _data=this.dataUnfiltered==null?this.data:this.dataUnfiltered;if(typeof this.data[rowIndex]!="undefined"){originalRowId=this.data[rowIndex].id;originalIndex=this.data[rowIndex].originalIndex+offset}if(this.currentContainerid==null){var tr=this.tBody.insertRow(rowIndex+offset);tr.rowId=rowId;tr.id=this._getRowDOMId(rowId);for(var c=0;c<this.columns.length;c++){tr.insertCell(c)}}var rowData={visible:true,originalIndex:originalIndex,id:rowId};if(rowAttributes){for(var attributeName in rowAttributes){rowData[attributeName]=rowAttributes[attributeName]}}rowData.columns=[];for(var c=0;c<this.columns.length;c++){var cellValue=this.columns[c].name in cellValues?cellValues[this.columns[c].name]:"";rowData.columns.push(this.getTypedValue(c,cellValue))}for(var r=0;r<_data.length;r++){if(_data[r].originalIndex>=originalIndex){_data[r].originalIndex++}}this.data.splice(rowIndex+offset,0,rowData);if(this.dataUnfiltered!=null){if(originalRowId===null){this.dataUnfiltered.splice(rowIndex+offset,0,rowData)}else{for(var r=0;r<this.dataUnfiltered.length;r++){if(this.dataUnfiltered[r].id==originalRowId){this.dataUnfiltered.splice(r+offset,0,rowData);break}}}}this.refreshGrid();if(!dontSort){this.sort()}this.filter()};EditableGrid.prototype.insert=function(rowIndex,rowId,cellValues,rowAttributes,dontSort){if(rowIndex<0){rowIndex=0}if(rowIndex>=this.data.length&&this.data.length>0){return this.insertAfter(this.data.length-1,rowId,cellValues,rowAttributes,dontSort)}return this._insert(rowIndex,0,rowId,cellValues,rowAttributes,dontSort)};EditableGrid.prototype.insertAfter=function(rowIndex,rowId,cellValues,rowAttributes,dontSort){if(rowIndex<0){return this.insert(0,rowId,cellValues,rowAttributes,dontSort)}if(rowIndex>=this.data.length){rowIndex=Math.max(0,this.data.length-1)}return this._insert(rowIndex,1,rowId,cellValues,rowAttributes,dontSort)};EditableGrid.prototype.setHeaderRenderer=function(columnIndexOrName,cellRenderer){var columnIndex=this.getColumnIndex(columnIndexOrName);if(columnIndex<0){console.error("[setHeaderRenderer] Invalid column: "+columnIndexOrName)}else{var column=this.columns[columnIndex];column.headerRenderer=(this.enableSort&&column.datatype!="html")?new SortHeaderRenderer(column.name,cellRenderer):cellRenderer;if(cellRenderer){if(this.enableSort&&column.datatype!="html"){column.headerRenderer.editablegrid=this;column.headerRenderer.column=column}cellRenderer.editablegrid=this;cellRenderer.column=column}}};EditableGrid.prototype.setCellRenderer=function(columnIndexOrName,cellRenderer){var columnIndex=this.getColumnIndex(columnIndexOrName);if(columnIndex<0){console.error("[setCellRenderer] Invalid column: "+columnIndexOrName)}else{var column=this.columns[columnIndex];column.cellRenderer=cellRenderer;if(cellRenderer){cellRenderer.editablegrid=this;cellRenderer.column=column}}};EditableGrid.prototype.setCellEditor=function(columnIndexOrName,cellEditor){var columnIndex=this.getColumnIndex(columnIndexOrName);if(columnIndex<0){console.error("[setCellEditor] Invalid column: "+columnIndexOrName)}else{var column=this.columns[columnIndex];column.cellEditor=cellEditor;if(cellEditor){cellEditor.editablegrid=this;cellEditor.column=column}}};EditableGrid.prototype.setHeaderEditor=function(columnIndexOrName,cellEditor){var columnIndex=this.getColumnIndex(columnIndexOrName);if(columnIndex<0){console.error("[setHeaderEditor] Invalid column: "+columnIndexOrName)}else{var column=this.columns[columnIndex];column.headerEditor=cellEditor;if(cellEditor){cellEditor.editablegrid=this;cellEditor.column=column}}};EditableGrid.prototype.setEnumProvider=function(columnIndexOrName,enumProvider){var columnIndex=this.getColumnIndex(columnIndexOrName);if(columnIndex<0){console.error("[setEnumProvider] Invalid column: "+columnIndexOrName)}else{var hadProviderAlready=this.columns[columnIndex].enumProvider!=null;this.columns[columnIndex].enumProvider=enumProvider;if(!hadProviderAlready){this._createCellRenderer(this.columns[columnIndex]);this._createCellEditor(this.columns[columnIndex])}}};EditableGrid.prototype.clearCellValidators=function(columnIndexOrName){var columnIndex=this.getColumnIndex(columnIndexOrName);if(columnIndex<0){console.error("[clearCellValidators] Invalid column: "+columnIndexOrName)}else{this.columns[columnIndex].cellValidators=[]}};EditableGrid.prototype.addDefaultCellValidators=function(columnIndexOrName){var columnIndex=this.getColumnIndex(columnIndexOrName);if(columnIndex<0){console.error("[addDefaultCellValidators] Invalid column: "+columnIndexOrName)}return this._addDefaultCellValidators(this.columns[columnIndex])};EditableGrid.prototype._addDefaultCellValidators=function(column){if(column.datatype=="integer"||column.datatype=="double"){column.cellValidators.push(new NumberCellValidator(column.datatype))}else{if(column.datatype=="email"){column.cellValidators.push(new EmailCellValidator())}else{if(column.datatype=="website"||column.datatype=="url"){column.cellValidators.push(new WebsiteCellValidator())}else{if(column.datatype=="date"){column.cellValidators.push(new DateCellValidator(this))}}}}};EditableGrid.prototype.addCellValidator=function(columnIndexOrName,cellValidator){var columnIndex=this.getColumnIndex(columnIndexOrName);if(columnIndex<0){console.error("[addCellValidator] Invalid column: "+columnIndexOrName)}else{this.columns[columnIndex].cellValidators.push(cellValidator)}};EditableGrid.prototype.setCaption=function(caption){this.caption=caption};EditableGrid.prototype.getCell=function(rowIndex,columnIndex){var row=this.getRow(rowIndex);if(row==null){console.error("[getCell] Invalid row index "+rowIndex);return null}return row.cells[columnIndex]};EditableGrid.prototype.getCellX=function(oElement){var iReturnValue=0;while(oElement!=null&&this.isStatic(oElement)){try{iReturnValue+=oElement.offsetLeft;oElement=oElement.offsetParent}catch(err){oElement=null}}return iReturnValue};EditableGrid.prototype.getCellY=function(oElement){var iReturnValue=0;while(oElement!=null&&this.isStatic(oElement)){try{iReturnValue+=oElement.offsetTop;oElement=oElement.offsetParent}catch(err){oElement=null}}return iReturnValue};EditableGrid.prototype.getScrollXOffset=function(oElement){var iReturnValue=0;while(oElement!=null&&typeof oElement.scrollLeft!="undefined"&&this.isStatic(oElement)&&oElement!=document.body){try{iReturnValue+=parseInt(oElement.scrollLeft);oElement=oElement.parentNode}catch(err){oElement=null}}return iReturnValue};EditableGrid.prototype.getScrollYOffset=function(oElement){var iReturnValue=0;while(oElement!=null&&typeof oElement.scrollTop!="undefined"&&this.isStatic(oElement)&&oElement!=document.body){try{iReturnValue+=parseInt(oElement.scrollTop);oElement=oElement.parentNode}catch(err){oElement=null}}return iReturnValue};EditableGrid.prototype._rendergrid=function(containerid,className,tableid){with(this){lastSelectedRowIndex=-1;_currentPageIndex=getCurrentPageIndex();if(typeof table!="undefined"&&table!=null){var _data=dataUnfiltered==null?data:dataUnfiltered;_renderHeaders();var rows=tBody.rows;var skipped=0;var displayed=0;var rowIndex=0;for(var i=0;i<rows.length;i++){if(!_data[i].visible||(pageSize>0&&displayed>=pageSize)){if(rows[i].style.display!="none"){rows[i].style.display="none";rows[i].hidden_by_editablegrid=true}}else{if(skipped<pageSize*_currentPageIndex){skipped++;if(rows[i].style.display!="none"){rows[i].style.display="none";rows[i].hidden_by_editablegrid=true}}else{displayed++;var cols=rows[i].cells;if(typeof rows[i].hidden_by_editablegrid!="undefined"&&rows[i].hidden_by_editablegrid){rows[i].style.display="";rows[i].hidden_by_editablegrid=false}rows[i].rowId=getRowId(rowIndex);rows[i].id=_getRowDOMId(rows[i].rowId);for(var j=0;j<cols.length&&j<columns.length;j++){if(columns[j].renderable){columns[j].cellRenderer._render(rowIndex,j,cols[j],getValueAt(rowIndex,j))}}}rowIndex++}}table.editablegrid=this;if(doubleclick){table.ondblclick=function(e){this.editablegrid.mouseClicked(e)}}else{table.onclick=function(e){this.editablegrid.mouseClicked(e)}}}else{if(!containerid){return console.error("Container ID not specified (renderGrid not called yet ?)")}if(!_$(containerid)){return console.error("Unable to get element ["+containerid+"]")}currentContainerid=containerid;currentClassName=className;currentTableid=tableid;var startRowIndex=0;var endRowIndex=getRowCount();if(pageSize>0){startRowIndex=_currentPageIndex*pageSize;endRowIndex=Math.min(getRowCount(),startRowIndex+pageSize)}this.table=document.createElement("table");table.className=className||"editablegrid";if(typeof tableid!="undefined"){table.id=tableid}while(_$(containerid).hasChildNodes()){_$(containerid).removeChild(_$(containerid).firstChild)}_$(containerid).appendChild(table);if(caption){var captionElement=document.createElement("CAPTION");captionElement.innerHTML=this.caption;table.appendChild(captionElement)}this.tHead=document.createElement("THEAD");table.appendChild(tHead);var trHeader=tHead.insertRow(0);var columnCount=getColumnCount();for(var c=0;c<columnCount;c++){var headerCell=document.createElement("TH");var td=trHeader.appendChild(headerCell);columns[c].headerRenderer._render(-1,c,td,columns[c].label)}this.tBody=document.createElement("TBODY");table.appendChild(tBody);var insertRowIndex=0;for(var i=startRowIndex;i<endRowIndex;i++){var tr=tBody.insertRow(insertRowIndex++);tr.rowId=data[i]["id"];tr.id=this._getRowDOMId(data[i]["id"]);for(j=0;j<columnCount;j++){var td=tr.insertCell(j);columns[j].cellRenderer._render(i,j,td,getValueAt(i,j))}}_$(containerid).editablegrid=this;if(doubleclick){_$(containerid).ondblclick=function(e){this.editablegrid.mouseClicked(e)}}else{_$(containerid).onclick=function(e){this.editablegrid.mouseClicked(e)}}}tableRendered(containerid,className,tableid)}};EditableGrid.prototype.renderGrid=function(containerid,className,tableid){this._rendergrid(containerid,className,tableid);if(!this.serverSide){this.sort();this.filter()}};EditableGrid.prototype.refreshGrid=function(){if(this.currentContainerid!=null){this.table=null}this._rendergrid(this.currentContainerid,this.currentClassName,this.currentTableid)};EditableGrid.prototype._renderHeaders=function(){with(this){var rows=tHead.rows;for(var i=0;i<1;i++){var rowData=[];var cols=rows[i].cells;var columnIndexInModel=0;for(var j=0;j<cols.length&&columnIndexInModel<columns.length;j++){columns[columnIndexInModel].headerRenderer._render(-1,columnIndexInModel,cols[j],columns[columnIndexInModel].label);var colspan=parseInt(cols[j].getAttribute("colspan"));columnIndexInModel+=colspan>1?colspan:1}}}};EditableGrid.prototype.mouseClicked=function(e){e=e||window.event;with(this){var target=e.target||e.srcElement;while(target){if(target.tagName=="A"||target.tagName=="TD"||target.tagName=="TH"){break}else{target=target.parentNode}}if(!target||!target.parentNode||!target.parentNode.parentNode||(target.parentNode.parentNode.tagName!="TBODY"&&target.parentNode.parentNode.tagName!="THEAD")||target.isEditing){return}if(target.tagName=="A"){return}var rowIndex=getRowIndex(target.parentNode);var columnIndex=target.cellIndex;editCell(rowIndex,columnIndex)}};EditableGrid.prototype.editCell=function(rowIndex,columnIndex){var target=this.getCell(rowIndex,columnIndex);with(this){var column=columns[columnIndex];if(column){if(rowIndex>-1){rowSelected(lastSelectedRowIndex,rowIndex);lastSelectedRowIndex=rowIndex}if(!column.editable){readonlyWarning(column)}else{if(rowIndex<0){if(column.headerEditor&&isHeaderEditable(rowIndex,columnIndex)){column.headerEditor.edit(rowIndex,columnIndex,target,column.label)}}else{if(column.cellEditor&&isEditable(rowIndex,columnIndex)){column.cellEditor.edit(rowIndex,columnIndex,target,getValueAt(rowIndex,columnIndex))}}}}}};EditableGrid.prototype.sortColumns=function(headerArray){with(this){newColumns=[];newColumnIndices=[];for(var i=0;i<headerArray.length;i++){columnIndex=this.getColumnIndex(headerArray[i]);if(columnIndex==-1){console.error("[sortColumns] Invalid column: "+columnIndex);return false}newColumns[i]=this.columns[columnIndex];newColumnIndices[i]=columnIndex}this.columns=newColumns;for(var i=0;i<this.data.length;i++){var myData=this.data[i];var myDataColumns=myData.columns;var newDataColumns=[];for(var j=0;j<myDataColumns.length;j++){newIndex=newColumnIndices[j];newDataColumns[j]=myDataColumns[newIndex]}this.data[i].columns=newDataColumns}return true}};EditableGrid.prototype.sort=function(columnIndexOrName,descending,backOnFirstPage){with(this){if(typeof columnIndexOrName=="undefined"&&sortedColumnName===-1){tableSorted(-1,sortDescending);return true}if(typeof columnIndexOrName=="undefined"){columnIndexOrName=sortedColumnName}if(typeof descending=="undefined"){descending=sortDescending}localset("sortColumnIndexOrName",columnIndexOrName);localset("sortDescending",descending);if(serverSide){return backOnFirstPage?setPageIndex(0):refreshGrid()}var columnIndex=columnIndexOrName;if(parseInt(columnIndex,10)!==-1){columnIndex=this.getColumnIndex(columnIndexOrName);if(columnIndex<0){console.error("[sort] Invalid column: "+columnIndexOrName);return false}}if(!enableSort){tableSorted(columnIndex,descending);return}var filterActive=dataUnfiltered!=null;if(filterActive){data=dataUnfiltered}var type=columnIndex<0?"":getColumnType(columnIndex);var row_array=[];var rowCount=getRowCount();for(var i=0;i<rowCount-(ignoreLastRow?1:0);i++){row_array.push([columnIndex<0?null:getDisplayValueAt(i,columnIndex),i,data[i].originalIndex])}var sort_function=type=="integer"||type=="double"?sort_numeric:type=="boolean"?sort_boolean:type=="date"?sort_date:sort_alpha;row_array.sort(columnIndex<0?unsort:sort_stable(sort_function,descending));if(ignoreLastRow){row_array.push([columnIndex<0?null:getDisplayValueAt(rowCount-1,columnIndex),rowCount-1,data[rowCount-1].originalIndex])}var _data=data;data=[];for(var i=0;i<row_array.length;i++){data.push(_data[row_array[i][1]])}delete row_array;if(filterActive){dataUnfiltered=data;data=[];for(var r=0;r<rowCount;r++){if(dataUnfiltered[r].visible){data.push(dataUnfiltered[r])}}}if(backOnFirstPage){setPageIndex(0)}else{refreshGrid()}tableSorted(columnIndex,descending);return true}};EditableGrid.prototype.filter=function(filterString,cols){with(this){if(typeof filterString!="undefined"){this.currentFilter=filterString;this.localset("filter",filterString)}if(serverSide){return setPageIndex(0)}if(currentFilter==null||currentFilter==""){if(dataUnfiltered!=null){data=dataUnfiltered;dataUnfiltered=null;for(var r=0;r<getRowCount();r++){data[r].visible=true}setPageIndex(0);tableFiltered()}return}var words=currentFilter.toLowerCase().split(" ");if(dataUnfiltered!=null){data=dataUnfiltered}var rowCount=getRowCount();var columnCount=typeof cols!="undefined"?cols.length:getColumnCount();for(var r=0;r<rowCount;r++){var row=data[r];row.visible=true;var rowContent="";for(var c=0;c<columnCount;c++){if(getColumnType(c)=="boolean"){continue}var displayValue=getDisplayValueAt(r,typeof cols!="undefined"?cols[c]:c);var value=getValueAt(r,typeof cols!="undefined"?cols[c]:c);rowContent+=displayValue+" "+(displayValue==value?"":value+" ")}for(var attributeName in row){if(attributeName!="visible"&&attributeName!="originalIndex"&&attributeName!="columns"){rowContent+=row[attributeName]}}for(var i=0;i<words.length;i++){var word=words[i];var match=false;var invertMatch=word.startsWith("!");if(invertMatch){word=word.substr(1)}var colindex=-1;var attributeName=null;if(word.contains("!=")){var parts=word.split("!=");colindex=getColumnIndex(parts[0]);if(colindex>=0){word=parts[1];invertMatch=!invertMatch}else{if(typeof row[parts[0]]!="undefined"){attributeName=parts[0];word=parts[1];invertMatch=!invertMatch}}}else{if(word.contains("=")){var parts=word.split("=");colindex=getColumnIndex(parts[0]);if(colindex>=0){word=parts[1]}else{if(typeof row[parts[0]]!="undefined"){attributeName=parts[0];word=parts[1]}}}}if(!word.endsWith("!")){if(colindex>=0){match=(getValueAt(r,colindex)+" "+getDisplayValueAt(r,colindex)).trim().toLowerCase().indexOf(word)>=0}else{if(attributeName!==null){match=(""+getRowAttribute(r,attributeName)).trim().toLowerCase().indexOf(word)>=0}else{match=rowContent.toLowerCase().indexOf(word)>=0}}}else{word=word.substr(0,word.length-1);if(colindex>=0){match=(""+getDisplayValueAt(r,colindex)).trim().toLowerCase()==word||(""+getValueAt(r,colindex)).trim().toLowerCase()==word}else{if(attributeName!==null){match=(""+getRowAttribute(r,attributeName)).trim().toLowerCase()==word}else{for(var c=0;c<columnCount;c++){if(getColumnType(typeof cols!="undefined"?cols[c]:c)=="boolean"){continue}if((""+getDisplayValueAt(r,typeof cols!="undefined"?cols[c]:c)).trim().toLowerCase()==word||(""+getValueAt(r,typeof cols!="undefined"?cols[c]:c)).trim().toLowerCase()==word){match=true}}}}}if(invertMatch?match:!match){data[r].visible=false;break}}}dataUnfiltered=data;data=[];for(var r=0;r<rowCount;r++){if(dataUnfiltered[r].visible){data.push(dataUnfiltered[r])}}setPageIndex(0);tableFiltered()}};EditableGrid.prototype.setPageSize=function(pageSize){this.pageSize=parseInt(pageSize);if(isNaN(this.pageSize)){this.pageSize=0}this.currentPageIndex=0;this.refreshGrid()};EditableGrid.prototype.getPageCount=function(){if(this.getRowCount()==0){return 0}if(this.pageCount>0){return this.pageCount}if(this.pageSize<=0){return 1}return Math.ceil(this.getRowCount()/this.pageSize)};EditableGrid.prototype.getCurrentPageIndex=function(){if(this.pageSize<=0&&!this.serverSide){return 0}return Math.max(0,this.currentPageIndex>=this.getPageCount()?this.getPageCount()-1:this.currentPageIndex)};EditableGrid.prototype.setPageIndex=function(pageIndex){this.currentPageIndex=pageIndex;this.localset("pageIndex",pageIndex);this.refreshGrid()};EditableGrid.prototype.prevPage=function(){if(this.canGoBack()){this.setPageIndex(this.getCurrentPageIndex()-1)}};EditableGrid.prototype.firstPage=function(){if(this.canGoBack()){this.setPageIndex(0)}};EditableGrid.prototype.nextPage=function(){if(this.canGoForward()){this.setPageIndex(this.getCurrentPageIndex()+1)}};EditableGrid.prototype.lastPage=function(){if(this.canGoForward()){this.setPageIndex(this.getPageCount()-1)}};EditableGrid.prototype.canGoBack=function(){return this.getCurrentPageIndex()>0};EditableGrid.prototype.canGoForward=function(){return this.getCurrentPageIndex()<this.getPageCount()-1};EditableGrid.prototype.getSlidingPageInterval=function(slidingWindowSize){var nbPages=this.getPageCount();if(nbPages<=1){return null}var curPageIndex=this.getCurrentPageIndex();var startPageIndex=Math.max(0,curPageIndex-Math.floor(slidingWindowSize/2));var endPageIndex=Math.min(nbPages-1,curPageIndex+Math.floor(slidingWindowSize/2));if(endPageIndex-startPageIndex<slidingWindowSize){var diff=slidingWindowSize-(endPageIndex-startPageIndex+1);startPageIndex=Math.max(0,startPageIndex-diff);endPageIndex=Math.min(nbPages-1,endPageIndex+diff)}return{startPageIndex:startPageIndex,endPageIndex:endPageIndex}};EditableGrid.prototype.getPagesInInterval=function(interval,callback){var pages=[];for(var p=interval.startPageIndex;p<=interval.endPageIndex;p++){pages.push(typeof callback=="function"?callback(p,p==this.getCurrentPageIndex()):p)}return pages};function CellRenderer(config){this.init(config)}CellRenderer.prototype.init=function(config){for(var p in config){this[p]=config[p]}};CellRenderer.prototype._render=function(rowIndex,columnIndex,element,value){element.rowIndex=rowIndex;element.columnIndex=columnIndex;while(element.hasChildNodes()){element.removeChild(element.firstChild)}element.isEditing=false;if(this.column.isNumerical()){EditableGrid.prototype.addClassName(element,"number")}if(this.column.datatype=="boolean"){EditableGrid.prototype.addClassName(element,"boolean")}EditableGrid.prototype.addClassName(element,"editablegrid-"+this.column.name);element.setAttribute("data-title",this.column.label);return this.render(element,typeof value=="string"&&this.column.datatype!="html"?(value===null?null:htmlspecialchars(value,"ENT_NOQUOTES").replace(/  /g," &nbsp;")):value)};CellRenderer.prototype.render=function(element,value,escapehtml){var _value=escapehtml?(typeof value=="string"&&this.column.datatype!="html"?(value===null?null:htmlspecialchars(value,"ENT_NOQUOTES").replace(/  /g," &nbsp;")):value):value;element.innerHTML=_value?_value:""};CellRenderer.prototype.getDisplayValue=function(rowIndex,value){if(this.column.datatype=="html"){return html_entity_decode(value)}return value};function EnumCellRenderer(config){this.init(config)}EnumCellRenderer.prototype=new CellRenderer();EnumCellRenderer.prototype.getLabel=function(rowIndex,value){var label=null;if(typeof value!="undefined"){value=value?value:"";var optionValues=this.column.getOptionValuesForRender(rowIndex);if(optionValues&&value in optionValues){label=optionValues[value]}if(label===null){var isNAN=typeof value=="number"&&isNaN(value);label=isNAN?"":value}}return label?label:""};EnumCellRenderer.prototype.render=function(element,value){var label=this.getLabel(element.rowIndex,value);element.innerHTML=label?(this.column.datatype!="html"?htmlspecialchars(label,"ENT_NOQUOTES").replace(/\s\s/g,"&nbsp; "):label):""};EnumCellRenderer.prototype.getDisplayValue=function(rowIndex,value){return value===null?null:this.getLabel(rowIndex,value)};function NumberCellRenderer(config){this.init(config)}NumberCellRenderer.prototype=new CellRenderer();NumberCellRenderer.prototype.render=function(element,value){var column=this.column||{};var isNAN=value===null||(typeof value=="number"&&isNaN(value));var displayValue=isNAN?(column.nansymbol||""):value;if(typeof displayValue=="number"){if(column.precision!==null){displayValue=number_format(displayValue,column.precision,column.decimal_point,column.thousands_separator)}if(column.unit!==null){if(column.unit_before_number){displayValue=column.unit+" "+displayValue}else{displayValue=displayValue+" "+column.unit}}}element.innerHTML=displayValue;if(isNAN){EditableGrid.prototype.addClassName(element,"nan")}else{EditableGrid.prototype.removeClassName(element,"nan")}};function CheckboxCellRenderer(config){this.init(config)}CheckboxCellRenderer.prototype=new CellRenderer();CheckboxCellRenderer.prototype._render=function(rowIndex,columnIndex,element,value){if(element.firstChild&&(typeof element.firstChild.getAttribute!="function"||element.firstChild.getAttribute("type")!="checkbox")){while(element.hasChildNodes()){element.removeChild(element.firstChild)}}element.rowIndex=rowIndex;element.columnIndex=columnIndex;EditableGrid.prototype.addClassName(element,"editablegrid-"+this.column.name);element.setAttribute("data-title",this.column.label);return this.render(element,value)};CheckboxCellRenderer.prototype.render=function(element,value){value=(value&&value!=0&&value!="false")?true:false;if(element.firstChild){element.firstChild.checked=value;return}var htmlInput=document.createElement("input");htmlInput.setAttribute("type","checkbox");htmlInput.element=element;htmlInput.cellrenderer=this;var cellEditor=new CellEditor();cellEditor.editablegrid=this.editablegrid;cellEditor.column=this.column;htmlInput.onclick=function(event){element.rowIndex=this.cellrenderer.editablegrid.getRowIndex(element.parentNode);element.isEditing=true;cellEditor.applyEditing(element,htmlInput.checked?true:false)};element.appendChild(htmlInput);htmlInput.checked=value;htmlInput.disabled=(!this.column.editable||!this.editablegrid.isEditable(element.rowIndex,element.columnIndex));EditableGrid.prototype.addClassName(element,"boolean")};function EmailCellRenderer(config){this.init(config)}EmailCellRenderer.prototype=new CellRenderer();EmailCellRenderer.prototype.render=function(element,value){element.innerHTML=value?"<a href='mailto:"+value+"'>"+value+"</a>":""};function WebsiteCellRenderer(config){this.init(config)}WebsiteCellRenderer.prototype=new CellRenderer();WebsiteCellRenderer.prototype.render=function(element,value){element.innerHTML=value?"<a href='"+(value.indexOf("//")==-1?"http://"+value:value)+"'>"+value+"</a>":""};function DateCellRenderer(config){this.init(config)}DateCellRenderer.prototype=new CellRenderer;DateCellRenderer.prototype.render=function(cell,value){var date=this.editablegrid.checkDate(value);if(typeof date=="object"){cell.innerHTML=date.formattedDate}else{cell.innerHTML=value?value:""}cell.style.whiteSpace="nowrap"};function SortHeaderRenderer(columnName,cellRenderer){this.columnName=columnName;this.cellRenderer=cellRenderer}SortHeaderRenderer.prototype=new CellRenderer();SortHeaderRenderer.prototype.render=function(cell,value){if(!value){if(this.cellRenderer){this.cellRenderer.render(cell,value)}}else{var link=document.createElement("a");cell.appendChild(link);link.columnName=this.columnName;link.style.cursor="pointer";link.innerHTML=value;link.editablegrid=this.editablegrid;link.renderer=this;link.onclick=function(){with(this.editablegrid){var cols=tHead.rows[0].cells;var clearPrevious=-1;var backOnFirstPage=false;if(sortedColumnName!=this.columnName){clearPrevious=sortedColumnName;sortedColumnName=this.columnName;sortDescending=false;backOnFirstPage=true}else{if(!sortDescending){sortDescending=true}else{clearPrevious=sortedColumnName;sortedColumnName=-1;sortDescending=false;backOnFirstPage=true}}sort(sortedColumnName,sortDescending,backOnFirstPage)}};if(this.editablegrid.sortedColumnName==this.columnName){cell.appendChild(document.createTextNode("\u00a0"));cell.appendChild(this.editablegrid.sortDescending?this.editablegrid.sortDownElement:this.editablegrid.sortUpElement)}if(this.cellRenderer){this.cellRenderer.render(cell,value)}}};function CellEditor(config){this.init(config)}CellEditor.prototype.init=function(config){if(config){for(var p in config){this[p]=config[p]}}};CellEditor.prototype.edit=function(rowIndex,columnIndex,element,value){element.isEditing=true;element.rowIndex=rowIndex;element.columnIndex=columnIndex;var editorInput=this.getEditor(element,value);if(!editorInput){return false}editorInput.element=element;editorInput.celleditor=this;editorInput.onkeydown=function(event){event=event||window.event;if(event.keyCode==13||event.keyCode==9){this.onblur_backup=this.onblur;this.onblur=null;if(this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))===false){this.onblur=this.onblur_backup}if(event.keyCode==9){if(this.element.rowIndex>=0&&this.celleditor.editablegrid.getColumnCount()>0&&this.celleditor.editablegrid.getRowCount()>0){var candidateRowIndex=this.element.rowIndex;var candidateColumnIndex=this.element.columnIndex;while(true){if(candidateColumnIndex<this.celleditor.editablegrid.getColumnCount()-1){candidateColumnIndex++}else{candidateRowIndex++;candidateColumnIndex=0}if(!this.celleditor.editablegrid.getRow(candidateRowIndex)){candidateRowIndex=0}var column=this.celleditor.editablegrid.getColumn(candidateColumnIndex);if(column.editable&&column.datatype!="boolean"&&this.celleditor.editablegrid.isEditable(candidateRowIndex,candidateColumnIndex)){this.celleditor.editablegrid.editCell(candidateRowIndex,candidateColumnIndex);break}if(candidateRowIndex==this.element.rowIndex&&candidateColumnIndex==this.element.columnIndex){break}}}}return false}if(event.keyCode==27){this.onblur=null;this.celleditor.cancelEditing(this.element);return false}};if(!this.editablegrid.allowSimultaneousEdition){editorInput.onblur=this.editablegrid.saveOnBlur?function(event){this.onblur_backup=this.onblur;this.onblur=null;if(this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))===false){this.onblur=this.onblur_backup}}:function(event){this.onblur=null;this.celleditor.cancelEditing(this.element)}}this.displayEditor(element,editorInput);this.autoFocus(editorInput)};CellEditor.prototype.autoFocus=function(editorInput){editorInput.focus()};CellEditor.prototype.getEditor=function(element,value){return null};CellEditor.prototype.getEditorValue=function(editorInput){return editorInput.value};CellEditor.prototype.formatValue=function(value){return value};CellEditor.prototype.displayEditor=function(element,editorInput,adjustX,adjustY){editorInput.style.fontFamily=this.editablegrid.getStyle(element,"fontFamily","font-family");editorInput.style.fontSize=this.editablegrid.getStyle(element,"fontSize","font-size");if(this.editablegrid.editmode=="static"){while(element.hasChildNodes()){element.removeChild(element.firstChild)}element.appendChild(editorInput)}if(this.editablegrid.editmode=="absolute"){element.appendChild(editorInput);editorInput.style.position="absolute";var paddingLeft=this.editablegrid.paddingLeft(element);var paddingTop=this.editablegrid.paddingTop(element);var offsetScrollX=this.editablegrid.getScrollXOffset(element);var offsetScrollY=this.editablegrid.getScrollYOffset(element);var vCenter=this.editablegrid.verticalAlign(element)=="middle"?(element.offsetHeight-editorInput.offsetHeight)/2-paddingTop:0;editorInput.style.left=(this.editablegrid.getCellX(element)-offsetScrollX+paddingLeft+(adjustX?adjustX:0))+"px";editorInput.style.top=(this.editablegrid.getCellY(element)-offsetScrollY+paddingTop+vCenter+(adjustY?adjustY:0))+"px";if(this.column.datatype=="integer"||this.column.datatype=="double"){var rightPadding=this.editablegrid.getCellX(element)-offsetScrollX+element.offsetWidth-(parseInt(editorInput.style.left)+editorInput.offsetWidth);editorInput.style.left=(parseInt(editorInput.style.left)+rightPadding)+"px";editorInput.style.textAlign=EditableGrid.prototype.getStyle(element,"textAlign","text-align")}}if(this.editablegrid.editmode=="fixed"){var editorzone=_$(this.editablegrid.editorzoneid);while(editorzone.hasChildNodes()){editorzone.removeChild(editorzone.firstChild)}editorzone.appendChild(editorInput)}if(element&&element.isEditing&&this.editablegrid.openedCellEditor){this.editablegrid.openedCellEditor(element.rowIndex,element.columnIndex)}};CellEditor.prototype._clearEditor=function(element){element.isEditing=false;if(this.editablegrid.editmode=="fixed"){var editorzone=_$(this.editablegrid.editorzoneid);while(editorzone.hasChildNodes()){editorzone.removeChild(editorzone.firstChild)}}};CellEditor.prototype.cancelEditing=function(element){with(this){if(element&&element.isEditing){var renderer=this==column.headerEditor?column.headerRenderer:column.cellRenderer;renderer._render(element.rowIndex,element.columnIndex,element,editablegrid.getValueAt(element.rowIndex,element.columnIndex));_clearEditor(element)}}};CellEditor.prototype.applyEditing=function(element,newValue){with(this){if(element&&element.isEditing){if(!column.isValid(newValue)){return false}var formattedValue=formatValue(newValue);var previousValue=editablegrid.setValueAt(element.rowIndex,element.columnIndex,formattedValue);var newValue=editablegrid.getValueAt(element.rowIndex,element.columnIndex);if(!this.editablegrid.isSame(newValue,previousValue)){editablegrid.modelChanged(element.rowIndex,element.columnIndex,previousValue,newValue,editablegrid.getRow(element.rowIndex))}_clearEditor(element);return true}return false}};function TextCellEditor(size,maxlen,config){if(size){this.fieldSize=size}if(maxlen){this.maxLength=maxlen}if(config){this.init(config)}}TextCellEditor.prototype=new CellEditor();TextCellEditor.prototype.fieldSize=-1;TextCellEditor.prototype.maxLength=-1;TextCellEditor.prototype.autoHeight=true;TextCellEditor.prototype.editorValue=function(value){return value};TextCellEditor.prototype.updateStyle=function(htmlInput){if(this.column.isValid(this.getEditorValue(htmlInput))){this.editablegrid.removeClassName(htmlInput,this.editablegrid.invalidClassName)}else{this.editablegrid.addClassName(htmlInput,this.editablegrid.invalidClassName)}};TextCellEditor.prototype.getEditor=function(element,value){var htmlInput=document.createElement("input");htmlInput.setAttribute("type","text");if(this.maxLength>0){htmlInput.setAttribute("maxlength",this.maxLength)}if(this.fieldSize>0){htmlInput.setAttribute("size",this.fieldSize)}else{htmlInput.style.width=this.editablegrid.autoWidth(element)+"px"}var autoHeight=this.editablegrid.autoHeight(element);if(this.autoHeight){htmlInput.style.height=autoHeight+"px"}htmlInput.value=this.editorValue(value);htmlInput.onkeyup=function(event){this.celleditor.updateStyle(this)};return htmlInput};TextCellEditor.prototype.displayEditor=function(element,htmlInput){CellEditor.prototype.displayEditor.call(this,element,htmlInput,-1*this.editablegrid.borderLeft(htmlInput),-1*(this.editablegrid.borderTop(htmlInput)+1));this.updateStyle(htmlInput);htmlInput.select()};function NumberCellEditor(type,config){this.type=type;this.init(config)}NumberCellEditor.prototype=new TextCellEditor(-1,32);NumberCellEditor.prototype.editorValue=function(value){return(value===null||isNaN(value))?"":(value+"").replace(".",this.column.decimal_point)};NumberCellEditor.prototype.getEditorValue=function(editorInput){return editorInput.value.replace(",",".")};NumberCellEditor.prototype.formatValue=function(value){return this.type=="integer"?parseInt(value):parseFloat(value)};function SelectCellEditor(config){this.minWidth=75;this.minHeight=22;this.adaptHeight=true;this.adaptWidth=true;this.init(config)}SelectCellEditor.prototype=new CellEditor();SelectCellEditor.prototype.isValueSelected=function(htmlInput,optionValue,value){return(!optionValue&&!value)||(optionValue==value)};SelectCellEditor.prototype.getEditor=function(element,value){var self=this;var htmlInput=document.createElement("select");if(this.adaptWidth&&typeof jQuery.fn.select2=="undefined"){htmlInput.style.width=Math.max(this.minWidth,this.editablegrid.autoWidth(element))+"px"}if(this.adaptHeight&&typeof jQuery.fn.select2=="undefined"){htmlInput.style.height=Math.max(this.minHeight,this.editablegrid.autoHeight(element))+"px"}var optionValues=this.column.getOptionValuesForEdit(element.rowIndex);var index=0,valueFound=false;for(var optionIndex=0;optionIndex<optionValues.length;optionIndex++){var optionValue=optionValues[optionIndex];if(typeof optionValue.values=="object"){var optgroup=document.createElement("optgroup");optgroup.label=optionValue.label;htmlInput.appendChild(optgroup);for(var groupOptionIndex=0;groupOptionIndex<optionValue.values.length;groupOptionIndex++){var groupOptionValue=optionValue.values[groupOptionIndex];var option=document.createElement("option");option.text=groupOptionValue.label;option.value=groupOptionValue.value?groupOptionValue.value:"";optgroup.appendChild(option);if(this.isValueSelected(htmlInput,groupOptionValue.value,value)){option.selected=true;valueFound=true}else{option.selected=false}index++}}else{var option=document.createElement("option");option.text=optionValue.label;option.value=optionValue.value?optionValue.value:"";try{htmlInput.add(option,null)}catch(e){htmlInput.add(option)}if(this.isValueSelected(htmlInput,optionValue.value,value)){option.selected=true;valueFound=true}else{option.selected=false}index++}}if(!valueFound){var option=document.createElement("option");var value_label=this.editablegrid.getDisplayValueAt(element.rowIndex,element.columnIndex);option.text=value_label?value_label:"";option.value=value?value:"";try{htmlInput.add(option,htmlInput.options[0])}catch(e){htmlInput.add(option)}htmlInput.selectedIndex=0}htmlInput.onchange=function(event){this.onblur=null;this.celleditor.applyEditing(this.element,self.getEditorValue(this))};return htmlInput};SelectCellEditor.prototype.displayEditor=function(element,htmlInput){CellEditor.prototype.displayEditor.call(this,element,htmlInput);if(typeof jQuery.fn.select2!="undefined"){htmlInput.onblur=null;htmlInput.onchange=null;this.select2(element,htmlInput);jQuery(htmlInput).siblings("span.select2-container").css("position","absolute").css("left",htmlInput.style.left);jQuery(htmlInput).select2("open");jQuery(htmlInput).on("select2:close",function(){this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))}).on("select2-blur",function(){this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))}).on("select2-close",function(){this.celleditor.applyEditing(this.element,this.celleditor.getEditorValue(this))})}};SelectCellEditor.prototype.select2=function(element,htmlInput){jQuery(htmlInput).select2({dropdownAutoWidth:true,minimumResultsForSearch:10})};SelectCellEditor.prototype.autoFocus=function(editorInput){if(typeof jQuery.fn.select2!="undefined"){return true}return CellEditor.prototype.autoFocus.call(this,editorInput)};SelectCellEditor.prototype.getEditorValue=function(editorInput){if(typeof jQuery.fn.select2!="undefined"){return jQuery(editorInput).val()}return CellEditor.prototype.getEditorValue.call(this,editorInput)};SelectCellEditor.prototype.cancelEditing=function(element){if(typeof jQuery.fn.select2!="undefined"){jQuery(element).find("select").select2("destroy")}CellEditor.prototype.cancelEditing.call(this,element)};function DateCellEditor(config){this.init(config)}DateCellEditor.prototype=new TextCellEditor();DateCellEditor.prototype.displayEditor=function(element,htmlInput){TextCellEditor.prototype.displayEditor.call(this,element,htmlInput);jQuery(htmlInput).datepicker({dateFormat:(this.editablegrid.dateFormat=="EU"?"dd/mm/yy":"mm/dd/yy"),changeMonth:true,changeYear:true,yearRange:"c-100:c+10",beforeShow:function(){this.onblur_backup=this.onblur;this.onblur=null},onClose:function(dateText){if(dateText!=""){this.celleditor.applyEditing(htmlInput.element,dateText)}else{if(this.onblur_backup!=null){this.onblur_backup()}}}}).datepicker("show")};function CellValidator(config){var props={isValid:null};for(var p in props){if(typeof config!="undefined"&&typeof config[p]!="undefined"){this[p]=config[p]}}}CellValidator.prototype.isValid=function(value){return true};function NumberCellValidator(type){this.type=type}NumberCellValidator.prototype=new CellValidator;NumberCellValidator.prototype.isValid=function(value){if(isNaN(value)){return false}if(this.type=="integer"&&value!=""&&parseInt(value)!=parseFloat(value)){return false}return true};function EmailCellValidator(){}EmailCellValidator.prototype=new CellValidator;EmailCellValidator.prototype.isValid=function(value){return value==""||/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(value)};function WebsiteCellValidator(){}WebsiteCellValidator.prototype=new CellValidator;WebsiteCellValidator.prototype.isValid=function(value){return value==""||(value.indexOf(".")>0&&value.indexOf(".")<(value.length-2))};function DateCellValidator(grid){this.grid=grid}DateCellValidator.prototype=new CellValidator;DateCellValidator.prototype.isValid=function(value){return value==""||typeof this.grid.checkDate(value)=="object"};EditableGrid.prototype._convertOptions=function(optionValues){if(optionValues!==null&&(!(optionValues instanceof Array))&&typeof optionValues=="object"){var _converted=[];for(var value in optionValues){if(typeof optionValues[value]=="object"){_converted.push({label:value,values:this._convertOptions(optionValues[value])})}else{_converted.push({value:value,label:optionValues[value]})}}optionValues=_converted}return optionValues};EditableGrid.prototype.setCookie=function(c_name,value,exdays){var exdate=new Date();exdate.setDate(exdate.getDate()+exdays);var c_value=escape(value)+((exdays==null)?"":"; expires="+exdate.toUTCString());document.cookie=c_name+"="+c_value};EditableGrid.prototype.getCookie=function(c_name){var _cookies=document.cookie.split(";");for(var i=0;i<_cookies.length;i++){var x=_cookies[i].substr(0,_cookies[i].indexOf("="));var y=_cookies[i].substr(_cookies[i].indexOf("=")+1);x=x.replace(/^\s+|\s+$/g,"");if(x==c_name){return unescape(y)}}return null};EditableGrid.prototype.has_local_storage=function(){try{return"localStorage" in window&&window.localStorage!==null}catch(e){return false}};EditableGrid.prototype._localset=function(key,value){if(this.has_local_storage()){localStorage.setItem(key,value)}else{this.setCookie(key,value,null)}};EditableGrid.prototype._localunset=function(key){if(this.has_local_storage()){localStorage.removeItem(key)}else{this.setCookie(key,null,null)}};EditableGrid.prototype._localget=function(key){if(this.has_local_storage()){return localStorage.getItem(key)}return this.getCookie(key)};EditableGrid.prototype._localisset=function(key){if(this.has_local_storage()){return localStorage.getItem(key)!==null&&localStorage.getItem(key)!="undefined"}return this.getCookie(key)!==null};EditableGrid.prototype.localset=function(key,value){if(this.enableStore){return this._localset(this.name+"_"+key,value)}};EditableGrid.prototype.localunset=function(key){if(this.enableStore){return this._localunset(this.name+"_"+key,value)}};EditableGrid.prototype.localget=function(key){return this.enableStore?this._localget(this.name+"_"+key):null};EditableGrid.prototype.localisset=function(key){return this.enableStore?this._localget(this.name+"_"+key)!==null:false};EditableGrid.prototype.unsort=function(a,b){aa=isNaN(a[2])?0:parseFloat(a[2]);bb=isNaN(b[2])?0:parseFloat(b[2]);return aa-bb};EditableGrid.prototype.sort_stable=function(sort_function,descending){return function(a,b){var sort=descending?sort_function(b,a):sort_function(a,b);if(sort!=0){return sort}return EditableGrid.prototype.unsort(a,b)}};EditableGrid.prototype.sort_numeric=function(a,b){aa=isNaN(parseFloat(a[0]))?0:parseFloat(a[0]);bb=isNaN(parseFloat(b[0]))?0:parseFloat(b[0]);return aa-bb};EditableGrid.prototype.sort_boolean=function(a,b){aa=!a[0]||a[0]=="false"?0:1;bb=!b[0]||b[0]=="false"?0:1;return aa-bb};EditableGrid.prototype.sort_alpha=function(a,b){if(!a[0]&&!b[0]){return 0}if(a[0]&&!b[0]){return 1}if(!a[0]&&b[0]){return -1}if(a[0].toLowerCase()==b[0].toLowerCase()){return 0}return a[0].toLowerCase().localeCompare(b[0].toLowerCase())};EditableGrid.prototype.sort_date=function(a,b){date=EditableGrid.prototype.checkDate(a[0]);aa=typeof date=="object"?date.sortDate:0;date=EditableGrid.prototype.checkDate(b[0]);bb=typeof date=="object"?date.sortDate:0;return aa-bb};EditableGrid.prototype.getStyle=function(element,stylePropCamelStyle,stylePropCSSStyle){stylePropCSSStyle=stylePropCSSStyle||stylePropCamelStyle;if(element.currentStyle){return element.currentStyle[stylePropCamelStyle]}else{if(window.getComputedStyle){return document.defaultView.getComputedStyle(element,null).getPropertyValue(stylePropCSSStyle)}}return element.style[stylePropCamelStyle]};EditableGrid.prototype.isStatic=function(element){var position=this.getStyle(element,"position");return(!position||position=="static")};EditableGrid.prototype.verticalAlign=function(element){return this.getStyle(element,"verticalAlign","vertical-align")};EditableGrid.prototype.paddingLeft=function(element){var padding=parseInt(this.getStyle(element,"paddingLeft","padding-left"));return isNaN(padding)?0:Math.max(0,padding)};EditableGrid.prototype.paddingRight=function(element){var padding=parseInt(this.getStyle(element,"paddingRight","padding-right"));return isNaN(padding)?0:Math.max(0,padding)};EditableGrid.prototype.paddingTop=function(element){var padding=parseInt(this.getStyle(element,"paddingTop","padding-top"));return isNaN(padding)?0:Math.max(0,padding)};EditableGrid.prototype.paddingBottom=function(element){var padding=parseInt(this.getStyle(element,"paddingBottom","padding-bottom"));return isNaN(padding)?0:Math.max(0,padding)};EditableGrid.prototype.borderLeft=function(element){var border_l=parseInt(this.getStyle(element,"borderRightWidth","border-right-width"));var border_r=parseInt(this.getStyle(element,"borderLeftWidth","border-left-width"));border_l=isNaN(border_l)?0:border_l;border_r=isNaN(border_r)?0:border_r;return Math.max(border_l,border_r)};EditableGrid.prototype.borderRight=function(element){return this.borderLeft(element)};EditableGrid.prototype.borderTop=function(element){var border_t=parseInt(this.getStyle(element,"borderTopWidth","border-top-width"));var border_b=parseInt(this.getStyle(element,"borderBottomWidth","border-bottom-width"));border_t=isNaN(border_t)?0:border_t;border_b=isNaN(border_b)?0:border_b;return Math.max(border_t,border_b)};EditableGrid.prototype.borderBottom=function(element){return this.borderTop(element)};EditableGrid.prototype.autoWidth=function(element){return element.offsetWidth-this.paddingLeft(element)-this.paddingRight(element)-this.borderLeft(element)-this.borderRight(element)};EditableGrid.prototype.autoHeight=function(element){return element.offsetHeight-this.paddingTop(element)-this.paddingBottom(element)-this.borderTop(element)-this.borderBottom(element)};EditableGrid.prototype.detectDir=function(){var base=location.href;var e=document.getElementsByTagName("base");for(var i=0;i<e.length;i++){if(e[i].href){base=e[i].href}}e=document.getElementsByTagName("script");for(var i=0;i<e.length;i++){if(e[i].src&&/(^|\/)editablegrid[^\/]*\.js([?#].*)?$/i.test(e[i].src)){var src=new URI(e[i].src);var srcAbs=src.toAbsolute(base);srcAbs.path=srcAbs.path.replace(/[^\/]+$/,"");srcAbs.path=srcAbs.path.replace(/\/$/,"");delete srcAbs.query;delete srcAbs.fragment;return srcAbs.toString()}}return false};EditableGrid.prototype.isSame=function(v1,v2){if(v1===v2){return true}if(typeof v1=="number"&&isNaN(v1)&&typeof v2=="number"&&isNaN(v2)){return true}if(v1===""&&v2===null){return true}if(v2===""&&v1===null){return true}return false};EditableGrid.prototype.strip=function(str){return str.replace(/^\s+/,"").replace(/\s+$/,"")};EditableGrid.prototype.hasClassName=function(element,className){return(element.className.length>0&&(element.className==className||new RegExp("(^|\\s)"+className.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"(\\s|$)").test(element.className)))};EditableGrid.prototype.addClassName=function(element,className){if(!this.hasClassName(element,className)){element.className+=(element.className?" ":"")+className}};EditableGrid.prototype.removeClassName=function(element,className){element.className=this.strip(element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)")," "))};String.prototype.trim=function(){return(this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,""))};String.prototype.contains=function(str){return(this.match(str)==str)};String.prototype.startsWith=function(str){return(this.match("^"+str)==str)};String.prototype.endsWith=function(str){return(this.match(str+"$")==str)};EditableGrid.prototype.checkDate=function(strDate,strDatestyle){strDatestyle=strDatestyle||this.dateFormat;strDatestyle=strDatestyle||"EU";var strDateArray;var strDay;var strMonth;var strYear;var intday;var intMonth;var intYear;var booFound=false;var strSeparatorArray=new Array("-"," ","/",".");var intElementNr;var err=0;var strMonthArray=this.shortMonthNames;strMonthArray=strMonthArray||["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(!strDate||strDate.length<1){return 0}for(intElementNr=0;intElementNr<strSeparatorArray.length;intElementNr++){if(strDate.indexOf(strSeparatorArray[intElementNr])!=-1){strDateArray=strDate.split(strSeparatorArray[intElementNr]);if(strDateArray.length!=3){return 1}else{strDay=strDateArray[0];strMonth=strDateArray[1];strYear=strDateArray[2]}booFound=true}}if(booFound==false){if(strDate.length<=5){return 1}strDay=strDate.substr(0,2);strMonth=strDate.substr(2,2);strYear=strDate.substr(4)}if(strDatestyle=="US"){strTemp=strDay;strDay=strMonth;strMonth=strTemp}intday=parseInt(strDay,10);if(isNaN(intday)){return 2}intMonth=parseInt(strMonth,10);if(isNaN(intMonth)){for(i=0;i<12;i++){if(strMonth.toUpperCase()==strMonthArray[i].toUpperCase()){intMonth=i+1;strMonth=strMonthArray[i];i=12}}if(isNaN(intMonth)){return 3}}if(intMonth>12||intMonth<1){return 5}intYear=parseInt(strYear,10);if(isNaN(intYear)){return 4}if(intYear<70){intYear=2000+intYear;strYear=""+intYear}if(intYear<100){intYear=1900+intYear;strYear=""+intYear}if(intYear<1900||intYear>2100){return 11}if((intMonth==1||intMonth==3||intMonth==5||intMonth==7||intMonth==8||intMonth==10||intMonth==12)&&(intday>31||intday<1)){return 6}if((intMonth==4||intMonth==6||intMonth==9||intMonth==11)&&(intday>30||intday<1)){return 7}if(intMonth==2){if(intday<1){return 8}if(LeapYear(intYear)==true){if(intday>29){return 9}}else{if(intday>28){return 10}}}return{formattedDate:(strDatestyle=="US"?strMonthArray[intMonth-1]+" "+intday+" "+strYear:intday+" "+strMonthArray[intMonth-1]+" "+strYear),sortDate:Date.parse(intMonth+"/"+intday+"/"+intYear),dbDate:intYear+"-"+intMonth+"-"+intday}};function LeapYear(intYear){if(intYear%100==0){if(intYear%400==0){return true}}else{if((intYear%4)==0){return true}}return false}URI=function(uri){this.scheme=null;this.authority=null;this.path="";this.query=null;this.fragment=null;this.parse=function(uri){var m=uri.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);this.scheme=m[3]?m[2]:null;this.authority=m[5]?m[6]:null;this.path=m[7];this.query=m[9]?m[10]:null;this.fragment=m[12]?m[13]:null;return this};this.toString=function(){var result="";if(this.scheme!=null){result=result+this.scheme+":"}if(this.authority!=null){result=result+"//"+this.authority}if(this.path!=null){result=result+this.path}if(this.query!=null){result=result+"?"+this.query}if(this.fragment!=null){result=result+"#"+this.fragment}return result};this.toAbsolute=function(base){var base=new URI(base);var r=this;var t=new URI;if(base.scheme==null){return false}if(r.scheme!=null&&r.scheme.toLowerCase()==base.scheme.toLowerCase()){r.scheme=null}if(r.scheme!=null){t.scheme=r.scheme;t.authority=r.authority;t.path=removeDotSegments(r.path);t.query=r.query}else{if(r.authority!=null){t.authority=r.authority;t.path=removeDotSegments(r.path);t.query=r.query}else{if(r.path==""){t.path=base.path;if(r.query!=null){t.query=r.query}else{t.query=base.query}}else{if(r.path.substr(0,1)=="/"){t.path=removeDotSegments(r.path)}else{if(base.authority!=null&&base.path==""){t.path="/"+r.path}else{t.path=base.path.replace(/[^\/]+$/,"")+r.path}t.path=removeDotSegments(t.path)}t.query=r.query}t.authority=base.authority}t.scheme=base.scheme}t.fragment=r.fragment;return t};function removeDotSegments(path){var out="";while(path){if(path.substr(0,3)=="../"||path.substr(0,2)=="./"){path=path.replace(/^\.+/,"").substr(1)}else{if(path.substr(0,3)=="/./"||path=="/."){path="/"+path.substr(3)}else{if(path.substr(0,4)=="/../"||path=="/.."){path="/"+path.substr(4);out=out.replace(/\/?[^\/]*$/,"")}else{if(path=="."||path==".."){path=""}else{var rm=path.match(/^\/?[^\/]*/)[0];path=path.substr(rm.length);out=out+rm}}}}}return out}if(uri){this.parse(uri)}};function get_html_translation_table(table,quote_style){var entities={},hash_map={},decimal=0,symbol="";var constMappingTable={},constMappingQuoteStyle={};var useTable={},useQuoteStyle={};constMappingTable[0]="HTML_SPECIALCHARS";constMappingTable[1]="HTML_ENTITIES";constMappingQuoteStyle[0]="ENT_NOQUOTES";constMappingQuoteStyle[2]="ENT_COMPAT";constMappingQuoteStyle[3]="ENT_QUOTES";useTable=!isNaN(table)?constMappingTable[table]:table?table.toUpperCase():"HTML_SPECIALCHARS";useQuoteStyle=!isNaN(quote_style)?constMappingQuoteStyle[quote_style]:quote_style?quote_style.toUpperCase():"ENT_COMPAT";if(useTable!=="HTML_SPECIALCHARS"&&useTable!=="HTML_ENTITIES"){throw new Error("Table: "+useTable+" not supported")}if(useTable==="HTML_ENTITIES"){entities["160"]="&nbsp;";entities["161"]="&iexcl;";entities["162"]="&cent;";entities["163"]="&pound;";entities["164"]="&curren;";entities["165"]="&yen;";entities["166"]="&brvbar;";entities["167"]="&sect;";entities["168"]="&uml;";entities["169"]="&copy;";entities["170"]="&ordf;";entities["171"]="&laquo;";entities["172"]="&not;";entities["173"]="&shy;";entities["174"]="&reg;";entities["175"]="&macr;";entities["176"]="&deg;";entities["177"]="&plusmn;";entities["178"]="&sup2;";entities["179"]="&sup3;";entities["180"]="&acute;";entities["181"]="&micro;";entities["182"]="&para;";entities["183"]="&middot;";entities["184"]="&cedil;";entities["185"]="&sup1;";entities["186"]="&ordm;";entities["187"]="&raquo;";entities["188"]="&frac14;";entities["189"]="&frac12;";entities["190"]="&frac34;";entities["191"]="&iquest;";entities["192"]="&Agrave;";entities["193"]="&Aacute;";entities["194"]="&Acirc;";entities["195"]="&Atilde;";entities["196"]="&Auml;";entities["197"]="&Aring;";entities["198"]="&AElig;";entities["199"]="&Ccedil;";entities["200"]="&Egrave;";entities["201"]="&Eacute;";entities["202"]="&Ecirc;";entities["203"]="&Euml;";entities["204"]="&Igrave;";entities["205"]="&Iacute;";entities["206"]="&Icirc;";entities["207"]="&Iuml;";entities["208"]="&ETH;";entities["209"]="&Ntilde;";entities["210"]="&Ograve;";entities["211"]="&Oacute;";entities["212"]="&Ocirc;";entities["213"]="&Otilde;";entities["214"]="&Ouml;";entities["215"]="&times;";entities["216"]="&Oslash;";entities["217"]="&Ugrave;";entities["218"]="&Uacute;";entities["219"]="&Ucirc;";entities["220"]="&Uuml;";entities["221"]="&Yacute;";entities["222"]="&THORN;";entities["223"]="&szlig;";entities["224"]="&agrave;";entities["225"]="&aacute;";entities["226"]="&acirc;";entities["227"]="&atilde;";entities["228"]="&auml;";entities["229"]="&aring;";entities["230"]="&aelig;";entities["231"]="&ccedil;";entities["232"]="&egrave;";entities["233"]="&eacute;";entities["234"]="&ecirc;";entities["235"]="&euml;";entities["236"]="&igrave;";entities["237"]="&iacute;";entities["238"]="&icirc;";entities["239"]="&iuml;";entities["240"]="&eth;";entities["241"]="&ntilde;";entities["242"]="&ograve;";entities["243"]="&oacute;";entities["244"]="&ocirc;";entities["245"]="&otilde;";entities["246"]="&ouml;";entities["247"]="&divide;";entities["248"]="&oslash;";entities["249"]="&ugrave;";entities["250"]="&uacute;";entities["251"]="&ucirc;";entities["252"]="&uuml;";entities["253"]="&yacute;";entities["254"]="&thorn;";entities["255"]="&yuml;"}if(useQuoteStyle!=="ENT_NOQUOTES"){entities["34"]="&quot;"}if(useQuoteStyle==="ENT_QUOTES"){entities["39"]="&#39;"}entities["60"]="&lt;";entities["62"]="&gt;";for(decimal in entities){symbol=String.fromCharCode(decimal);hash_map[symbol]=entities[decimal]}return hash_map}function html_entity_decode(string,quote_style){var hash_map={},symbol="",tmp_str="";tmp_str=string.toString();if(false===(hash_map=get_html_translation_table("HTML_ENTITIES",quote_style))){return false}hash_map["'"]="&#039;";for(symbol in hash_map){tmp_str=tmp_str.split(hash_map[symbol]).join(symbol)}return tmp_str}function htmlentities(string,quote_style){var hash_map={},symbol="",tmp_str="";tmp_str=string.toString();if(false===(hash_map=get_html_translation_table("HTML_ENTITIES",quote_style))){return false}tmp_str=tmp_str.split("&").join("&amp;");hash_map["'"]="&#039;";for(symbol in hash_map){tmp_str=tmp_str.split(symbol).join(hash_map[symbol])}return tmp_str}function htmlspecialchars(string,quote_style){var hash_map={},symbol="",tmp_str="";tmp_str=string.toString();if(false===(hash_map=get_html_translation_table("HTML_SPECIALCHARS",quote_style))){return false}tmp_str=tmp_str.split("&").join("&amp;");for(symbol in hash_map){tmp_str=tmp_str.split(symbol).join(hash_map[symbol])}return tmp_str}function number_format(number,decimals,dec_point,thousands_sep){number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=!isFinite(+number)?0:+number,prec=!isFinite(+decimals)?0:decimals,sep=(typeof thousands_sep==="undefined")?",":thousands_sep,dec=(typeof dec_point==="undefined")?".":dec_point,s="",toFixedFix=function(n,prec){var k=Math.pow(10,prec);return""+Math.round(n*k)/k};s=(prec<0?(""+n):(prec?toFixedFix(n,prec):""+Math.round(n))).split(".");if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)}if((s[1]||"").length<prec){s[1]=s[1]||"";s[1]+=new Array(prec-s[1].length+1).join("0")}return s.join(dec)}};