function init(){rgb_led_matrix_init()}function rgb_led_matrix_init(){var D=false,B="localhost:8080",L=null,e=8,a=1,N=1,p=false,x=false,K=1,G=new Uint8Array(e*a*3),m=document.getElementById("matrix"),Q=m.getContext("2d"),J=window.innerWidth,o=window.innerHeight,w=J/(e+1),P=o/(a+1),I=w*0.4,h=0,f=0,O=null,c=null,n=null,d=null,r=["cpu_meter","aurora","timesquare","unicorn","fireplace","notifier","ambilight"],k=["s3d.jpg","twitter.jpg","vrip.jpg"],u=["s3d.wav","tweet.wav","vrip.wav"];function F(S,U,T){D&&console.log("WEBSOCKET: CONNECT");try{n=U;d=T;socket=new WebSocket(S);socket.onopen=M;socket.onclose=t;socket.onerror=l;socket.onmessage=function(W){C(W)}}catch(V){D&&console.log("WEBSOCKET: CONNECT ERROR");D&&console.log(V.message)}}function M(){D&&console.log("WEBSOCKET: OPEN");socket=this;n()}function C(T){D&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+T.data.toString());var S=JSON.parse(T.data.toString());var V=S.method;var U=S.params;switch(V){case"setColors":e=U.width;a=U.height;G=U.colors.data;q();default:}}function t(S){D&&console.log("WEBSOCKET: ONCLOSE");L=null;d()}function l(S){D&&console.log("WEBSOCKET: ONERROR")}function A(T,S){D&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+H(T,S));if(socket.readyState===socket.OPEN){socket.send(H(T,S))}}function H(U,T){var S={method:U,params:T};return JSON.stringify(S)}function z(){D&&console.log("UI INIT");s()}function E(){D&&console.log("UI CONNECTED");x=true;R()}function v(){D&&console.log("UI DISCONNECTED");x=false;while(K--){window.clearTimeout(K)}K=setTimeout(s,1000)}function s(){if(!x){F("ws://"+B,E,v)}}function R(){var U={};var S=Math.floor(Math.random()*8+1);var T=Math.floor(Math.random()*8+1);U.shader=r[Math.floor(Math.random()*r.length)];U.shader="notifier";S=8;T=8;if(U.shader=="notifier"){U.width=8;U.height=8;U.image=k[Math.floor(Math.random()*k.length)];U.sound=u[Math.floor(Math.random()*u.length)];U.duration=0.3}U.width=S;U.height=T;A("set_shader",U);while(K--){window.clearTimeout(K)}K=setTimeout(R,10000)}z();function b(){D&&console.log("resizeMatrix");J=window.innerWidth;o=window.innerHeight;h=0;f=0;m.width=J;m.height=o;m.style.width=J;m.style.height=o;w=J/(e+1);P=o/(a+1);if(w>P){w=P}else{P=w}f=(o-P*(a+1))/2;h=(J-w*(e+1))/2;I=w*0.4}function q(){b();D&&console.log("drawMatrix");if(e*a*3!=G.length){return}for(i=0;i<a;i++){for(j=0;j<e;j++){var S=w*(j+1),T=P*(i+1);g(S,T,I,y(i,j))}}}function y(W,T){var V=G[(W*e+T)*3+0],U=G[(W*e+T)*3+1],S=G[(W*e+T)*3+2];if(typeof V!=="undefined"&&U!=="undefined"&&S!=="undefined"){return"rgba("+V+","+U+","+S+",1)"}else{return null}}function g(T,V,S,U){D&&console.log("drawDot: "+U);if(U){Q.beginPath();Q.arc(T+h,V+f,S,0,2*Math.PI,false);Q.fillStyle=U;Q.fill();Q.lineWidth=1;Q.strokeStyle="#101010";Q.stroke()}}b();q();document.getElementsByTagName("BODY")[0].onresize=q};