function rgb_led_matrix_init(){var ab=false,l=1,J=false,ac=false,Q=1,aa=null,a=true,af=document.getElementById("server_name"),ar=document.getElementById("canvas"),E=document.getElementById("ui"),k=document.getElementById("menu"),au=document.getElementById("show_button"),Z=document.getElementById("server_button"),Y=document.getElementById("layer_button"),m=document.getElementById("shader_button"),n=document.getElementById("device_button"),b=document.getElementById("connect_button"),aj=document.getElementById("fs"),p=document.getElementById("vs"),ao=true,U=null,d=null,H=null,T=null,ah=8,j=1,C=0,D=0,g=0,r=0,s=0,S=0,K=0,h=null,aq=null,ag=null,at=false,v=false,x=[],A=8080,o=8443,y=[],ai=null,q=[],w=0;function t(){ab&&console.log("WEBSOCKET: OPEN");u();this.send(json("get_webgl_req"));this.send(json("get_info_req"))}function e(ax){ab&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+ax.data.toString());var aw=(servers.data[selected_server].values.address==new URL(ax.origin).hostname);var av=JSON.parse(ax.data.toString());var az=av.method;var ay=av.params;switch(az){case"get_info_ack":I(ay);break;case"set_colors_ack":if(aw){ai=ay}break;case"get_data_ack":if(aw){get_data_ack(ay)}break;case"get_webgl_ack":if(aw){f(ay.vertex_shader,ay.fragment_shader)}break;default:}}function F(av){ab&&console.log("WEBSOCKET: ONCLOSE");if(data_close(new URL(this.url).hostname)<0){X()}}function W(av){ab&&console.log("WEBSOCKET: ONERROR ")}function z(){try{at=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var av=new RTCPeerConnection({iceServers:[]});av.createDataChannel("");av.createOffer(av.setLocalDescription.bind(av),ae);av.onicecandidate=ak}catch(aw){console.log(aw.message)}}function ak(av){if(!av||!av.candidate||!av.candidate.candidate){return}var aw=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(av.candidate.candidate)[1];this.onicecandidate=ae;ip=aw.split(".")[0]+"."+aw.split(".")[1]+"."+aw.split(".")[2];setTimeout(M,5000);scan_counter=0;setTimeout(L,20)}function L(){scan_counter++;if(scan_counter<255){var av=ip+"."+scan_counter;am(av);setTimeout(L,20)}}function ae(){}function M(){ab&&console.log("DISCOVER TIMEOUT");at=false;if(!v){}}function R(){for(var av=0;av<x.length;++av){x.shift().abort()}}function am(av){ad(av).then(function(aw){O(aw);R()},function(aw){})}function ad(av){return new Promise(function(ax,aw){try{var az=new XMLHttpRequest();x.push(az);az.ip=av;az.timeout=1000;az.open("GET","http://"+av+":"+A,true);az.ontimeout=function(aA){aw(Error("NA"))};az.onerror=function(){aw(Error("NA"))};az.onload=function(aB){if(az.readyState===4){if(az.status===200){console.log("FOUND SERVER: "+this.ip);v=true;var aA={};aA.ws="ws://"+this.ip+":"+A;aA.ip=this.ip;ax(aA)}}};az.send()}catch(ay){"XHR:"+console.log(ay.message)}})}function O(aw){try{var av=new WebSocket(aw.ws);av.onopen=t;av.onclose=F;av.onerror=W;av.onmessage=e;servers.data[w]={};servers.data[w].socket=av;servers.data[w].id=w+1;servers.data[w].values={};servers.data[w].values.address=aw.ip;if(w==0){servers.data[w].values.selected=true}w++}catch(ax){console.log("DISCOVERY ERROR");console.log(ax.message)}}function I(aw){for(var av=0;av<w;av++){if(aw.ip===servers.data[av].values.address){servers.data[av].values.hostname=aw.hostname;servers.data[av].values.platform=aw.platform;servers.data[av].values.status=aw.status}}serverGrid.processJSON(servers);serverGrid.tableLoaded();update_server_menu();server_menu.selectedIndex=selected_server}function al(){if(ai&&ai.shader_params&&ai.shader_params.width&&ai.shader_params.height&&ai.colors&&ai.colors.data&&ai.shader_params.width*ai.shader_params.height*3==ai.colors.data.length){ah=ai.shader_params.width;j=ai.shader_params.height;aa=ai.colors.data;const aw=twgl.createTexture(U,{width:ah,height:j,internalFormat:U.RGB,min:U.NEAREST,mag:U.NEAREST,src:aa});twgl.resizeCanvasToDisplaySize(U.canvas,window.devicePixelRatio);U.viewport(0,0,U.canvas.width,U.canvas.height);const av={time:Math.random()/5,canvas_resolution:[U.canvas.width,U.canvas.height],texture_resolution:[ah,j],tex:aw};if(j*ah*3!=aa.length){return}twgl.setUniforms(d,av);twgl.drawBufferInfo(U,T);U.deleteTexture(aw)}requestAnimationFrame(al)}function V(av){}function i(){ab&&console.log("UI INIT");an()}function an(){au.style.color="red";if(!ac){z()}}function u(){ab&&console.log("UI CONNECTED");ac=true;au.style.color="green";socket_send(selected_server,"get_data_req",null)}function X(){ab&&console.log("UI DISCONNECTED");ao=false;G();ac=false;v=false;au.style.color="red";ar.style.opacity=0;af.style.opacity=0}function f(aw,av){p.text=aw;aj.text=av;H={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};U=document.querySelector("#canvas").getContext("webgl");d=twgl.createProgramInfo(U,["vs","fs"]);T=twgl.createBufferInfoFromArrays(U,H);U.useProgram(d.program);twgl.setBuffersAndAttributes(U,d,T);requestAnimationFrame(al)}function G(){ao=!ao;if(ao){E.style.display="none";ar.style.opacity=1;au.innerHTML="<B>Show</B>";Z.style.display="none";Y.style.display="none";m.style.display="none";n.style.display="none";server_config.style.display="none"}else{E.style.display="inline-block";ar.style.opacity=0.5;au.innerHTML="<B>Hide</B>";Z.style.display="block";Y.style.display="block";m.style.display="block";n.style.display="block";server_config.style.display="flex"}}function N(){var av=document.createElement("option");av.text="None";server_menu.add(av);init_grids();au.style.display="block";au.onclick=G;Z.onclick=ap;Y.onclick=B;m.onclick=c;n.onclick=P;ao=true;G();ap()}function ap(){Z.style.color="white";server_grid.style.display="block";Y.style.color="gray";layer_grid.style.display="none";m.style.color="gray";shader_grid.style.display="none";n.style.color="gray";device_grid.style.display="none"}function B(){Z.style.color="gray";server_grid.style.display="none";Y.style.color="white";layer_grid.style.display="block";m.style.color="gray";shader_grid.style.display="none";n.style.color="gray";device_grid.style.display="none"}function c(){Z.style.color="gray";server_grid.style.display="none";m.style.color="white";shader_grid.style.display="block";Y.style.color="gray";layer_grid.style.display="none";n.style.color="gray";device_grid.style.display="none"}function P(){Z.style.color="gray";server_grid.style.display="none";Y.style.color="gray";layer_grid.style.display="none";m.style.color="gray";shader_grid.style.display="none";n.style.color="white";device_grid.style.display="block"}N();i()};