function rgb_led_matrix_init(){var N=false,w=null,M=null,f=null,ap={},l={},J="localhost:8080",ad=null,af=1,q=false,D=false,aa=1,T=null,ao=true,j=document.getElementById("canvas"),Q=document.getElementById("ui"),aj=document.getElementById("menu"),H=document.getElementById("fs"),t=document.getElementById("vs"),v=true,F=null,E=null,r=null,p=null,y=null,h=null,a=8,c=1,Z=0,n=0,C=0,am=0,X=0,e=0,d=0,ai=null,k=null,b=null,A=false,an=false,O=[],V=8080,ad=null;function R(aq){N&&console.log("WEBSOCKET: CONNECT");if(an&&ad!=null){N&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");m(ad)}else{g()}}function ac(){N&&console.log("WEBSOCKET: OPEN");socket=this;s()}function L(ar){N&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+ar.data.toString());var aq=JSON.parse(ar.data.toString());var au=aq.method;var at=aq.params;switch(au){case"set_colors_ack":u(at);break;case"get_shaders_ack":w=at;break;case"get_devices_ack":M=at;break;case"get_images_ack":f=at;break;case"get_webgl_ack":Y(at.vertex_shader,at.fragment_shader);break;default:}}function B(aq){N&&console.log("WEBSOCKET: ONCLOSE");P()}function i(aq){N&&console.log("WEBSOCKET: ONERROR")}function I(ar,aq){N&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+W(ar,aq));if(socket.readyState===socket.OPEN){socket.send(W(ar,aq))}}function W(at,ar){var aq={method:at,params:ar};return JSON.stringify(aq)}function g(){try{A=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var aq=new RTCPeerConnection({iceServers:[]});aq.createDataChannel("");aq.createOffer(aq.setLocalDescription.bind(aq),ag);aq.onicecandidate=U}catch(ar){console.log(ar.message)}}function U(aq){if(!aq||!aq.candidate||!aq.candidate.candidate){return}var ar=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(aq.candidate.candidate)[1];this.onicecandidate=ag;ip=ar.split(".")[0]+"."+ar.split(".")[1]+"."+ar.split(".")[2];setTimeout(S,5000);scan_counter=0;setTimeout(ak,20)}function ak(){scan_counter++;if(scan_counter<255){var aq=ip+"."+scan_counter;o(aq);setTimeout(ak,20)}}function ag(){}function S(){N&&console.log("DISCOVER TIMEOUT");A=false;if(!an){}}function z(){for(var aq=0;aq<O.length;++aq){O.shift().abort()}}function o(aq){ae(aq).then(function(ar){m(ar);z()},function(ar){})}function ae(aq){return new Promise(function(at,ar){try{var av=new XMLHttpRequest();O.push(av);av.ip=aq;av.timeout=1000;av.open("GET","http://"+aq+":"+V,true);av.ontimeout=function(aw){ar(Error("NA"))};av.onerror=function(){ar(Error("NA"))};av.onload=function(aw){if(av.readyState===4){if(av.status===200){console.log("FOUND SERVER: "+this.ip);an=true;ad="ws://"+this.ip+":"+V;at(ad)}}};av.send()}catch(au){console.log(au.message)}})}function m(aq){try{socket=new WebSocket(aq);socket.onopen=ac;socket.onclose=B;socket.onerror=i;socket.onmessage=function(at){L(at)}}catch(ar){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(ar.message)}}function al(aq){}G();function G(){N&&console.log("UI INIT");x()}function x(){if(!D){R("ws://"+J)}}function s(){N&&console.log("UI CONNECTED");D=true}function P(){N&&console.log("UI DISCONNECTED");D=false;u(null);x()}function Y(ar,aq){t.text=ar;H.text=aq;y={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};r=document.querySelector("#canvas").getContext("webgl");p=twgl.createProgramInfo(r,["vs","fs"]);h=twgl.createBufferInfoFromArrays(r,y);r.useProgram(p.program);twgl.setBuffersAndAttributes(r,p,h)}function K(au){var aq=this.getRowValues(au);aq.name=aq.name;var at=0;for(var ar=0;ar<this.getRowCount();ar++){at=Math.max(at,parseInt(this.getRowId(ar))+1)}this.insertAfter(au,at,aq)}function ah(){if(window.location.hostname==="standard3d.com"){return}v=!v;if(v){Q.style.display="none";j.style.opacity=1;aj.innerHTML="<b>SHOW</b>";aj.style.color="gray"}else{Q.style.display="inline-block";j.style.opacity=0.5;aj.innerHTML="<b>HIDE&nbsp;&nbsp;&nbsp;&nbsp;SAVE&nbsp;&nbsp;&nbsp;&nbsp;LOAD&nbsp;&nbsp;&nbsp;&nbsp;UNDO</b>";aj.style.color="white"}}function ab(){F=new EditableGrid("Layers");F.tableLoaded=function(){F.duplicate=K;this.setCellRenderer("action",new CellRenderer({render:function(aq,ar){var at=F.getRowId(aq.rowIndex);aq.innerHTML='<a onclick="if (layerGrid.data.length>1) layerGrid.remove('+aq.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';aq.innerHTML+='&nbsp;<a onclick="layerGrid.duplicate('+aq.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("layers","grid")};F.loadJSON("data/layers.json");E=new EditableGrid("Properties");E.tableLoaded=function(){E.duplicate=K;this.setCellRenderer("action",new CellRenderer({render:function(aq,ar){var at=E.getRowId(aq.rowIndex);aq.innerHTML='<a onclick="if (propertyGrid.data.length>1) propertyGrid.remove('+aq.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';aq.innerHTML+='&nbsp;<a onclick="propertyGrid.duplicate('+aq.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("properties","grid")};E.loadJSON("data/properties.json");aj.onclick=ah}ab();function u(ar){if(ar&&ar.shader_params&&ar.shader_params.width&&ar.shader_params.height&&ar.colors&&ar.colors.data){a=ar.shader_params.width;c=ar.shader_params.height;if(ar.colors){T=ar.colors.data}}else{a=8;c=1;T=new Uint8Array(24).fill(0)}const at=twgl.createTexture(r,{width:a,height:c,internalFormat:r.RGB,min:r.NEAREST,mag:r.NEAREST,src:T});twgl.resizeCanvasToDisplaySize(r.canvas);r.viewport(0,0,r.canvas.width,r.canvas.height);const aq={canvas_resolution:[r.canvas.width,r.canvas.height],texture_resolution:[a,c],tex:at};if(c*a*3!=T.length){return}twgl.setUniforms(p,aq);twgl.drawBufferInfo(r,h);r.deleteTexture(at)}};