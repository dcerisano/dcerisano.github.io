function init(){rgb_led_matrix_init()}function rgb_led_matrix_init(){var C=false,A="localhost:8080",L=null,e=8,a=1,N=1,p=false,w=false,K=1,G=new Uint8Array(e*a*3),m=document.getElementById("emulator"),E=document.getElementById("ui"),R=m.getContext("2d"),J=window.innerWidth,o=window.innerHeight,v=J/(e+1),Q=o/(a+1),I=v*0.4,h=0,f=0,O=null,c=null,n=null,d=null,r=["cpu_meter","aurora","timesquare","unicorn","fireplace","notifier","plasma","ambilight"],k=["s3d.jpg","twitter.jpg","vrip.jpg"];function F(T,V,U){C&&console.log("WEBSOCKET: CONNECT");try{n=V;d=U;socket=new WebSocket(T);socket.onopen=M;socket.onclose=t;socket.onerror=l;socket.onmessage=function(X){B(X)}}catch(W){C&&console.log("WEBSOCKET: CONNECT ERROR");C&&console.log(W.message)}}function M(){C&&console.log("WEBSOCKET: OPEN");socket=this;n()}function B(U){C&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+U.data.toString());var T=JSON.parse(U.data.toString());var W=T.method;var V=T.params;switch(W){case"setColors":q(V);P(V);default:}}function t(T){C&&console.log("WEBSOCKET: ONCLOSE");L=null;d()}function l(T){C&&console.log("WEBSOCKET: ONERROR")}function z(U,T){C&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+H(U,T));if(socket.readyState===socket.OPEN){socket.send(H(U,T))}}function H(V,U){var T={method:V,params:U};return JSON.stringify(T)}function P(T){E.innerHTML=T.name}function y(){C&&console.log("UI INIT");s()}function D(){C&&console.log("UI CONNECTED");w=true;S()}function u(){C&&console.log("UI DISCONNECTED");w=false;while(K--){window.clearTimeout(K)}K=setTimeout(s,1000)}function s(){if(!w){F("ws://"+A,D,u)}}function S(){var T={};T.shader=r[Math.floor(Math.random()*r.length)];T.width=Math.floor(Math.random()*16+1);T.height=Math.floor(Math.random()*16+1);T.producer_framerate=10;T.consumer_framerate=60;T.alpha=10;T.shader="ambilight";if(T.shader=="notifier"){T.image=k[Math.floor(Math.random()*k.length)];T.producer_framerate=10;T.consumer_framerate=60;T.duration=0.3;T.alpha=0.2;T.width=16;T.height=16}if(T.shader=="ambilight"){T.producer_framerate=8;T.consumer_framerate=32;T.alpha=0.25;T.width=32;T.height=18;T.cropx=0.55;T.cropy=0.2;T.cropw=0.45;T.croph=0.8}if(T.shader=="plasma"){T.producer_framerate=30;T.consumer_framerate=60;T.alpha=0.5;T.scale=(T.width+T.height)/3}z("set_shader",T);while(K--){window.clearTimeout(K)}K=setTimeout(S,10000)}y();function q(U){a=U.width;e=U.height;G=U.colors.data;b();C&&console.log("drawMatrix");if(e*a*3!=G.length){return}for(i=0;i<a;i++){for(j=0;j<e;j++){var T=v*(i+1),V=Q*(j+1);g(T,V,I,x(i,j))}}}function b(){C&&console.log("resizeMatrix");J=window.innerWidth;o=window.innerHeight;h=0;f=0;m.width=J;m.height=o;m.style.width=J;m.style.height=o;v=J/(a+1);Q=o/(e+1);if(v>Q){v=Q}else{Q=v}f=(o-Q*(e+1))/2;h=(J-v*(a+1))/2;I=v*0.4}function x(U,X){var W=G[(X*a+U)*3+0],V=G[(X*a+U)*3+1],T=G[(X*a+U)*3+2];if(typeof W!=="undefined"&&V!=="undefined"&&T!=="undefined"){return"rgba("+W+","+V+","+T+",1)"}else{return null}}function g(U,W,T,V){C&&console.log("drawDot: "+V);if(V){R.beginPath();R.arc(U+h,W+f,T,0,2*Math.PI,false);R.fillStyle=V;R.fill();R.lineWidth=1;R.strokeStyle="#101010";R.stroke()}}q({width:8,height:1,colors:new Uint8Array(24)});document.getElementsByTagName("BODY")[0].onresize=q};