function init(){rgb_led_matrix_init()}function rgb_led_matrix_init(){var C=false,A="localhost:8080",K=null,e=8,a=1,M=1,p=false,w=false,J=1,F=new Uint8Array(e*a*3),m=document.getElementById("matrix"),P=m.getContext("2d"),I=window.innerWidth,o=window.innerHeight,v=I/(e+1),O=o/(a+1),H=v*0.4,h=0,f=0,N=null,c=null,n=null,d=null,r=["cpu_meter","aurora","timesquare","unicorn","fireplace","notifier","ambilight"],k=["s3d.jpg","twitter.jpg","vrip.jpg"];function E(R,T,S){C&&console.log("WEBSOCKET: CONNECT");try{n=T;d=S;socket=new WebSocket(R);socket.onopen=L;socket.onclose=t;socket.onerror=l;socket.onmessage=function(V){B(V)}}catch(U){C&&console.log("WEBSOCKET: CONNECT ERROR");C&&console.log(U.message)}}function L(){C&&console.log("WEBSOCKET: OPEN");socket=this;n()}function B(S){C&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+S.data.toString());var R=JSON.parse(S.data.toString());var U=R.method;var T=R.params;switch(U){case"setColors":e=T.width;a=T.height;F=T.colors.data;q();default:}}function t(R){C&&console.log("WEBSOCKET: ONCLOSE");K=null;d()}function l(R){C&&console.log("WEBSOCKET: ONERROR")}function z(S,R){C&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+G(S,R));if(socket.readyState===socket.OPEN){socket.send(G(S,R))}}function G(T,S){var R={method:T,params:S};return JSON.stringify(R)}function y(){C&&console.log("UI INIT");s()}function D(){C&&console.log("UI CONNECTED");w=true;Q()}function u(){C&&console.log("UI DISCONNECTED");w=false;while(J--){window.clearTimeout(J)}J=setTimeout(s,1000)}function s(){if(!w){E("ws://"+A,D,u)}}function Q(){var T={};var R=Math.floor(Math.random()*8+1);var S=Math.floor(Math.random()*8+1);T.shader=r[Math.floor(Math.random()*r.length)];if(T.shader=="notifier"){T.width=8;T.height=8;T.image=k[Math.floor(Math.random()*k.length)];T.duration=0.3}T.width=R;T.height=S;z("set_shader",T);while(J--){window.clearTimeout(J)}J=setTimeout(Q,10000)}y();function b(){C&&console.log("resizeMatrix");I=window.innerWidth;o=window.innerHeight;h=0;f=0;m.width=I;m.height=o;m.style.width=I;m.style.height=o;v=I/(e+1);O=o/(a+1);if(v>O){v=O}else{O=v}f=(o-O*(a+1))/2;h=(I-v*(e+1))/2;H=v*0.4}function q(){b();C&&console.log("drawMatrix");if(e*a*3!=F.length){return}for(i=0;i<a;i++){for(j=0;j<e;j++){var R=v*(j+1),S=O*(i+1);g(R,S,H,x(i,j))}}}function x(V,S){var U=F[(V*e+S)*3+0],T=F[(V*e+S)*3+1],R=F[(V*e+S)*3+2];if(typeof U!=="undefined"&&T!=="undefined"&&R!=="undefined"){return"rgba("+U+","+T+","+R+",1)"}else{return null}}function g(S,U,R,T){C&&console.log("drawDot: "+T);if(T){P.beginPath();P.arc(S+h,U+f,R,0,2*Math.PI,false);P.fillStyle=T;P.fill();P.lineWidth=1;P.strokeStyle="#101010";P.stroke()}}b();q();document.getElementsByTagName("BODY")[0].onresize=q};