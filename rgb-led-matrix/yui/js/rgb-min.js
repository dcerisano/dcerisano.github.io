function init(){rgb_led_matrix_init()}function rgb_led_matrix_init(){var I=false,u=null,C=null,h=null,ah={},l={},F="localhost:8080",W=null,Z=1,r=false,A=false,U=1,O=null,n=document.getElementById("emulator"),L=document.getElementById("ui"),af=n.getContext("2d"),a=8,d=1,T=0,p=0,z=0,ae=0,S=0,g=0,e=0,ab=null,o=null,c=null,w=false,J=[],Q=8080,H=null;function M(ai,ak,aj){I&&console.log("WEBSOCKET: CONNECT");k()}function X(){I&&console.log("WEBSOCKET: OPEN");socket=this;s()}function G(aj){I&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+aj.data.toString());var ai=JSON.parse(aj.data.toString());var al=ai.method;var ak=ai.params;switch(al){case"set_colors_ack":t(ak);ad(ak);break;case"get_shaders_ack":u=ak;break;case"get_controllers_ack":C=ak;break;case"get_images_ack":h=ak;break;default:}}function x(ai){I&&console.log("WEBSOCKET: ONCLOSE");W=null;K()}function m(ai){I&&console.log("WEBSOCKET: ONERROR")}function E(aj,ai){I&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+R(aj,ai));if(socket.readyState===socket.OPEN){socket.send(R(aj,ai))}}function R(ak,aj){var ai={method:ak,params:aj};return JSON.stringify(ai)}function k(){try{w=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var ai=new RTCPeerConnection({iceServers:[]});ai.createDataChannel("");ai.createOffer(ai.setLocalDescription.bind(ai),aa);ai.onicecandidate=P}catch(aj){console.log(aj.message)}}function P(ai){if(!ai||!ai.candidate||!ai.candidate.candidate){return}var aj=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ai.candidate.candidate)[1];this.onicecandidate=aa;H=aj.split(".")[0]+"."+aj.split(".")[1]+"."+aj.split(".")[2];setTimeout(N,5000);scan_counter=0;setTimeout(ac,20)}function ac(){scan_counter++;if(scan_counter<255){var ai=H+"."+scan_counter;q(ai);setTimeout(ac,20)}}function aa(){}function N(){I&&console.log("DISCOVER TIMEOUT");w=false;if(!discovered){vrip360studio.style.opacity="1";vrip360logo.style.display="none";spinner.style.display="none";showPlayerNotFound();$("#internal_power_button").toggleClass("on",false)}}function q(ai){Y(ai).then(function(aj){y(aj);abort()},function(aj){})}function Y(ai){return new Promise(function(ak,aj){try{var am=new XMLHttpRequest();J.push(am);am.ip=ai;am.timeout=1000;am.open("GET","http://"+ai+":"+Q,true);am.ontimeout=function(an){aj(Error("NA"))};am.onerror=function(){aj(Error("NA"))};am.onload=function(an){if(am.readyState===4){if(am.status===200){console.log("FOUND SERVER: "+this.ip);ak("ws://"+this.ip+":"+Q)}}};am.send()}catch(al){console.log(al.message)}})}function y(ai){try{socket=new WebSocket(ai);socket.onopen=X;socket.onclose=x;socket.onerror=m;socket.onmessage=function(ak){G(ak)}}catch(aj){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(aj.message)}}function ad(ai){}function ag(){if(!u||!C){while(U--){clearTimeout(U)}U=setTimeout(ag,100);return}ah={};l={};ah.shader=u[Math.floor(Math.random()*u.length)];ah.width=Math.floor(Math.random()*15+1);ah.height=Math.floor(Math.random()*15+1);ah.shader="ambilight";if(ah.shader=="notifier"){ah.image=h[Math.floor(Math.random()*h.length)];ah.width=8;ah.height=1}if(ah.shader=="cpu_meter"){ah.pwm_path="/sys/class/hwmon/hwmon0/pwm3";ah.width=8;ah.height=1}if(ah.shader=="ambilight"){ah.width=16;ah.height=9;ah.cropx=0.56;ah.cropy=0.3;ah.cropw=0.44;ah.croph=0.7}if(ah.shader=="plasma"){ah.width=64;ah.height=36;ah.scale=(ah.width+ah.height)/10}E("set_shader_req",ah);ad()}D();function D(){I&&console.log("UI INIT");v()}function v(){if(!A){M("ws://"+F,s,K)}}function s(){I&&console.log("UI CONNECTED");A=true;ag()}function K(){I&&console.log("UI DISCONNECTED");A=false;t(null);v()}function V(){document.getElementsByTagName("BODY")[0].onresize=t;console.log(document.getElementById("emulator"));document.getElementById("ui").addEventListener("click",function(){document.body.requestFullscreen();console.log("click")},false)}V();function t(aj){if(aj&&aj.shader_params&&aj.shader_params.width&&aj.shader_params.height&&aj.colors&&aj.colors.data){a=aj.shader_params.width;d=aj.shader_params.height;if(aj.colors){O=aj.colors.data}}else{a=8;d=1;O=new Uint8Array(24).fill(0)}b(aj);I&&console.log("drawMatrix");if(d*a*3!=O.length){return}for(i=0;i<a;i++){for(j=0;j<d;j++){var ai=z*(i+1),ak=ae*(j+1);f(ai,ak,S,B(i,j))}}}function b(){I&&console.log("resizeMatrix");T=window.innerWidth;p=window.innerHeight;g=0;e=0;n.width=T;n.height=p;n.style.width=T;n.style.height=p;z=T/(a+1);ae=p/(d+1);if(z>ae){z=ae}else{ae=z}e=(p-ae*(d+1))/2;g=(T-z*(a+1))/2;S=z*0.4}function B(aj,am){var al=O[(am*a+aj)*3+0],ak=O[(am*a+aj)*3+1],ai=O[(am*a+aj)*3+2];if(typeof al!=="undefined"&&ak!=="undefined"&&ai!=="undefined"){return"rgba("+al+","+ak+","+ai+",1)"}else{return null}}function f(aj,al,ai,ak){if(ak){af.beginPath();af.arc(aj+g,al+e,ai,0,2*Math.PI,false);af.fillStyle=ak;af.fill();af.lineWidth=1;af.strokeStyle="#101010";af.stroke()}}};