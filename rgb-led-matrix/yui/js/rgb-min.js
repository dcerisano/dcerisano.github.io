function rgb_led_matrix_init(){var ae=false,ak=null,y=null,e=null,a={},b={},Q="localhost:8080",X=null,p=1,J=false,af=false,T=1,ad=null,d=true,aw=document.getElementById("canvas"),F=document.getElementById("ui"),o=document.getElementById("menu"),am=document.getElementById("fs"),s=document.getElementById("vs"),ar=true,q=null,au=null,R=null,Y=null,g=null,I=null,W=null,aj=8,n=1,D=0,E=0,j=0,t=0,u=0,V=0,K=0,k=null,av=null,ai=null,ax=false,x=false,z=[],B=8080,r=8443,X=null,al=null;function l(ay){ae&&console.log("WEBSOCKET: CONNECT");if(x&&X!=null){ae&&console.log("WEBSOCKET: ATTEMPTING TO REUSE");P(X)}else{A()}}function v(){ae&&console.log("WEBSOCKET: OPEN");socket=this;w()}function h(az){ae&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+az.data.toString());var ay=JSON.parse(az.data.toString());var aB=ay.method;var aA=ay.params;switch(aB){case"set_colors_ack":al=aA;break;case"get_shaders_ack":ak=aA;break;case"get_devices_ack":y=aA;break;case"get_images_ack":e=aA;break;case"get_webgl_ack":i(aA.vertex_shader,aA.fragment_shader);break;default:}}function G(ay){ae&&console.log("WEBSOCKET: ONCLOSE");ab()}function aa(ay){ae&&console.log("WEBSOCKET: ONERROR")}function c(az,ay){ae&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+L(az,ay));if(socket.readyState===socket.OPEN){socket.send(L(az,ay))}}function L(aA,az){var ay={method:aA,params:az};return JSON.stringify(ay)}function A(){try{ax=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var ay=new RTCPeerConnection({iceServers:[]});ay.createDataChannel("");ay.createOffer(ay.setLocalDescription.bind(ay),ah);ay.onicecandidate=an}catch(az){console.log(az.message)}}function an(ay){if(!ay||!ay.candidate||!ay.candidate.candidate){return}var az=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ay.candidate.candidate)[1];this.onicecandidate=ah;ip=az.split(".")[0]+"."+az.split(".")[1]+"."+az.split(".")[2];setTimeout(N,5000);scan_counter=0;setTimeout(M,20)}function M(){scan_counter++;if(scan_counter<255){var ay=ip+"."+scan_counter;ap(ay);setTimeout(M,20)}}function ah(){}function N(){ae&&console.log("DISCOVER TIMEOUT");ax=false;if(!x){}}function U(){for(var ay=0;ay<z.length;++ay){z.shift().abort()}}function ap(ay){ag(ay).then(function(az){P(az);U()},function(az){})}function ag(ay){return new Promise(function(aA,az){try{var aC=new XMLHttpRequest();z.push(aC);aC.ip=ay;aC.timeout=1000;aC.open("GET","http://"+ay+":"+B,true);aC.ontimeout=function(aD){az(Error("NA"))};aC.onerror=function(){az(Error("NA"))};aC.onload=function(aD){if(aC.readyState===4){if(aC.status===200){console.log("FOUND SERVER: "+this.ip);x=true;X="ws://"+this.ip+":"+B;aA(X)}}};aC.send()}catch(aB){console.log(aB.message)}})}function P(ay){try{socket=new WebSocket(ay);socket.onopen=v;socket.onclose=G;socket.onerror=aa;socket.onmessage=function(aA){h(aA)}}catch(az){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(az.message)}}function ao(){if(al&&al.shader_params&&al.shader_params.width&&al.shader_params.height&&al.colors&&al.colors.data){aj=al.shader_params.width;n=al.shader_params.height;if(al.colors){ad=al.colors.data}}else{aj=8;n=8;ad=new Uint8Array(aj*n*3).fill(32)}const az=twgl.createTexture(Y,{width:aj,height:n,internalFormat:Y.RGB,min:Y.NEAREST,mag:Y.NEAREST,src:ad});twgl.resizeCanvasToDisplaySize(Y.canvas,window.devicePixelRatio);Y.viewport(0,0,Y.canvas.width,Y.canvas.height);const ay={time:Math.random()/5,canvas_resolution:[Y.canvas.width,Y.canvas.height],texture_resolution:[aj,n],tex:az};if(n*aj*3!=ad.length){return}twgl.setUniforms(g,ay);twgl.drawBufferInfo(Y,W);Y.deleteTexture(az);requestAnimationFrame(ao)}function at(){al=null}"use strict";function Z(ay){}m();function m(){ae&&console.log("UI INIT");aq()}function aq(){if(!af){l("ws://"+Q)}}function w(){ae&&console.log("UI CONNECTED");af=true}function ab(){ae&&console.log("UI DISCONNECTED");af=false;at();aq()}function i(az,ay){s.text=az;am.text=ay;I={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};Y=document.querySelector("#canvas").getContext("webgl");g=twgl.createProgramInfo(Y,["vs","fs"]);W=twgl.createBufferInfoFromArrays(Y,I);Y.useProgram(g.program);twgl.setBuffersAndAttributes(Y,g,W);requestAnimationFrame(ao)}function ac(aB){var ay=this.getRowValues(aB);ay.name=ay.name;var aA=0;for(var az=0;az<this.getRowCount();az++){aA=Math.max(aA,parseInt(this.getRowId(az))+1)}this.insertAfter(aB,aA,ay)}function H(){ar=!ar;if(ar){F.style.display="none";aw.style.opacity=1;show_button.innerHTML="<B>SHOW</B>";layer_button.style.display="none";shader_button.style.display="none";device_button.style.display="none"}else{F.style.display="inline-block";aw.style.opacity=0.5;show_button.innerHTML="<B>HIDE</B>";layer_button.style.display="block";shader_button.style.display="block";device_button.style.display="block"}}function O(){q=new EditableGrid("Layers");q.tableLoaded=function(){q.duplicate=ac;this.setCellRenderer("action",new CellRenderer({render:function(ay,az){var aA=q.getRowId(ay.rowIndex);ay.innerHTML='<a onclick="if (layerGrid.data.length>1) layerGrid.remove('+ay.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ay.innerHTML+='&nbsp;<a onclick="layerGrid.duplicate('+ay.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("layer_grid","grid")};q.loadJSON("data/layers.json");au=new EditableGrid("Shaders");au.tableLoaded=function(){au.duplicate=ac;this.setCellRenderer("action",new CellRenderer({render:function(ay,az){var aA=au.getRowId(ay.rowIndex);ay.innerHTML='<a onclick="if (shaderGrid.data.length>1) shaderGrid.remove('+ay.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ay.innerHTML+='&nbsp;<a onclick="shaderGrid.duplicate('+ay.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("shader_grid","grid")};au.loadJSON("data/shaders.json");R=new EditableGrid("Devices");R.tableLoaded=function(){R.duplicate=ac;this.setCellRenderer("action",new CellRenderer({render:function(ay,az){var aA=R.getRowId(ay.rowIndex);ay.innerHTML='<a onclick="if (deviceGrid.data.length>1) deviceGrid.remove('+ay.rowIndex+'); " style="cursor:pointer"><img src="img/delete.png" border="0" alt="delete" title="Delete row"/></a>';ay.innerHTML+='&nbsp;<a onclick="deviceGrid.duplicate('+ay.rowIndex+');" style="cursor:pointer"><img src="img/duplicate.png" border="0" alt="duplicate" title="Duplicate row"/></a>'}}));this.renderGrid("device_grid","grid")};R.loadJSON("data/devices.json");if(window.location.hostname==="standard3d.com"){o.style.display="none"}show_button.style.display="block";show_button.onclick=H;layer_button.onclick=C;shader_button.onclick=f;device_button.onclick=S;C()}function C(){layer_button.style.color="white";layer_grid.style.display="block";shader_button.style.color="gray";shader_grid.style.display="none";device_button.style.color="gray";device_grid.style.display="none"}function f(){layer_button.style.color="gray";layer_grid.style.display="none";shader_button.style.color="white";shader_grid.style.display="block";device_button.style.color="gray";device_grid.style.display="none"}function S(){layer_button.style.color="gray";layer_grid.style.display="none";shader_button.style.color="gray";shader_grid.style.display="none";device_button.style.color="white";device_grid.style.display="block"}O()};