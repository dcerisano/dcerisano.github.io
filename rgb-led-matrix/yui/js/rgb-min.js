function init(){rgb_led_matrix_init()}function rgb_led_matrix_init(){var A=false,y="localhost:8080",I=null,c=8,B=1,L=1,o=false,v=false,H=1,E=new Uint8Array(c*B*3),l=document.getElementById("matrix"),P=l.getContext("2d"),G=window.innerWidth,n=window.innerHeight,u=G/(c+1),O=n/(B+1),F=u*0.4,g=0,e=0,M=null,b=null,m=null,d=null,q=["cpu_meter","aurora","timesquare","fireplace","notifier","cpu_meter","ambilight"],h=["s3d.jpg","twitter.jpg","vrip.jpg"];function D(R,T,S){A&&console.log("WEBSOCKET: CONNECT");try{m=T;d=S;socket=new WebSocket(R);socket.binaryType="arraybuffer";socket.onopen=K;socket.onclose=s;socket.onerror=k;socket.onmessage=function(V){z(V)}}catch(U){A&&console.log("WEBSOCKET: CONNECT ERROR");A&&console.log(U.message)}}function K(){A&&console.log("WEBSOCKET: OPEN");socket=this;m()}function z(R){E=new Uint8Array(R.data);A&&console.log("WEBSOCKET: ONMESSAGE: "+R.data);p()}function s(R){A&&console.log("WEBSOCKET: ONCLOSE");I=null;d()}function k(R){A&&console.log("WEBSOCKET: ONERROR");A&&console.log(R.message)}function x(T,S){A&&console.log("WEBSOCKET: SEND");var R={method:T,params:S};if(socket.readyState===socket.OPEN){socket.send(N(JSON.stringify(R)))}}function N(V){var S=new ArrayBuffer(V.length);var R=new Uint8Array(S);for(var T=0,U=V.length;T<U;T++){R[T]=V.charCodeAt(T)}return S}function J(){A&&console.log("UI INIT");r()}function C(){A&&console.log("UI CONNECTED");v=true;Q()}function t(){A&&console.log("UI DISCONNECTED");v=false;while(H--){window.clearTimeout(H)}H=setTimeout(r,1000)}function r(){if(!v){D("ws://"+y,C,t)}}function Q(){var R=Math.floor(Math.random()*8+1);var S=Math.floor(Math.random()*8+1);x("resize",[R,S]);var T=Math.floor(Math.random()*q.length);var U=Math.floor(Math.random()*h.length);x("switch_shader",[q[T],h[U]]);c=R;B=S;a();while(H--){window.clearTimeout(H)}H=setTimeout(Q,10000)}J();function a(){A&&console.log("resizeMatrix");G=window.innerWidth;n=window.innerHeight;g=0;e=0;l.width=G;l.height=n;l.style.width=G;l.style.height=n;u=G/(c+1);O=n/(B+1);if(u>O){u=O}else{O=u}e=(n-O*(B+1))/2;g=(G-u*(c+1))/2;F=u*0.4;p()}function p(){A&&console.log("drawMatrix");if(c*B*3!=E.length){return}for(i=0;i<B;i++){for(j=0;j<c;j++){var R=u*(j+1),S=O*(i+1);f(R,S,F,w(i,j))}}}function w(V,S){var U=E[(V*c+S)*3+0],T=E[(V*c+S)*3+1],R=E[(V*c+S)*3+2];A&&console.log("getColor:"+S+" "+V+" "+(V*B+S));return"rgba("+U+","+T+","+R+",1)"}function f(S,U,R,T){P.beginPath();P.arc(S+g,U+e,R,0,2*Math.PI,false);P.fillStyle=T;P.fill();P.lineWidth=1;P.strokeStyle="#101010";P.stroke();A&&console.log("drawDot: "+T)}a();document.getElementsByTagName("BODY")[0].onresize=a};