function init(){rgb_led_matrix_init()}function rgb_led_matrix_init(){var I=false,u=null,C=null,h=null,ag={},l={},F="localhost:8080",V=null,Y=1,r=false,A=false,U=1,O=null,n=document.getElementById("emulator"),L=document.getElementById("ui"),ae=n.getContext("2d"),a=8,d=1,T=0,p=0,z=0,ad=0,S=0,g=0,e=0,aa=null,o=null,c=null,w=false,J=[],Q=8080,H=null;function M(ah,aj,ai){I&&console.log("WEBSOCKET: CONNECT");k()}function W(){I&&console.log("WEBSOCKET: OPEN");socket=this;s()}function G(ai){I&&console.log("WEBSOCKET: GOT MESSAGE FROM SERVER: "+ai.data.toString());var ah=JSON.parse(ai.data.toString());var ak=ah.method;var aj=ah.params;switch(ak){case"set_colors_ack":t(aj);ac(aj);break;case"get_shaders_ack":u=aj;break;case"get_controllers_ack":C=aj;break;case"get_images_ack":h=aj;break;default:}}function x(ah){I&&console.log("WEBSOCKET: ONCLOSE");V=null;K()}function m(ah){I&&console.log("WEBSOCKET: ONERROR")}function E(ai,ah){I&&console.log("WEBSOCKET: SENT MESSAGE TO SERVER: "+R(ai,ah));if(socket.readyState===socket.OPEN){socket.send(R(ai,ah))}}function R(aj,ai){var ah={method:aj,params:ai};return JSON.stringify(ah)}function k(){try{w=true;window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var ah=new RTCPeerConnection({iceServers:[]});ah.createDataChannel("");ah.createOffer(ah.setLocalDescription.bind(ah),Z);ah.onicecandidate=P}catch(ai){console.log(ai.message)}}function P(ah){if(!ah||!ah.candidate||!ah.candidate.candidate){return}var ai=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ah.candidate.candidate)[1];this.onicecandidate=Z;H=ai.split(".")[0]+"."+ai.split(".")[1]+"."+ai.split(".")[2];setTimeout(N,5000);scan_counter=0;setTimeout(ab,20)}function ab(){scan_counter++;if(scan_counter<255){var ah=H+"."+scan_counter;q(ah);setTimeout(ab,20)}}function Z(){}function N(){I&&console.log("DISCOVER TIMEOUT");w=false;if(!discovered){vrip360studio.style.opacity="1";vrip360logo.style.display="none";spinner.style.display="none";showPlayerNotFound();$("#internal_power_button").toggleClass("on",false)}}function q(ah){X(ah).then(function(ai){y(ai);abort()},function(ai){})}function X(ah){return new Promise(function(aj,ai){try{var al=new XMLHttpRequest();J.push(al);al.ip=ah;al.timeout=1000;al.open("GET","http://"+ah+":"+Q,true);al.ontimeout=function(am){ai(Error("NA"))};al.onerror=function(){ai(Error("NA"))};al.onload=function(am){if(al.readyState===4){if(al.status===200){console.log("FOUND SERVER: "+this.ip);aj("ws://"+this.ip+":"+Q)}}};al.send()}catch(ak){console.log(ak.message)}})}function y(ah){try{socket=new WebSocket(ah);socket.onopen=W;socket.onclose=x;socket.onerror=m;socket.onmessage=function(aj){G(aj)}}catch(ai){SIGNAL_DEBUG&&console.log("DISCOVERY ERROR");SIGNAL_DEBUG&&console.log(ai.message)}}function ac(ah){}function af(){if(!u||!C){while(U--){clearTimeout(U)}U=setTimeout(af,100);return}ag={};l={};ag.shader=u[Math.floor(Math.random()*u.length)];ag.width=Math.floor(Math.random()*15+1);ag.height=Math.floor(Math.random()*15+1);ag.shader="ambilight";if(ag.shader=="notifier"){ag.image=h[Math.floor(Math.random()*h.length)];ag.width=8;ag.height=1}if(ag.shader=="cpu_meter"){ag.pwm_path="/sys/class/hwmon/hwmon0/pwm3";ag.width=8;ag.height=1}if(ag.shader=="ambilight"){ag.width=16;ag.height=9;ag.cropx=0.56;ag.cropy=0.3;ag.cropw=0.44;ag.croph=0.7}if(ag.shader=="plasma"){ag.width=64;ag.height=36;ag.scale=(ag.width+ag.height)/10}E("set_shader_req",ag);ac()}D();function D(){I&&console.log("UI INIT");v()}function v(){if(!A){M("ws://"+F,s,K)}}function s(){I&&console.log("UI CONNECTED");A=true;af()}function K(){I&&console.log("UI DISCONNECTED");A=false;t(null);v()}function t(ai){if(ai&&ai.shader_params&&ai.shader_params.width&&ai.shader_params.height&&ai.colors&&ai.colors.data){a=ai.shader_params.width;d=ai.shader_params.height;if(ai.colors){O=ai.colors.data}}else{a=8;d=1;O=new Uint8Array(24).fill(0)}b(ai);I&&console.log("drawMatrix");if(d*a*3!=O.length){return}for(i=0;i<a;i++){for(j=0;j<d;j++){var ah=z*(i+1),aj=ad*(j+1);f(ah,aj,S,B(i,j))}}}function b(){I&&console.log("resizeMatrix");T=window.innerWidth;p=window.innerHeight;g=0;e=0;n.width=T;n.height=p;n.style.width=T;n.style.height=p;z=T/(a+1);ad=p/(d+1);if(z>ad){z=ad}else{ad=z}e=(p-ad*(d+1))/2;g=(T-z*(a+1))/2;S=z*0.4}function B(ai,al){var ak=O[(al*a+ai)*3+0],aj=O[(al*a+ai)*3+1],ah=O[(al*a+ai)*3+2];if(typeof ak!=="undefined"&&aj!=="undefined"&&ah!=="undefined"){return"rgba("+ak+","+aj+","+ah+",1)"}else{return null}}function f(ai,ak,ah,aj){if(aj){ae.beginPath();ae.arc(ai+g,ak+e,ah,0,2*Math.PI,false);ae.fillStyle=aj;ae.fill();ae.lineWidth=1;ae.strokeStyle="#101010";ae.stroke()}}document.getElementsByTagName("BODY")[0].onresize=t};